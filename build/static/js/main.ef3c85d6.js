/*! For license information please see main.ef3c85d6.js.LICENSE.txt */
(()=>{"use strict";var t={43:(t,e,n)=>{t.exports=n(202)},153:(t,e,n)=>{var i=n(43),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(t,e,n){var i,r={},l=null,h=null;for(i in void 0!==n&&(l=""+n),void 0!==e.key&&(l=""+e.key),void 0!==e.ref&&(h=e.ref),e)o.call(e,i)&&!c.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps)void 0===r[i]&&(r[i]=e[i]);return{$$typeof:s,type:t,key:l,ref:h,props:r,_owner:a.current}}},202:(t,e)=>{var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function _(t,e,n){this.props=t,this.context=e,this.refs=m,this.updater=n||p}function y(){}function v(t,e,n){this.props=t,this.context=e,this.refs=m,this.updater=n||p}_.prototype.isReactComponent={},_.prototype.setState=function(t,e){if("object"!==typeof t&&"function"!==typeof t&&null!=t)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},_.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},y.prototype=_.prototype;var w=v.prototype=new y;w.constructor=v,g(w,_.prototype),w.isPureReactComponent=!0;var b=Array.isArray,E=Object.prototype.hasOwnProperty,C={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function S(t,e,i){var s,r={},o=null,a=null;if(null!=e)for(s in void 0!==e.ref&&(a=e.ref),void 0!==e.key&&(o=""+e.key),e)E.call(e,s)&&!T.hasOwnProperty(s)&&(r[s]=e[s]);var c=arguments.length-2;if(1===c)r.children=i;else if(1<c){for(var l=Array(c),h=0;h<c;h++)l[h]=arguments[h+2];r.children=l}if(t&&t.defaultProps)for(s in c=t.defaultProps)void 0===r[s]&&(r[s]=c[s]);return{$$typeof:n,type:t,key:o,ref:a,props:r,_owner:C.current}}function I(t){return"object"===typeof t&&null!==t&&t.$$typeof===n}var k=/\/+/g;function N(t,e){return"object"===typeof t&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(t){return e[t]})}(""+t.key):e.toString(36)}function A(t,e,s,r,o){var a=typeof t;"undefined"!==a&&"boolean"!==a||(t=null);var c=!1;if(null===t)c=!0;else switch(a){case"string":case"number":c=!0;break;case"object":switch(t.$$typeof){case n:case i:c=!0}}if(c)return o=o(c=t),t=""===r?"."+N(c,0):r,b(o)?(s="",null!=t&&(s=t.replace(k,"$&/")+"/"),A(o,e,s,"",function(t){return t})):null!=o&&(I(o)&&(o=function(t,e){return{$$typeof:n,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}(o,s+(!o.key||c&&c.key===o.key?"":(""+o.key).replace(k,"$&/")+"/")+t)),e.push(o)),1;if(c=0,r=""===r?".":r+":",b(t))for(var l=0;l<t.length;l++){var h=r+N(a=t[l],l);c+=A(a,e,s,h,o)}else if(h=function(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=f&&t[f]||t["@@iterator"])?t:null}(t),"function"===typeof h)for(t=h.call(t),l=0;!(a=t.next()).done;)c+=A(a=a.value,e,s,h=r+N(a,l++),o);else if("object"===a)throw e=String(t),Error("Objects are not valid as a React child (found: "+("[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return c}function R(t,e,n){if(null==t)return t;var i=[],s=0;return A(t,i,"","",function(t){return e.call(n,t,s++)}),i}function D(t){if(-1===t._status){var e=t._result;(e=e()).then(function(e){0!==t._status&&-1!==t._status||(t._status=1,t._result=e)},function(e){0!==t._status&&-1!==t._status||(t._status=2,t._result=e)}),-1===t._status&&(t._status=0,t._result=e)}if(1===t._status)return t._result.default;throw t._result}var P={current:null},x={transition:null},O={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:x,ReactCurrentOwner:C};function M(){throw Error("act(...) is not supported in production builds of React.")}e.Children={map:R,forEach:function(t,e,n){R(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return R(t,function(){e++}),e},toArray:function(t){return R(t,function(t){return t})||[]},only:function(t){if(!I(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},e.Component=_,e.Fragment=s,e.Profiler=o,e.PureComponent=v,e.StrictMode=r,e.Suspense=h,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,e.act=M,e.cloneElement=function(t,e,i){if(null===t||void 0===t)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=g({},t.props),r=t.key,o=t.ref,a=t._owner;if(null!=e){if(void 0!==e.ref&&(o=e.ref,a=C.current),void 0!==e.key&&(r=""+e.key),t.type&&t.type.defaultProps)var c=t.type.defaultProps;for(l in e)E.call(e,l)&&!T.hasOwnProperty(l)&&(s[l]=void 0===e[l]&&void 0!==c?c[l]:e[l])}var l=arguments.length-2;if(1===l)s.children=i;else if(1<l){c=Array(l);for(var h=0;h<l;h++)c[h]=arguments[h+2];s.children=c}return{$$typeof:n,type:t.type,key:r,ref:o,props:s,_owner:a}},e.createContext=function(t){return(t={$$typeof:c,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:t},t.Consumer=t},e.createElement=S,e.createFactory=function(t){var e=S.bind(null,t);return e.type=t,e},e.createRef=function(){return{current:null}},e.forwardRef=function(t){return{$$typeof:l,render:t}},e.isValidElement=I,e.lazy=function(t){return{$$typeof:d,_payload:{_status:-1,_result:t},_init:D}},e.memo=function(t,e){return{$$typeof:u,type:t,compare:void 0===e?null:e}},e.startTransition=function(t){var e=x.transition;x.transition={};try{t()}finally{x.transition=e}},e.unstable_act=M,e.useCallback=function(t,e){return P.current.useCallback(t,e)},e.useContext=function(t){return P.current.useContext(t)},e.useDebugValue=function(){},e.useDeferredValue=function(t){return P.current.useDeferredValue(t)},e.useEffect=function(t,e){return P.current.useEffect(t,e)},e.useId=function(){return P.current.useId()},e.useImperativeHandle=function(t,e,n){return P.current.useImperativeHandle(t,e,n)},e.useInsertionEffect=function(t,e){return P.current.useInsertionEffect(t,e)},e.useLayoutEffect=function(t,e){return P.current.useLayoutEffect(t,e)},e.useMemo=function(t,e){return P.current.useMemo(t,e)},e.useReducer=function(t,e,n){return P.current.useReducer(t,e,n)},e.useRef=function(t){return P.current.useRef(t)},e.useState=function(t){return P.current.useState(t)},e.useSyncExternalStore=function(t,e,n){return P.current.useSyncExternalStore(t,e,n)},e.useTransition=function(){return P.current.useTransition()},e.version="18.3.1"},579:(t,e,n)=>{n(153)}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}();n(43);function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function s(t){var e=function(t,e){if("object"!=i(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var s=n.call(t,e||"default");if("object"!=i(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==i(e)?e:e+""}function r(t,e,n){return(e=s(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach(function(e){r(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}const c=!1,l=!1,h="${JSCORE_VERSION}",u=function(t,e){if(!t)throw d(e)},d=function(t){return new Error("Firebase Database ("+h+") INTERNAL ASSERT FAILED: "+t)},f=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296===(64512&s)&&i+1<t.length&&56320===(64512&t.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++i)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},p={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<t.length;s+=3){const e=t[s],r=s+1<t.length,o=r?t[s+1]:0,a=s+2<t.length,c=a?t[s+2]:0,l=e>>2,h=(3&e)<<4|o>>4;let u=(15&o)<<2|c>>6,d=63&c;a||(d=64,r||(u=64)),i.push(n[l],n[h],n[u],n[d])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(f(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,i=0;for(;n<t.length;){const s=t[n++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=t[n++];e[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[i++]=String.fromCharCode(55296+(r>>10)),e[i++]=String.fromCharCode(56320+(1023&r))}else{const r=t[n++],o=t[n++];e[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<t.length;){const e=n[t.charAt(s++)],r=s<t.length?n[t.charAt(s)]:0;++s;const o=s<t.length?n[t.charAt(s)]:64;++s;const a=s<t.length?n[t.charAt(s)]:64;if(++s,null==e||null==r||null==o||null==a)throw new g;const c=e<<2|r>>4;if(i.push(c),64!==o){const t=r<<4&240|o>>2;if(i.push(t),64!==a){const t=o<<6&192|a;i.push(t)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class g extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const m=function(t){const e=f(t);return p.encodeByteArray(e,!0)},_=function(t){return m(t).replace(/\./g,"")},y=function(t){try{return p.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function v(t){return w(void 0,t)}function w(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)e.hasOwnProperty(n)&&b(n)&&(t[n]=w(t[n],e[n]));return t}function b(t){return"__proto__"!==t}function E(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}const C=()=>{try{return E().__FIREBASE_DEFAULTS__||(()=>{if("undefined"===typeof process)return;const t={NODE_ENV:"production",PUBLIC_URL:"/balancestracker",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"===typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const e=t&&y(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(t))}},T=t=>{const e=(t=>{var e;return null===(e=C())||void 0===e||null===(e=e.emulatorHosts)||void 0===e?void 0:e[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error("Invalid host ".concat(e," with no separate hostname and port!"));const i=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),i]:[e.substring(0,n),i]},S=()=>{var t;return null===(t=C())||void 0===t?void 0:t.config};class I{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"===typeof t&&(this.promise.catch(()=>{}),1===t.length?t(e):t(e,n))}}}function k(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch(e){return!1}}async function N(t){return(await fetch(t,{credentials:"include"})).ok}function A(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r=a({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[_(JSON.stringify({alg:"none",type:"JWT"})),_(JSON.stringify(r)),""].join(".")}const R={};let D=!1;function P(t,e){if("undefined"===typeof window||"undefined"===typeof document||!k(window.location.host)||R[t]===e||R[t]||D)return;function n(t){return"__firebase__banner__".concat(t)}R[t]=e;const i="__firebase__banner",s=function(){const t={prod:[],emulator:[]};for(const e of Object.keys(R))R[e]?t.emulator.push(e):t.prod.push(e);return t}().prod.length>0;function r(){const t=document.createElement("span");return t.style.cursor="pointer",t.style.marginLeft="16px",t.style.fontSize="24px",t.innerHTML=" &times;",t.onclick=()=>{D=!0,function(){const t=document.getElementById(i);t&&t.remove()}()},t}function o(){const t=function(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}(i),e=n("text"),o=document.getElementById(e)||document.createElement("span"),a=n("learnmore"),c=document.getElementById(a)||document.createElement("a"),l=n("preprendIcon"),h=document.getElementById(l)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.created){const e=t.element;!function(t){t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center"}(e),function(t,e){t.setAttribute("id",e),t.innerText="Learn more",t.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",t.setAttribute("target","__blank"),t.style.paddingLeft="5px",t.style.textDecoration="underline"}(c,a);const n=r();!function(t,e){t.setAttribute("width","24"),t.setAttribute("id",e),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.style.marginLeft="-6px"}(h,l),e.append(h,o,c,n),document.body.appendChild(e)}s?(o.innerText="Preview backend disconnected.",h.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(h.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',o.innerText="Preview backend running in this workspace."),o.setAttribute("id",e)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",o):o()}function x(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function O(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(x())}function M(){var t;const e=null===(t=C())||void 0===t?void 0:t.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(i){return!1}}function L(){return!0===c||!0===l}function F(){return!M()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function V(){try{return"object"===typeof indexedDB}catch(t){return!1}}class U extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,U.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,j.prototype.create)}}class j{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t){const e=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(t),i=this.errors[t],s=i?function(t,e){return t.replace(B,(t,n)=>{const i=e[n];return null!=i?String(i):"<".concat(n,"?>")})}(i,e):"Error",r="".concat(this.serviceName,": ").concat(s," (").concat(n,").");return new U(n,r,e)}}const B=/\{\$([^}]+)}/g;function q(t){return JSON.parse(t)}function H(t){return JSON.stringify(t)}const W=function(t){let e={},n={},i={},s="";try{const r=t.split(".");e=q(y(r[0])||""),n=q(y(r[1])||""),s=r[2],i=n.d||{},delete n.d}catch(r){}return{header:e,claims:n,data:i,signature:s}};function z(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function K(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function G(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Q(t,e,n){const i={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(i[s]=e.call(n,t[s],s,t));return i}function Y(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const s of n){if(!i.includes(s))return!1;const n=t[s],r=e[s];if(X(n)&&X(r)){if(!Y(n,r))return!1}else if(n!==r)return!1}for(const s of i)if(!n.includes(s))return!1;return!0}function X(t){return null!==t&&"object"===typeof t}class J{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,e){e||(e=0);const n=this.W_;if("string"===typeof t)for(let h=0;h<16;h++)n[h]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(let h=0;h<16;h++)n[h]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(let h=16;h<80;h++){const t=n[h-3]^n[h-8]^n[h-14]^n[h-16];n[h]=4294967295&(t<<1|t>>>31)}let i,s,r=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],l=this.chain_[4];for(let h=0;h<80;h++){h<40?h<20?(i=c^o&(a^c),s=1518500249):(i=o^a^c,s=1859775393):h<60?(i=o&a|c&(o|a),s=2400959708):(i=o^a^c,s=3395469782);const t=(r<<5|r>>>27)+i+l+s+n[h]&4294967295;l=c,c=a,a=4294967295&(o<<30|o>>>2),o=r,r=t}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(t,e){if(null==t)return;void 0===e&&(e=t.length);const n=e-this.blockSize;let i=0;const s=this.buf_;let r=this.inbuf_;for(;i<e;){if(0===r)for(;i<=n;)this.compress_(t,i),i+=this.blockSize;if("string"===typeof t){for(;i<e;)if(s[r]=t.charCodeAt(i),++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}else for(;i<e;)if(s[r]=t[i],++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}this.inbuf_=r,this.total_+=e}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=255&e,e/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let e=24;e>=0;e-=8)t[n]=this.chain_[i]>>e&255,++n;return t}}function $(t,e){return"".concat(t," failed: ").concat(e," argument ")}const Z=function(t){let e=0;for(let n=0;n<t.length;n++){const i=t.charCodeAt(n);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,n++):e+=3}return e};function tt(t){return t&&t._delegate?t._delegate:t}class et{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const nt="[DEFAULT]";class it{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new I;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(n){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null===t||void 0===t?void 0:t.identifier),i=null!==(e=null===t||void 0===t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(i)return null;throw s}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error("Mismatching Component ".concat(t.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:nt})}catch(e){}for(const[t,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:i});n.resolve(t)}catch(e){}}}}clearInstance(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nt;this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...t.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nt;return this.instances.has(t)}getOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nt;return this.instancesOptions.get(t)||{}}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[s,r]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(s)&&r.resolve(i)}return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&t(r,i),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch(i){}}getOrInitializeService(t){let{instanceIdentifier:e,options:n={}}=t,i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(s=e,s===nt?void 0:s),options:n}),this.instances.set(e,i),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch(r){}var s;return i||null}normalizeInstanceIdentifier(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nt;return this.component?this.component.multipleInstances?t:nt:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class st{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component ".concat(t.name," has already been registered with ").concat(this.name));e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new it(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const rt=[];var ot;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(ot||(ot={}));const at={debug:ot.DEBUG,verbose:ot.VERBOSE,info:ot.INFO,warn:ot.WARN,error:ot.ERROR,silent:ot.SILENT},ct=ot.INFO,lt={[ot.DEBUG]:"log",[ot.VERBOSE]:"log",[ot.INFO]:"info",[ot.WARN]:"warn",[ot.ERROR]:"error"},ht=function(t,e){if(e<t.logLevel)return;const n=(new Date).toISOString(),i=lt[e];if(!i)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(e,")"));for(var s=arguments.length,r=new Array(s>2?s-2:0),o=2;o<s;o++)r[o-2]=arguments[o];console[i]("[".concat(n,"]  ").concat(t.name,":"),...r)};class ut{constructor(t){this.name=t,this._logLevel=ct,this._logHandler=ht,this._userLogHandler=null,rt.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in ot))throw new TypeError('Invalid value "'.concat(t,'" assigned to `logLevel`'));this._logLevel=t}setLogLevel(t){this._logLevel="string"===typeof t?at[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!==typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ot.DEBUG,...e),this._logHandler(this,ot.DEBUG,...e)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ot.VERBOSE,...e),this._logHandler(this,ot.VERBOSE,...e)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ot.INFO,...e),this._logHandler(this,ot.INFO,...e)}warn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ot.WARN,...e),this._logHandler(this,ot.WARN,...e)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ot.ERROR,...e),this._logHandler(this,ot.ERROR,...e)}}let dt,ft;const pt=new WeakMap,gt=new WeakMap,mt=new WeakMap,_t=new WeakMap,yt=new WeakMap;let vt={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return gt.get(t);if("objectStoreNames"===e)return t.objectStoreNames||mt.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Et(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function wt(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ft||(ft=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t.apply(Ct(this),n),Et(pt.get(this))}:function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return Et(t.apply(Ct(this),n))}:function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];const r=t.call(Ct(this),e,...i);return mt.set(r,e.sort?e.sort():[e]),Et(r)}}function bt(t){return"function"===typeof t?wt(t):(t instanceof IDBTransaction&&function(t){if(gt.has(t))return;const e=new Promise((e,n)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",r),t.removeEventListener("abort",r)},s=()=>{e(),i()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",r),t.addEventListener("abort",r)});gt.set(t,e)}(t),e=t,(dt||(dt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(t,vt):t);var e}function Et(t){if(t instanceof IDBRequest)return function(t){const e=new Promise((e,n)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",r)},s=()=>{e(Et(t.result)),i()},r=()=>{n(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",r)});return e.then(e=>{e instanceof IDBCursor&&pt.set(e,t)}).catch(()=>{}),yt.set(e,t),e}(t);if(_t.has(t))return _t.get(t);const e=bt(t);return e!==t&&(_t.set(t,e),yt.set(e,t)),e}const Ct=t=>yt.get(t);const Tt=["get","getKey","getAll","getAllKeys","count"],St=["put","add","delete","clear"],It=new Map;function kt(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!==typeof e)return;if(It.get(e))return It.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,s=St.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!Tt.includes(n))return;const r=async function(t){const e=this.transaction(t,s?"readwrite":"readonly");let r=e.store;for(var o=arguments.length,a=new Array(o>1?o-1:0),c=1;c<o;c++)a[c-1]=arguments[c];return i&&(r=r.index(a.shift())),(await Promise.all([r[n](...a),s&&e.done]))[0]};return It.set(e,r),r}vt=(t=>a(a({},t),{},{get:(e,n,i)=>kt(e,n)||t.get(e,n,i),has:(e,n)=>!!kt(e,n)||t.has(e,n)}))(vt);class Nt{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null===e||void 0===e?void 0:e.type)}(t)){const e=t.getImmediate();return"".concat(e.library,"/").concat(e.version)}return null}).filter(t=>t).join(" ")}}const At="@firebase/app",Rt="0.14.5",Dt=new ut("@firebase/app"),Pt="@firebase/app-compat",xt="@firebase/analytics-compat",Ot="@firebase/analytics",Mt="@firebase/app-check-compat",Lt="@firebase/app-check",Ft="@firebase/auth",Vt="@firebase/auth-compat",Ut="@firebase/database",jt="@firebase/data-connect",Bt="@firebase/database-compat",qt="@firebase/functions",Ht="@firebase/functions-compat",Wt="@firebase/installations",zt="@firebase/installations-compat",Kt="@firebase/messaging",Gt="@firebase/messaging-compat",Qt="@firebase/performance",Yt="@firebase/performance-compat",Xt="@firebase/remote-config",Jt="@firebase/remote-config-compat",$t="@firebase/storage",Zt="@firebase/storage-compat",te="@firebase/firestore",ee="@firebase/ai",ne="@firebase/firestore-compat",ie="firebase",se="[DEFAULT]",re={[At]:"fire-core",[Pt]:"fire-core-compat",[Ot]:"fire-analytics",[xt]:"fire-analytics-compat",[Lt]:"fire-app-check",[Mt]:"fire-app-check-compat",[Ft]:"fire-auth",[Vt]:"fire-auth-compat",[Ut]:"fire-rtdb",[jt]:"fire-data-connect",[Bt]:"fire-rtdb-compat",[qt]:"fire-fn",[Ht]:"fire-fn-compat",[Wt]:"fire-iid",[zt]:"fire-iid-compat",[Kt]:"fire-fcm",[Gt]:"fire-fcm-compat",[Qt]:"fire-perf",[Yt]:"fire-perf-compat",[Xt]:"fire-rc",[Jt]:"fire-rc-compat",[$t]:"fire-gcs",[Zt]:"fire-gcs-compat",[te]:"fire-fst",[ne]:"fire-fst-compat",[ee]:"fire-vertex","fire-js":"fire-js",[ie]:"fire-js-all"},oe=new Map,ae=new Map,ce=new Map;function le(t,e){try{t.container.addComponent(e)}catch(n){Dt.debug("Component ".concat(e.name," failed to register with FirebaseApp ").concat(t.name),n)}}function he(t){const e=t.name;if(ce.has(e))return Dt.debug("There were multiple attempts to register component ".concat(e,".")),!1;ce.set(e,t);for(const n of oe.values())le(n,t);for(const n of ae.values())le(n,t);return!0}function ue(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function de(t){return null!==t&&void 0!==t&&void 0!==t.settings}const fe=new j("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class pe{constructor(t,e,n){this._isDeleted=!1,this._options=a({},t),this._config=a({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new et("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw fe.create("app-deleted",{appName:this._name})}}const ge="12.5.0";function me(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t;if("object"!==typeof e){e={name:e}}const i=a({name:se,automaticDataCollectionEnabled:!0},e),s=i.name;if("string"!==typeof s||!s)throw fe.create("bad-app-name",{appName:String(s)});if(n||(n=S()),!n)throw fe.create("no-options");const r=oe.get(s);if(r){if(Y(n,r.options)&&Y(i,r.config))return r;throw fe.create("duplicate-app",{appName:s})}const o=new st(s);for(const a of ce.values())o.addComponent(a);const c=new pe(n,i,o);return oe.set(s,c),c}function _e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se;const e=oe.get(t);if(!e&&t===se&&S())return me();if(!e)throw fe.create("no-app",{appName:t});return e}function ye(t,e,n){var i;let s=null!==(i=re[t])&&void 0!==i?i:t;n&&(s+="-".concat(n));const r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=['Unable to register library "'.concat(s,'" with version "').concat(e,'":')];return r&&t.push('library name "'.concat(s,'" contains illegal characters (whitespace or "/")')),r&&o&&t.push("and"),o&&t.push('version name "'.concat(e,'" contains illegal characters (whitespace or "/")')),void Dt.warn(t.join(" "))}he(new et("".concat(s,"-version"),()=>({library:s,version:e}),"VERSION"))}const ve="firebase-heartbeat-store";let we=null;function be(){return we||(we=function(t,e){let{blocked:n,upgrade:i,blocking:s,terminated:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=indexedDB.open(t,e),a=Et(o);return i&&o.addEventListener("upgradeneeded",t=>{i(Et(o.result),t.oldVersion,t.newVersion,Et(o.transaction),t)}),n&&o.addEventListener("blocked",t=>n(t.oldVersion,t.newVersion,t)),a.then(t=>{r&&t.addEventListener("close",()=>r()),s&&t.addEventListener("versionchange",t=>s(t.oldVersion,t.newVersion,t))}).catch(()=>{}),a}("firebase-heartbeat-database",1,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(ve)}catch(n){console.warn(n)}}}).catch(t=>{throw fe.create("idb-open",{originalErrorMessage:t.message})})),we}async function Ee(t,e){try{const n=(await be()).transaction(ve,"readwrite"),i=n.objectStore(ve);await i.put(e,Ce(t)),await n.done}catch(n){if(n instanceof U)Dt.warn(n.message);else{const t=fe.create("idb-set",{originalErrorMessage:null===n||void 0===n?void 0:n.message});Dt.warn(t.message)}}}function Ce(t){return"".concat(t.name,"!").concat(t.options.appId)}class Te{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Ie(e),this._heartbeatsCachePromise=this._storage.read().then(t=>(this._heartbeatsCache=t,t))}async triggerHeartbeat(){try{var t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Se();var e;if(null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats))if(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(t=>t.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats.length>30){const t=function(t){if(0===t.length)return-1;let e=0,n=t[0].date;for(let i=1;i<t.length;i++)t[i].date<n&&(n=t[i].date,e=i);return e}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(t,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){Dt.warn(n)}}async getHeartbeatsHeader(){try{var t;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=Se(),{heartbeatsToSend:n,unsentEntries:i}=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let i=t.slice();for(const s of t){const t=n.find(t=>t.agent===s.agent);if(t){if(t.dates.push(s.date),ke(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),ke(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),s=_(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return Dt.warn(e),""}}}function Se(){return(new Date).toISOString().substring(0,10)}class Ie{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!V()&&new Promise((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(ac){e(ac)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await be()).transaction(ve),n=await e.objectStore(ve).get(Ce(t));return await e.done,n}catch(e){if(e instanceof U)Dt.warn(e.message);else{const t=fe.create("idb-get",{originalErrorMessage:null===e||void 0===e?void 0:e.message});Dt.warn(t.message)}}}(this.app);return null!==t&&void 0!==t&&t.heartbeats?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){var e;const n=await this.read();return Ee(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){if(await this._canUseIndexedDBPromise){var e;const n=await this.read();return Ee(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function ke(t){return _(JSON.stringify({version:2,heartbeats:t})).length}var Ne;Ne="",he(new et("platform-logger",t=>new Nt(t),"PRIVATE")),he(new et("heartbeat",t=>new Te(t),"PRIVATE")),ye(At,Rt,Ne),ye(At,Rt,"esm2020"),ye("fire-js","");ye("firebase","12.5.0","app");var Ae,Re="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},De={};(function(){var t;function e(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(t,e,n){n||(n=0);const i=Array(16);if("string"===typeof e)for(var s=0;s<16;++s)i[s]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(s=0;s<16;++s)i[s]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],s=t.g[2];let r,o=t.g[3];r=e+(o^n&(s^o))+i[0]+3614090360&4294967295,r=o+(s^(e=n+(r<<7&4294967295|r>>>25))&(n^s))+i[1]+3905402710&4294967295,o=e+(r<<12&4294967295|r>>>20),r=s+(n^o&(e^n))+i[2]+606105819&4294967295,r=n+(e^(s=o+(r<<17&4294967295|r>>>15))&(o^e))+i[3]+3250441966&4294967295,r=e+(o^(n=s+(r<<22&4294967295|r>>>10))&(s^o))+i[4]+4118548399&4294967295,r=o+(s^(e=n+(r<<7&4294967295|r>>>25))&(n^s))+i[5]+1200080426&4294967295,o=e+(r<<12&4294967295|r>>>20),r=s+(n^o&(e^n))+i[6]+2821735955&4294967295,r=n+(e^(s=o+(r<<17&4294967295|r>>>15))&(o^e))+i[7]+4249261313&4294967295,r=e+(o^(n=s+(r<<22&4294967295|r>>>10))&(s^o))+i[8]+1770035416&4294967295,r=o+(s^(e=n+(r<<7&4294967295|r>>>25))&(n^s))+i[9]+2336552879&4294967295,o=e+(r<<12&4294967295|r>>>20),r=s+(n^o&(e^n))+i[10]+4294925233&4294967295,r=n+(e^(s=o+(r<<17&4294967295|r>>>15))&(o^e))+i[11]+2304563134&4294967295,r=e+(o^(n=s+(r<<22&4294967295|r>>>10))&(s^o))+i[12]+1804603682&4294967295,r=o+(s^(e=n+(r<<7&4294967295|r>>>25))&(n^s))+i[13]+4254626195&4294967295,o=e+(r<<12&4294967295|r>>>20),r=s+(n^o&(e^n))+i[14]+2792965006&4294967295,r=n+(e^(s=o+(r<<17&4294967295|r>>>15))&(o^e))+i[15]+1236535329&4294967295,r=e+(s^o&((n=s+(r<<22&4294967295|r>>>10))^s))+i[1]+4129170786&4294967295,r=o+(n^s&((e=n+(r<<5&4294967295|r>>>27))^n))+i[6]+3225465664&4294967295,o=e+(r<<9&4294967295|r>>>23),r=s+(e^n&(o^e))+i[11]+643717713&4294967295,r=n+(o^e&((s=o+(r<<14&4294967295|r>>>18))^o))+i[0]+3921069994&4294967295,r=e+(s^o&((n=s+(r<<20&4294967295|r>>>12))^s))+i[5]+3593408605&4294967295,r=o+(n^s&((e=n+(r<<5&4294967295|r>>>27))^n))+i[10]+38016083&4294967295,o=e+(r<<9&4294967295|r>>>23),r=s+(e^n&(o^e))+i[15]+3634488961&4294967295,r=n+(o^e&((s=o+(r<<14&4294967295|r>>>18))^o))+i[4]+3889429448&4294967295,r=e+(s^o&((n=s+(r<<20&4294967295|r>>>12))^s))+i[9]+568446438&4294967295,r=o+(n^s&((e=n+(r<<5&4294967295|r>>>27))^n))+i[14]+3275163606&4294967295,o=e+(r<<9&4294967295|r>>>23),r=s+(e^n&(o^e))+i[3]+4107603335&4294967295,r=n+(o^e&((s=o+(r<<14&4294967295|r>>>18))^o))+i[8]+1163531501&4294967295,r=e+(s^o&((n=s+(r<<20&4294967295|r>>>12))^s))+i[13]+2850285829&4294967295,r=o+(n^s&((e=n+(r<<5&4294967295|r>>>27))^n))+i[2]+4243563512&4294967295,o=e+(r<<9&4294967295|r>>>23),r=s+(e^n&(o^e))+i[7]+1735328473&4294967295,r=n+(o^e&((s=o+(r<<14&4294967295|r>>>18))^o))+i[12]+2368359562&4294967295,r=e+((n=s+(r<<20&4294967295|r>>>12))^s^o)+i[5]+4294588738&4294967295,r=o+((e=n+(r<<4&4294967295|r>>>28))^n^s)+i[8]+2272392833&4294967295,o=e+(r<<11&4294967295|r>>>21),r=s+(o^e^n)+i[11]+1839030562&4294967295,r=n+((s=o+(r<<16&4294967295|r>>>16))^o^e)+i[14]+4259657740&4294967295,r=e+((n=s+(r<<23&4294967295|r>>>9))^s^o)+i[1]+2763975236&4294967295,r=o+((e=n+(r<<4&4294967295|r>>>28))^n^s)+i[4]+1272893353&4294967295,o=e+(r<<11&4294967295|r>>>21),r=s+(o^e^n)+i[7]+4139469664&4294967295,r=n+((s=o+(r<<16&4294967295|r>>>16))^o^e)+i[10]+3200236656&4294967295,r=e+((n=s+(r<<23&4294967295|r>>>9))^s^o)+i[13]+681279174&4294967295,r=o+((e=n+(r<<4&4294967295|r>>>28))^n^s)+i[0]+3936430074&4294967295,o=e+(r<<11&4294967295|r>>>21),r=s+(o^e^n)+i[3]+3572445317&4294967295,r=n+((s=o+(r<<16&4294967295|r>>>16))^o^e)+i[6]+76029189&4294967295,r=e+((n=s+(r<<23&4294967295|r>>>9))^s^o)+i[9]+3654602809&4294967295,r=o+((e=n+(r<<4&4294967295|r>>>28))^n^s)+i[12]+3873151461&4294967295,o=e+(r<<11&4294967295|r>>>21),r=s+(o^e^n)+i[15]+530742520&4294967295,r=n+((s=o+(r<<16&4294967295|r>>>16))^o^e)+i[2]+3299628645&4294967295,r=e+(s^((n=s+(r<<23&4294967295|r>>>9))|~o))+i[0]+4096336452&4294967295,r=o+(n^((e=n+(r<<6&4294967295|r>>>26))|~s))+i[7]+1126891415&4294967295,o=e+(r<<10&4294967295|r>>>22),r=s+(e^(o|~n))+i[14]+2878612391&4294967295,r=n+(o^((s=o+(r<<15&4294967295|r>>>17))|~e))+i[5]+4237533241&4294967295,r=e+(s^((n=s+(r<<21&4294967295|r>>>11))|~o))+i[12]+1700485571&4294967295,r=o+(n^((e=n+(r<<6&4294967295|r>>>26))|~s))+i[3]+2399980690&4294967295,o=e+(r<<10&4294967295|r>>>22),r=s+(e^(o|~n))+i[10]+4293915773&4294967295,r=n+(o^((s=o+(r<<15&4294967295|r>>>17))|~e))+i[1]+2240044497&4294967295,r=e+(s^((n=s+(r<<21&4294967295|r>>>11))|~o))+i[8]+1873313359&4294967295,r=o+(n^((e=n+(r<<6&4294967295|r>>>26))|~s))+i[15]+4264355552&4294967295,o=e+(r<<10&4294967295|r>>>22),r=s+(e^(o|~n))+i[6]+2734768916&4294967295,r=n+(o^((s=o+(r<<15&4294967295|r>>>17))|~e))+i[13]+1309151649&4294967295,r=e+(s^((n=s+(r<<21&4294967295|r>>>11))|~o))+i[4]+4149444226&4294967295,r=o+(n^((e=n+(r<<6&4294967295|r>>>26))|~s))+i[11]+3174756917&4294967295,o=e+(r<<10&4294967295|r>>>22),r=s+(e^(o|~n))+i[2]+718787259&4294967295,r=n+(o^((s=o+(r<<15&4294967295|r>>>17))|~e))+i[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(s+(r<<21&4294967295|r>>>11))&4294967295,t.g[2]=t.g[2]+s&4294967295,t.g[3]=t.g[3]+o&4294967295}function i(t,e){this.h=e;const n=[];let i=!0;for(let s=t.length-1;s>=0;s--){const r=0|t[s];i&&r==e||(n[s]=r,i=!1)}this.g=n}!function(t,e){function n(){}n.prototype=e.prototype,t.F=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.D=function(t,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return e.prototype[n].apply(t,s)}}(e,function(){this.blockSize=-1}),e.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.v=function(t,e){void 0===e&&(e=t.length);const i=e-this.blockSize,s=this.C;let r=this.h,o=0;for(;o<e;){if(0==r)for(;o<=i;)n(this,t,o),o+=this.blockSize;if("string"===typeof t){for(;o<e;)if(s[r++]=t.charCodeAt(o++),r==this.blockSize){n(this,s),r=0;break}}else for(;o<e;)if(s[r++]=t[o++],r==this.blockSize){n(this,s),r=0;break}}this.h=r,this.o+=e},e.prototype.A=function(){var t=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;e=8*this.o;for(var n=t.length-8;n<t.length;++n)t[n]=255&e,e/=256;for(this.v(t),t=Array(16),e=0,n=0;n<4;++n)for(let i=0;i<32;i+=8)t[e++]=this.g[n]>>>i&255;return t};var s={};function r(t){return-128<=t&&t<128?function(t,e){var n=s;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(t){return new i([0|t],t<0?-1:0)}):new i([0|t],t<0?-1:0)}function o(t){if(isNaN(t)||!isFinite(t))return a;if(t<0)return d(o(-t));const e=[];let n=1;for(let i=0;t>=n;i++)e[i]=t/n|0,n*=4294967296;return new i(e,0)}var a=r(0),c=r(1),l=r(16777216);function h(t){if(0!=t.h)return!1;for(let e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function u(t){return-1==t.h}function d(t){const e=t.g.length,n=[];for(let i=0;i<e;i++)n[i]=~t.g[i];return new i(n,~t.h).add(c)}function f(t,e){return t.add(d(e))}function p(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function g(t,e){this.g=t,this.h=e}function m(t,e){if(h(e))throw Error("division by zero");if(h(t))return new g(a,a);if(u(t))return e=m(d(t),e),new g(d(e.g),d(e.h));if(u(e))return e=m(t,d(e)),new g(d(e.g),e.h);if(t.g.length>30){if(u(t)||u(e))throw Error("slowDivide_ only works with positive integers.");for(var n=c,i=e;i.l(t)<=0;)n=_(n),i=_(i);var s=y(n,1),r=y(i,1);for(i=y(i,2),n=y(n,2);!h(i);){var l=r.add(i);l.l(t)<=0&&(s=s.add(n),r=l),i=y(i,1),n=y(n,1)}return e=f(t,s.j(e)),new g(s,e)}for(s=a;t.l(e)>=0;){for(n=Math.max(1,Math.floor(t.m()/e.m())),i=(i=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,i-48),l=(r=o(n)).j(e);u(l)||l.l(t)>0;)l=(r=o(n-=i)).j(e);h(r)&&(r=c),s=s.add(r),t=f(t,l)}return new g(s,t)}function _(t){const e=t.g.length+1,n=[];for(let i=0;i<e;i++)n[i]=t.i(i)<<1|t.i(i-1)>>>31;return new i(n,t.h)}function y(t,e){const n=e>>5;e%=32;const s=t.g.length-n,r=[];for(let i=0;i<s;i++)r[i]=e>0?t.i(i+n)>>>e|t.i(i+n+1)<<32-e:t.i(i+n);return new i(r,t.h)}(t=i.prototype).m=function(){if(u(this))return-d(this).m();let t=0,e=1;for(let n=0;n<this.g.length;n++){const i=this.i(n);t+=(i>=0?i:4294967296+i)*e,e*=4294967296}return t},t.toString=function(t){if((t=t||10)<2||36<t)throw Error("radix out of range: "+t);if(h(this))return"0";if(u(this))return"-"+d(this).toString(t);const e=o(Math.pow(t,6));var n=this;let i="";for(;;){const s=m(n,e).g;let r=(((n=f(n,s.j(e))).g.length>0?n.g[0]:n.h)>>>0).toString(t);if(h(n=s))return r+i;for(;r.length<6;)r="0"+r;i=r+i}},t.i=function(t){return t<0?0:t<this.g.length?this.g[t]:this.h},t.l=function(t){return u(t=f(this,t))?-1:h(t)?0:1},t.abs=function(){return u(this)?d(this):this},t.add=function(t){const e=Math.max(this.g.length,t.g.length),n=[];let s=0;for(let i=0;i<=e;i++){let e=s+(65535&this.i(i))+(65535&t.i(i)),r=(e>>>16)+(this.i(i)>>>16)+(t.i(i)>>>16);s=r>>>16,e&=65535,r&=65535,n[i]=r<<16|e}return new i(n,-2147483648&n[n.length-1]?-1:0)},t.j=function(t){if(h(this)||h(t))return a;if(u(this))return u(t)?d(this).j(d(t)):d(d(this).j(t));if(u(t))return d(this.j(d(t)));if(this.l(l)<0&&t.l(l)<0)return o(this.m()*t.m());const e=this.g.length+t.g.length,n=[];for(var s=0;s<2*e;s++)n[s]=0;for(s=0;s<this.g.length;s++)for(let e=0;e<t.g.length;e++){const i=this.i(s)>>>16,r=65535&this.i(s),o=t.i(e)>>>16,a=65535&t.i(e);n[2*s+2*e]+=r*a,p(n,2*s+2*e),n[2*s+2*e+1]+=i*a,p(n,2*s+2*e+1),n[2*s+2*e+1]+=r*o,p(n,2*s+2*e+1),n[2*s+2*e+2]+=i*o,p(n,2*s+2*e+2)}for(t=0;t<e;t++)n[t]=n[2*t+1]<<16|n[2*t];for(t=e;t<2*e;t++)n[t]=0;return new i(n,0)},t.B=function(t){return m(this,t).h},t.and=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let i=0;i<e;i++)n[i]=this.i(i)&t.i(i);return new i(n,this.h&t.h)},t.or=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let i=0;i<e;i++)n[i]=this.i(i)|t.i(i);return new i(n,this.h|t.h)},t.xor=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let i=0;i<e;i++)n[i]=this.i(i)^t.i(i);return new i(n,this.h^t.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,De.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=o,i.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return d(t(e.substring(1),n));if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character');const i=o(Math.pow(n,8));let s=a;for(let a=0;a<e.length;a+=8){var r=Math.min(8,e.length-a);const t=parseInt(e.substring(a,a+r),n);r<8?(r=o(Math.pow(n,r)),s=s.j(r).add(o(t))):(s=s.j(i),s=s.add(o(t)))}return s},Ae=De.Integer=i}).apply("undefined"!==typeof Re?Re:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var Pe,xe,Oe,Me,Le,Fe,Ve,Ue,je="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},Be={};(function(){var t,e=Object.defineProperty;var n=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof je&&je];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function i(t,i){if(i)t:{var s=n;t=t.split(".");for(var r=0;r<t.length-1;r++){var o=t[r];if(!(o in s))break t;s=s[o]}(i=i(r=s[t=t[t.length-1]]))!=r&&null!=i&&e(s,t,{configurable:!0,writable:!0,value:i})}}i("Symbol.dispose",function(t){return t||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(t){return t||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(t){return t||function(t){var e,n=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.push([e,t[e]]);return n}});var s=s||{},r=this||self;function o(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function a(t,e,n){return t.call.apply(t.bind,arguments)}function c(t,e,n){return(c=a).apply(null,arguments)}function l(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function h(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Ob=function(t,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return e.prototype[n].apply(t,s)}}var u="undefined"!==typeof AsyncContext&&"function"===typeof AsyncContext.Snapshot?t=>t&&AsyncContext.Snapshot.wrap(t):t=>t;function d(t){const e=t.length;if(e>0){const n=Array(e);for(let i=0;i<e;i++)n[i]=t[i];return n}return[]}function f(t,e){for(let i=1;i<arguments.length;i++){const e=arguments[i];var n=typeof e;if("array"==(n="object"!=n?n:e?Array.isArray(e)?"array":n:"null")||"object"==n&&"number"==typeof e.length){n=t.length||0;const i=e.length||0;t.length=n+i;for(let s=0;s<i;s++)t[n+s]=e[s]}else t.push(e)}}function p(t){r.setTimeout(()=>{throw t},0)}function g(){var t=w;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var m=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return this.h>0?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}(()=>new _,t=>t.reset());class _{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}let y,v=!1,w=new class{constructor(){this.h=this.g=null}add(t,e){const n=m.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},b=()=>{const t=Promise.resolve(void 0);y=()=>{t.then(E)}};function E(){for(var t;t=g();){try{t.h.call(t.g)}catch(n){p(n)}var e=m;e.j(t),e.h<100&&(e.h++,t.next=e.g,e.g=t)}v=!1}function C(){this.u=this.u,this.C=this.C}function T(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}C.prototype.u=!1,C.prototype.dispose=function(){this.u||(this.u=!0,this.N())},C.prototype[Symbol.dispose]=function(){this.dispose()},C.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},T.prototype.h=function(){this.defaultPrevented=!0};var S=function(){if(!r.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};r.addEventListener("test",t,e),r.removeEventListener("test",t,e)}catch(n){}return t}();function I(t){return/^[\s\xa0]*$/.test(t)}function k(t,e){T.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t&&this.init(t,e)}h(k,T),k.prototype.init=function(t,e){const n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;this.target=t.target||t.srcElement,this.g=e,(e=t.relatedTarget)||("mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement)),this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=t.pointerType,this.state=t.state,this.i=t,t.defaultPrevented&&k.Z.h.call(this)},k.prototype.h=function(){k.Z.h.call(this);const t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var N="closure_listenable_"+(1e6*Math.random()|0),A=0;function R(t,e,n,i,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.ha=s,this.key=++A,this.da=this.fa=!1}function D(t){t.da=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function P(t,e,n){for(const i in t)e.call(n,t[i],i,t)}function x(t){const e={};for(const n in t)e[n]=t[n];return e}const O="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function M(t,e){let n,i;for(let s=1;s<arguments.length;s++){for(n in i=arguments[s],i)t[n]=i[n];for(let e=0;e<O.length;e++)n=O[e],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function L(t){this.src=t,this.g={},this.h=0}function F(t,e){const n=e.type;if(n in t.g){var i,s=t.g[n],r=Array.prototype.indexOf.call(s,e,void 0);(i=r>=0)&&Array.prototype.splice.call(s,r,1),i&&(D(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function V(t,e,n,i){for(let s=0;s<t.length;++s){const r=t[s];if(!r.da&&r.listener==e&&r.capture==!!n&&r.ha==i)return s}return-1}L.prototype.add=function(t,e,n,i,s){const r=t.toString();(t=this.g[r])||(t=this.g[r]=[],this.h++);const o=V(t,e,i,s);return o>-1?(e=t[o],n||(e.fa=!1)):((e=new R(e,this.src,r,!!i,s)).fa=n,t.push(e)),e};var U="closure_lm_"+(1e6*Math.random()|0),j={};function B(t,e,n,i,s){if(i&&i.once)return H(t,e,n,i,s);if(Array.isArray(e)){for(let r=0;r<e.length;r++)B(t,e[r],n,i,s);return null}return n=X(n),t&&t[N]?t.J(e,n,o(i)?!!i.capture:!!i,s):q(t,e,n,!1,i,s)}function q(t,e,n,i,s,r){if(!e)throw Error("Invalid event type");const a=o(s)?!!s.capture:!!s;let c=Q(t);if(c||(t[U]=c=new L(t)),(n=c.add(e,n,i,a,r)).proxy)return n;if(i=function(){function t(n){return e.call(t.src,t.listener,n)}const e=G;return t}(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)S||(s=a),void 0===s&&(s=!1),t.addEventListener(e.toString(),i,s);else if(t.attachEvent)t.attachEvent(K(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}return n}function H(t,e,n,i,s){if(Array.isArray(e)){for(let r=0;r<e.length;r++)H(t,e[r],n,i,s);return null}return n=X(n),t&&t[N]?t.K(e,n,o(i)?!!i.capture:!!i,s):q(t,e,n,!0,i,s)}function W(t,e,n,i,s){if(Array.isArray(e))for(var r=0;r<e.length;r++)W(t,e[r],n,i,s);else i=o(i)?!!i.capture:!!i,n=X(n),t&&t[N]?(t=t.i,(r=String(e).toString())in t.g&&((n=V(e=t.g[r],n,i,s))>-1&&(D(e[n]),Array.prototype.splice.call(e,n,1),0==e.length&&(delete t.g[r],t.h--)))):t&&(t=Q(t))&&(e=t.g[e.toString()],t=-1,e&&(t=V(e,n,i,s)),(n=t>-1?e[t]:null)&&z(n))}function z(t){if("number"!==typeof t&&t&&!t.da){var e=t.src;if(e&&e[N])F(e.i,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(K(n),i):e.addListener&&e.removeListener&&e.removeListener(i),(n=Q(e))?(F(n,t),0==n.h&&(n.src=null,e[U]=null)):D(t)}}}function K(t){return t in j?j[t]:j[t]="on"+t}function G(t,e){if(t.da)t=!0;else{e=new k(e,this);const n=t.listener,i=t.ha||t.src;t.fa&&z(t),t=n.call(i,e)}return t}function Q(t){return(t=t[U])instanceof L?t:null}var Y="__closure_events_fn_"+(1e9*Math.random()>>>0);function X(t){return"function"===typeof t?t:(t[Y]||(t[Y]=function(e){return t.handleEvent(e)}),t[Y])}function J(){C.call(this),this.i=new L(this),this.M=this,this.G=null}function $(t,e){var n,i=t.G;if(i)for(n=[];i;i=i.G)n.push(i);if(t=t.M,i=e.type||e,"string"===typeof e)e=new T(e,t);else if(e instanceof T)e.target=e.target||t;else{var s=e;M(e=new T(i,t),s)}let r,o;if(s=!0,n)for(o=n.length-1;o>=0;o--)r=e.g=n[o],s=Z(r,i,!0,e)&&s;if(r=e.g=t,s=Z(r,i,!0,e)&&s,s=Z(r,i,!1,e)&&s,n)for(o=0;o<n.length;o++)r=e.g=n[o],s=Z(r,i,!1,e)&&s}function Z(t,e,n,i){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();let s=!0;for(let r=0;r<e.length;++r){const o=e[r];if(o&&!o.da&&o.capture==n){const e=o.listener,n=o.ha||o.src;o.fa&&F(t.i,o),s=!1!==e.call(n,i)&&s}}return s&&!i.defaultPrevented}function tt(t){t.g=function(t,e){if("function"!==typeof t){if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=c(t.handleEvent,t)}return Number(e)>2147483647?-1:r.setTimeout(t,e||0)}(()=>{t.g=null,t.i&&(t.i=!1,tt(t))},t.l);const e=t.h;t.h=null,t.m.apply(null,e)}h(J,C),J.prototype[N]=!0,J.prototype.removeEventListener=function(t,e,n,i){W(this,t,e,n,i)},J.prototype.N=function(){if(J.Z.N.call(this),this.i){var t=this.i;for(const e in t.g){const n=t.g[e];for(let t=0;t<n.length;t++)D(n[t]);delete t.g[e],t.h--}}this.G=null},J.prototype.J=function(t,e,n,i){return this.i.add(String(t),e,!1,n,i)},J.prototype.K=function(t,e,n,i){return this.i.add(String(t),e,!0,n,i)};class et extends C{constructor(t,e){super(),this.m=t,this.l=e,this.h=null,this.i=!1,this.g=null}j(t){this.h=arguments,this.g?this.i=!0:tt(this)}N(){super.N(),this.g&&(r.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function nt(t){C.call(this),this.h=t,this.g={}}h(nt,C);var it=[];function st(t){P(t.g,function(t,e){this.g.hasOwnProperty(e)&&z(t)},t),t.g={}}nt.prototype.N=function(){nt.Z.N.call(this),st(this)},nt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var rt=r.JSON.stringify,ot=r.JSON.parse,at=class{stringify(t){return r.JSON.stringify(t,void 0)}parse(t){return r.JSON.parse(t,void 0)}};function ct(){}function lt(){}var ht={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ut(){T.call(this,"d")}function dt(){T.call(this,"c")}h(ut,T),h(dt,T);var ft={},pt=null;function gt(){return pt=pt||new J}function mt(t){T.call(this,ft.Ia,t)}function _t(t){const e=gt();$(e,new mt(e))}function yt(t,e){T.call(this,ft.STAT_EVENT,t),this.stat=e}function vt(t){const e=gt();$(e,new yt(e,t))}function wt(t,e){T.call(this,ft.Ja,t),this.size=e}function bt(t,e){if("function"!==typeof t)throw Error("Fn must not be null and must be a function");return r.setTimeout(function(){t()},e)}function Et(){this.g=!0}function Ct(t,e,n,i){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{const r=JSON.parse(e);if(r)for(t=0;t<r.length;t++)if(Array.isArray(r[t])){var n=r[t];if(!(n.length<2)){var i=n[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(let t=1;t<i.length;t++)i[t]=""}}}return rt(r)}catch(r){return e}}(t,n)+(i?" "+i:"")})}ft.Ia="serverreachability",h(mt,T),ft.STAT_EVENT="statevent",h(yt,T),ft.Ja="timingevent",h(wt,T),Et.prototype.ua=function(){this.g=!1},Et.prototype.info=function(){};var Tt,St={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},It={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function kt(){}function Nt(t){return encodeURIComponent(String(t))}function At(t){var e=1;t=t.split(":");const n=[];for(;e>0&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function Rt(t,e,n,i){this.j=t,this.i=e,this.l=n,this.S=i||1,this.V=new nt(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Dt}function Dt(){this.i=null,this.g="",this.h=!1}h(kt,ct),kt.prototype.g=function(){return new XMLHttpRequest},Tt=new kt;var Pt={},xt={};function Ot(t,e,n){t.M=1,t.A=re(te(e)),t.u=n,t.R=!0,Mt(t,null)}function Mt(t,e){t.F=Date.now(),Vt(t),t.B=te(t.A);var n=t.B,i=t.S;Array.isArray(i)||(i=[String(i)]),ve(n.i,"t",i),t.C=0,n=t.j.L,t.h=new Dt,t.g=_n(t.j,n?e:null,!t.u),t.P>0&&(t.O=new et(c(t.Y,t,t.g),t.P)),e=t.V,n=t.g,i=t.ba;var s="readystatechange";Array.isArray(s)||(s&&(it[0]=s.toString()),s=it);for(let r=0;r<s.length;r++){const t=B(n,s[r],i||e.handleEvent,!1,e.h||e);if(!t)break;e.g[t.key]=t}e=t.J?x(t.J):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.B,t.v,t.u,e)):(t.v="GET",t.g.ea(t.B,t.v,null,e)),_t(),function(t,e,n,i,s,r){t.info(function(){if(t.g)if(r){var o="",a=r.split("&");for(let t=0;t<a.length;t++){var c=a[t].split("=");if(c.length>1){const t=c[0];c=c[1];const e=t.split("_");o=e.length>=2&&"type"==e[1]?o+(t+"=")+c+"&":o+(t+"=redacted&")}}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o})}(t.i,t.v,t.B,t.l,t.S,t.u)}function Lt(t){return!!t.g&&("GET"==t.v&&2!=t.M&&t.j.Aa)}function Ft(t,e){var n=t.C,i=e.indexOf("\n",n);return-1==i?xt:(n=Number(e.substring(n,i)),isNaN(n)?Pt:(i+=1)+n>e.length?xt:(e=e.slice(i,i+n),t.C=i+n,e))}function Vt(t){t.T=Date.now()+t.H,Ut(t,t.H)}function Ut(t,e){if(null!=t.D)throw Error("WatchDog timer not null");t.D=bt(c(t.aa,t),e)}function jt(t){t.D&&(r.clearTimeout(t.D),t.D=null)}function Bt(t){0==t.j.I||t.K||dn(t.j,t)}function qt(t){jt(t);var e=t.O;e&&"function"==typeof e.dispose&&e.dispose(),t.O=null,st(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.dispose())}function Ht(t,e){try{var n=t.j;if(0!=n.I&&(n.g==t||Qt(n.h,t)))if(!t.L&&Qt(n.h,t)&&3==n.I){try{var i=n.Ba.g.parse(e)}catch(h){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){t:if(!n.v){if(n.g){if(!(n.g.F+3e3<t.F))break t;un(n),tn(n)}cn(n),vt(18)}}else n.xa=s[1],0<n.xa-n.K&&s[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=bt(c(n.Va,n),6e3));Gt(n.h)<=1&&n.ta&&(n.ta=void 0)}else pn(n,11)}else if((t.L||n.g==t)&&un(n),!I(e))for(s=n.Ba.g.parse(e),e=0;e<s.length;e++){let c=s[e];const h=c[0];if(!(h<=n.K))if(n.K=h,c=c[1],2==n.I)if("c"==c[0]){n.M=c[1],n.ba=c[2];const e=c[3];null!=e&&(n.ka=e,n.j.info("VER="+n.ka));const s=c[4];null!=s&&(n.za=s,n.j.info("SVER="+n.za));const h=c[5];null!=h&&"number"===typeof h&&h>0&&(i=1.5*h,n.O=i,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;const u=t.g;if(u){const t=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=i.h;r.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(Yt(r,r.h),r.h=null))}if(i.G){const t=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(i.wa=t,se(i.J,i.G,t))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-t.F,n.j.info("Handshake RTT: "+n.T+"ms"));var o=t;if((i=n).na=mn(i,i.L?i.ba:null,i.W),o.L){Xt(i.h,o);var a=o,l=i.O;l&&(a.H=l),a.D&&(jt(a),Vt(a)),i.g=o}else an(i);n.i.length>0&&nn(n)}else"stop"!=c[0]&&"close"!=c[0]||pn(n,7);else 3==n.I&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?pn(n,7):Ze(n):"noop"!=c[0]&&n.l&&n.l.qa(c),n.A=0)}_t()}catch(h){}}Rt.prototype.ba=function(t){t=t.target;const e=this.O;e&&3==Ye(t)?e.j():this.Y(t)},Rt.prototype.Y=function(t){try{if(t==this.g)t:{const c=Ye(this.g),l=this.g.ya();this.g.ca();if(!(c<3)&&(3!=c||this.g&&(this.h.h||this.g.la()||Xe(this.g)))){this.K||4!=c||7==l||_t(),jt(this);var e=this.g.ca();this.X=e;var n=function(t){if(!Lt(t))return t.g.la();const e=Xe(t.g);if(""===e)return"";let n="";const i=e.length,s=4==Ye(t.g);if(!t.h.i){if("undefined"===typeof TextDecoder)return qt(t),Bt(t),"";t.h.i=new r.TextDecoder}for(let r=0;r<i;r++)t.h.h=!0,n+=t.h.i.decode(e[r],{stream:!(s&&r==i-1)});return e.length=0,t.h.g+=n,t.C=0,t.h.g}(this);if(this.o=200==e,function(t,e,n,i,s,r,o){t.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+r+" "+o})}(this.i,this.v,this.B,this.l,this.S,c,e),this.o){if(this.U&&!this.L){e:{if(this.g){var i,s=this.g;if((i=s.g?s.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(i)){var o=i;break e}}o=null}if(!(t=o)){this.o=!1,this.m=3,vt(12),qt(this),Bt(this);break t}Ct(this.i,this.l,t,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ht(this,t)}if(this.R){let e;for(t=!0;!this.K&&this.C<n.length;){if(e=Ft(this,n),e==xt){4==c&&(this.m=4,vt(14),t=!1),Ct(this.i,this.l,null,"[Incomplete Response]");break}if(e==Pt){this.m=4,vt(15),Ct(this.i,this.l,n,"[Invalid Chunk]"),t=!1;break}Ct(this.i,this.l,e,null),Ht(this,e)}if(Lt(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=c||0!=n.length||this.h.h||(this.m=1,vt(16),t=!1),this.o=this.o&&t,t){if(n.length>0&&!this.W){this.W=!0;var a=this.j;a.g==this&&a.aa&&!a.P&&(a.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),ln(a),a.P=!0,vt(11))}}else Ct(this.i,this.l,n,"[Invalid Chunked Response]"),qt(this),Bt(this)}else Ct(this.i,this.l,n,null),Ht(this,n);4==c&&qt(this),this.o&&!this.K&&(4==c?dn(this.j,this):(this.o=!1,Vt(this)))}else(function(t){const e={};t=(t.g&&Ye(t)>=2&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<t.length;i++){if(I(t[i]))continue;var n=At(t[i]);const s=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const r=e[s]||[];e[s]=r,r.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,function(t){return t.join(", ")})})(this.g),400==e&&n.indexOf("Unknown SID")>0?(this.m=3,vt(12)):(this.m=0,vt(13)),qt(this),Bt(this)}}}catch(En){}},Rt.prototype.cancel=function(){this.K=!0,qt(this)},Rt.prototype.aa=function(){this.D=null;const t=Date.now();t-this.T>=0?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.i,this.B),2!=this.M&&(_t(),vt(17)),qt(this),this.m=2,Bt(this)):Ut(this,this.T-t)};var Wt=class{constructor(t,e){this.g=t,this.map=e}};function zt(t){this.l=t||10,r.PerformanceNavigationTiming?t=(t=r.performance.getEntriesByType("navigation")).length>0&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(r.chrome&&r.chrome.loadTimes&&r.chrome.loadTimes()&&r.chrome.loadTimes().wasFetchedViaSpdy),this.j=t?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Kt(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Gt(t){return t.h?1:t.g?t.g.size:0}function Qt(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Yt(t,e){t.g?t.g.add(e):t.h=e}function Xt(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Jt(t){if(null!=t.h)return t.i.concat(t.h.G);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.G);return e}return d(t.i)}zt.prototype.cancel=function(){if(this.i=Jt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var $t=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Zt(t){let e;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,t instanceof Zt?(this.l=t.l,ee(this,t.j),this.o=t.o,this.g=t.g,ne(this,t.u),this.h=t.h,ie(this,we(t.i)),this.m=t.m):t&&(e=String(t).match($t))?(this.l=!1,ee(this,e[1]||"",!0),this.o=oe(e[2]||""),this.g=oe(e[3]||"",!0),ne(this,e[4]),this.h=oe(e[5]||"",!0),ie(this,e[6]||"",!0),this.m=oe(e[7]||"")):(this.l=!1,this.i=new pe(null,this.l))}function te(t){return new Zt(t)}function ee(t,e,n){t.j=n?oe(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function ne(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.u=e}else t.u=null}function ie(t,e,n){e instanceof pe?(t.i=e,function(t,e){e&&!t.j&&(ge(t),t.i=null,t.g.forEach(function(t,e){const n=e.toLowerCase();e!=n&&(me(this,e),ve(this,n,t))},t)),t.j=e}(t.i,t.l)):(n||(e=ae(e,de)),t.i=new pe(e,t.l))}function se(t,e,n){t.i.set(e,n)}function re(t){return se(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function oe(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ae(t,e,n){return"string"===typeof t?(t=encodeURI(t).replace(e,ce),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ce(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Zt.prototype.toString=function(){const t=[];var e=this.j;e&&t.push(ae(e,le,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(ae(e,le,!0),"@"),t.push(Nt(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&t.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(ae(n,"/"==n.charAt(0)?ue:he,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.m)&&t.push("#",ae(n,fe)),t.join("")},Zt.prototype.resolve=function(t){const e=te(this);let n=!!t.j;n?ee(e,t.j):n=!!t.o,n?e.o=t.o:n=!!t.g,n?e.g=t.g:n=null!=t.u;var i=t.h;if(n)ne(e,t.u);else if(n=!!t.h){if("/"!=i.charAt(0))if(this.g&&!this.h)i="/"+i;else{var s=e.h.lastIndexOf("/");-1!=s&&(i=e.h.slice(0,s+1)+i)}if(".."==(s=i)||"."==s)i="";else if(-1!=s.indexOf("./")||-1!=s.indexOf("/.")){i=0==s.lastIndexOf("/",0),s=s.split("/");const t=[];for(let e=0;e<s.length;){const n=s[e++];"."==n?i&&e==s.length&&t.push(""):".."==n?((t.length>1||1==t.length&&""!=t[0])&&t.pop(),i&&e==s.length&&t.push("")):(t.push(n),i=!0)}i=t.join("/")}else i=s}return n?e.h=i:n=""!==t.i.toString(),n?ie(e,we(t.i)):n=!!t.m,n&&(e.m=t.m),e};var le=/[#\/\?@]/g,he=/[#\?:]/g,ue=/[#\?]/g,de=/[#\?@]/g,fe=/#/g;function pe(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function ge(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(let n=0;n<t.length;n++){const i=t[n].indexOf("=");let s,r=null;i>=0?(s=t[n].substring(0,i),r=t[n].substring(i+1)):s=t[n],e(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function me(t,e){ge(t),e=be(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function _e(t,e){return ge(t),e=be(t,e),t.g.has(e)}function ye(t,e){ge(t);let n=[];if("string"===typeof e)_e(t,e)&&(n=n.concat(t.g.get(be(t,e))));else for(t=Array.from(t.g.values()),e=0;e<t.length;e++)n=n.concat(t[e]);return n}function ve(t,e,n){me(t,e),n.length>0&&(t.i=null,t.g.set(be(t,e),d(n)),t.h+=n.length)}function we(t){const e=new pe;return e.i=t.i,t.g&&(e.g=new Map(t.g),e.h=t.h),e}function be(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Ee(t,e,n,i,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),i(n)}catch(r){}}function Ce(){this.g=new at}function Te(t){this.i=t.Sb||null,this.h=t.ab||!1}function Se(t,e){J.call(this),this.H=t,this.o=e,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function Ie(t){t.j.read().then(t.Ma.bind(t)).catch(t.ga.bind(t))}function ke(t){t.readyState=4,t.l=null,t.j=null,t.B=null,Ne(t)}function Ne(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Ae(t){let e="";return P(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}function Re(t,e,n){t:{for(i in n){var i=!1;break t}i=!0}i||(n=Ae(n),"string"===typeof t?null!=n&&Nt(n):se(t,e,n))}function De(t){J.call(this),this.headers=new Map,this.L=t||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=pe.prototype).add=function(t,e){ge(this),this.i=null,t=be(this,t);let n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},t.forEach=function(t,e){ge(this),this.g.forEach(function(n,i){n.forEach(function(n){t.call(e,n,i,this)},this)},this)},t.set=function(t,e){return ge(this),this.i=null,_e(this,t=be(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},t.get=function(t,e){return t&&(t=ye(this,t)).length>0?String(t[0]):e},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(let i=0;i<e.length;i++){var n=e[i];const s=Nt(n);n=ye(this,n);for(let e=0;e<n.length;e++){let i=s;""!==n[e]&&(i+="="+Nt(n[e])),t.push(i)}}return this.i=t.join("&")},h(Te,ct),Te.prototype.g=function(){return new Se(this.i,this.h)},h(Se,J),(t=Se.prototype).open=function(t,e){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=t,this.D=e,this.readyState=1,Ne(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const e={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};t&&(e.body=t),(this.H||r).fetch(new Request(this.D,e)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,ke(this)),this.readyState=0},t.Pa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Ne(this)),this.g&&(this.readyState=3,Ne(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if("undefined"!==typeof r.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ie(this)}else t.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(t){if(this.g){if(this.o&&t.value)this.response.push(t.value);else if(!this.o){var e=t.value?t.value:new Uint8Array(0);(e=this.B.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?ke(this):Ne(this),3==this.readyState&&Ie(this)}},t.Oa=function(t){this.g&&(this.response=this.responseText=t,ke(this))},t.Na=function(t){this.g&&(this.response=t,ke(this))},t.ga=function(){this.g&&ke(this)},t.setRequestHeader=function(t,e){this.A.append(t,e)},t.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Se.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}}),h(De,J);var qe=/^https?$/i,We=["POST","PUT"];function ze(t,e){t.h=!1,t.g&&(t.j=!0,t.g.abort(),t.j=!1),t.l=e,t.o=5,Ke(t),Qe(t)}function Ke(t){t.A||(t.A=!0,$(t,"complete"),$(t,"error"))}function Ge(t){if(t.h&&"undefined"!=typeof s)if(t.v&&4==Ye(t))setTimeout(t.Ca.bind(t),0);else if($(t,"readystatechange"),4==Ye(t)){t.h=!1;try{const s=t.ca();t:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var i;if(i=0===s){let e=String(t.D).match($t)[1]||null;!e&&r.self&&r.self.location&&(e=r.self.location.protocol.slice(0,-1)),i=!qe.test(e?e.toLowerCase():"")}n=i}if(n)$(t,"complete"),$(t,"success");else{t.o=6;try{var o=Ye(t)>2?t.g.statusText:""}catch(a){o=""}t.l=o+" ["+t.ca()+"]",Ke(t)}}finally{Qe(t)}}}function Qe(t,e){if(t.g){t.m&&(clearTimeout(t.m),t.m=null);const i=t.g;t.g=null,e||$(t,"ready");try{i.onreadystatechange=null}catch(n){}}}function Ye(t){return t.g?t.g.readyState:0}function Xe(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.F){case"":case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Je(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function $e(t){this.za=0,this.i=[],this.j=new Et,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Je("failFast",!1,t),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Je("baseRetryDelayMs",5e3,t),this.Za=Je("retryDelaySeedMs",1e4,t),this.Ta=Je("forwardChannelMaxRetries",2,t),this.va=Je("forwardChannelRequestTimeoutMs",2e4,t),this.ma=t&&t.xmlHttpFactory||void 0,this.Ua=t&&t.Rb||void 0,this.Aa=t&&t.useFetchStreams||!1,this.O=void 0,this.L=t&&t.supportsCrossDomainXhr||!1,this.M="",this.h=new zt(t&&t.concurrentRequestLimit),this.Ba=new Ce,this.S=t&&t.fastHandshake||!1,this.R=t&&t.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=t&&t.Pb||!1,t&&t.ua&&this.j.ua(),t&&t.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&t&&t.detectBufferingProxy||!1,this.ia=void 0,t&&t.longPollingTimeout&&t.longPollingTimeout>0&&(this.ia=t.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function Ze(t){if(en(t),3==t.I){var e=t.V++,n=te(t.J);if(se(n,"SID",t.M),se(n,"RID",e),se(n,"TYPE","terminate"),rn(t,n),(e=new Rt(t,t.j,e)).M=2,e.A=re(te(n)),n=!1,r.navigator&&r.navigator.sendBeacon)try{n=r.navigator.sendBeacon(e.A.toString(),"")}catch(i){}!n&&r.Image&&((new Image).src=e.A,n=!0),n||(e.g=_n(e.j,null),e.g.ea(e.A)),e.F=Date.now(),Vt(e)}gn(t)}function tn(t){t.g&&(ln(t),t.g.cancel(),t.g=null)}function en(t){tn(t),t.v&&(r.clearTimeout(t.v),t.v=null),un(t),t.h.cancel(),t.m&&("number"===typeof t.m&&r.clearTimeout(t.m),t.m=null)}function nn(t){if(!Kt(t.h)&&!t.m){t.m=!0;var e=t.Ea;y||b(),v||(y(),v=!0),w.add(e,t),t.D=0}}function sn(t,e){var n;n=e?e.l:t.V++;const i=te(t.J);se(i,"SID",t.M),se(i,"RID",n),se(i,"AID",t.K),rn(t,i),t.u&&t.o&&Re(i,t.u,t.o),n=new Rt(t,t.j,n,t.D+1),null===t.u&&(n.J=t.o),e&&(t.i=e.G.concat(t.i)),e=on(t,n,1e3),n.H=Math.round(.5*t.va)+Math.round(.5*t.va*Math.random()),Yt(t.h,n),Ot(n,i,e)}function rn(t,e){t.H&&P(t.H,function(t,n){se(e,n,t)}),t.l&&P({},function(t,n){se(e,n,t)})}function on(t,e,n){n=Math.min(t.i.length,n);const i=t.l?c(t.l.Ka,t.l,t):null;t:{var s=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?n>0?(e=s[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let c=!0;for(let l=0;l<n;l++){var r=s[l].g;const n=s[l].map;if((r-=e)<0)e=Math.max(0,s[l].g-100),c=!1;else try{r="req"+r+"_"||0;try{var a=n instanceof Map?n:Object.entries(n);for(const[e,n]of a){let i=n;o(n)&&(i=rt(n)),t.push(r+e+"="+encodeURIComponent(i))}}catch(He){throw t.push(r+"type="+encodeURIComponent("_badmap")),He}}catch(He){i&&i(n)}}if(c){a=t.join("&");break t}}a=void 0}return t=t.i.splice(0,n),e.G=t,a}function an(t){if(!t.g&&!t.v){t.Y=1;var e=t.Da;y||b(),v||(y(),v=!0),w.add(e,t),t.A=0}}function cn(t){return!(t.g||t.v||t.A>=3)&&(t.Y++,t.v=bt(c(t.Da,t),fn(t,t.A)),t.A++,!0)}function ln(t){null!=t.B&&(r.clearTimeout(t.B),t.B=null)}function hn(t){t.g=new Rt(t,t.j,"rpc",t.Y),null===t.u&&(t.g.J=t.o),t.g.P=0;var e=te(t.na);se(e,"RID","rpc"),se(e,"SID",t.M),se(e,"AID",t.K),se(e,"CI",t.F?"0":"1"),!t.F&&t.ia&&se(e,"TO",t.ia),se(e,"TYPE","xmlhttp"),rn(t,e),t.u&&t.o&&Re(e,t.u,t.o),t.O&&(t.g.H=t.O);var n=t.g;t=t.ba,n.M=1,n.A=re(te(e)),n.u=null,n.R=!0,Mt(n,t)}function un(t){null!=t.C&&(r.clearTimeout(t.C),t.C=null)}function dn(t,e){var n=null;if(t.g==e){un(t),ln(t),t.g=null;var i=2}else{if(!Qt(t.h,e))return;n=e.G,Xt(t.h,e),i=1}if(0!=t.I)if(e.o)if(1==i){n=e.u?e.u.length:0,e=Date.now()-e.F;var s=t.D;$(i=gt(),new wt(i,n)),nn(t)}else an(t);else if(3==(s=e.m)||0==s&&e.X>0||!(1==i&&function(t,e){return!(Gt(t.h)>=t.h.j-(t.m?1:0))&&(t.m?(t.i=e.G.concat(t.i),!0):!(1==t.I||2==t.I||t.D>=(t.Sa?0:t.Ta))&&(t.m=bt(c(t.Ea,t,e),fn(t,t.D)),t.D++,!0))}(t,e)||2==i&&cn(t)))switch(n&&n.length>0&&(e=t.h,e.i=e.i.concat(n)),s){case 1:pn(t,5);break;case 4:pn(t,10);break;case 3:pn(t,6);break;default:pn(t,2)}}function fn(t,e){let n=t.Qa+Math.floor(Math.random()*t.Za);return t.isActive()||(n*=2),n*e}function pn(t,e){if(t.j.info("Error code "+e),2==e){var n=c(t.bb,t),i=t.Ua;const e=!i;i=new Zt(i||"//www.google.com/images/cleardot.gif"),r.location&&"http"==r.location.protocol||ee(i,"https"),re(i),e?function(t,e){const n=new Et;if(r.Image){const i=new Image;i.onload=l(Ee,n,"TestLoadImage: loaded",!0,e,i),i.onerror=l(Ee,n,"TestLoadImage: error",!1,e,i),i.onabort=l(Ee,n,"TestLoadImage: abort",!1,e,i),i.ontimeout=l(Ee,n,"TestLoadImage: timeout",!1,e,i),r.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=t}else e(!1)}(i.toString(),n):function(t,e){new Et;const n=new AbortController,i=setTimeout(()=>{n.abort(),Ee(0,0,!1,e)},1e4);fetch(t,{signal:n.signal}).then(t=>{clearTimeout(i),t.ok?Ee(0,0,!0,e):Ee(0,0,!1,e)}).catch(()=>{clearTimeout(i),Ee(0,0,!1,e)})}(i.toString(),n)}else vt(2);t.I=0,t.l&&t.l.pa(e),gn(t),en(t)}function gn(t){if(t.I=0,t.ja=[],t.l){const e=Jt(t.h);0==e.length&&0==t.i.length||(f(t.ja,e),f(t.ja,t.i),t.h.i.length=0,d(t.i),t.i.length=0),t.l.oa()}}function mn(t,e,n){var i=n instanceof Zt?te(n):new Zt(n);if(""!=i.g)e&&(i.g=e+"."+i.g),ne(i,i.u);else{var s=r.location;i=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;const t=new Zt(null);i&&ee(t,i),e&&(t.g=e),s&&ne(t,s),n&&(t.h=n),i=t}return n=t.G,e=t.wa,n&&e&&se(i,n,e),se(i,"VER",t.ka),rn(t,i),i}function _n(t,e,n){if(e&&!t.L)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Aa&&!t.ma?new De(new Te({ab:n})):new De(t.ma)).Fa(t.L),e}function yn(){}function vn(){}function wn(t,e){J.call(this),this.g=new $e(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.o=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.sa&&(t?t["X-WebChannel-Client-Profile"]=e.sa:t={"X-WebChannel-Client-Profile":e.sa}),this.g.U=t,(t=e&&e.Qb)&&!I(t)&&(this.g.u=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!I(e)&&(this.g.G=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new Tn(this)}function bn(t){ut.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Cn(){dt.call(this),this.status=1}function Tn(t){this.g=t}(t=De.prototype).Fa=function(t){this.H=t},t.ea=function(t,e,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Tt.g(),this.g.onreadystatechange=u(c(this.Ca,this));try{this.B=!0,this.g.open(e,String(t),!0),this.B=!1}catch(o){return void ze(this,o)}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else{if("function"!==typeof i.keys||"function"!==typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const t of i.keys())n.set(t,i.get(t))}i=Array.from(n.keys()).find(t=>"content-type"==t.toLowerCase()),s=r.FormData&&t instanceof r.FormData,!(Array.prototype.indexOf.call(We,e,void 0)>=0)||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[r,a]of n)this.g.setRequestHeader(r,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(o){ze(this,o)}},t.abort=function(t){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=t||7,$(this,"complete"),$(this,"abort"),Qe(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Qe(this,!0)),De.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?Ge(this):this.Xa())},t.Xa=function(){Ge(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return Ye(this)>2?this.g.status:-1}catch(t){return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},t.La=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),ot(e)}},t.ya=function(){return this.o},t.Ha=function(){return"string"===typeof this.l?this.l:String(this.l)},(t=$e.prototype).ka=8,t.I=1,t.connect=function(t,e,n,i){vt(0),this.W=t,this.H=e||{},n&&void 0!==i&&(this.H.OSID=n,this.H.OAID=i),this.F=this.X,this.J=mn(this,null,this.W),nn(this)},t.Ea=function(t){if(this.m)if(this.m=null,1==this.I){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const s=new Rt(this,this.j,t);let r=this.o;if(this.U&&(r?(r=x(r),M(r,this.U)):r=this.U),null!==this.u||this.R||(s.J=r,r=null),this.S)t:{for(var e=0,n=0;n<this.i.length;n++){var i=this.i[n];if(void 0===(i="__data__"in i.map&&"string"===typeof(i=i.map.__data__)?i.length:void 0))break;if((e+=i)>4096){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=on(this,s,e),se(n=te(this.J),"RID",t),se(n,"CVER",22),this.G&&se(n,"X-HTTP-Session-Id",this.G),rn(this,n),r&&(this.R?e="headers="+Nt(Ae(r))+"&"+e:this.u&&Re(n,this.u,r)),Yt(this.h,s),this.Ra&&se(n,"TYPE","init"),this.S?(se(n,"$req",e),se(n,"SID","null"),s.U=!0,Ot(s,n,null)):Ot(s,n,e),this.I=2}}else 3==this.I&&(t?sn(this,t):0==this.i.length||Kt(this.h)||sn(this))},t.Da=function(){if(this.v=null,hn(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var t=4*this.T;this.j.info("BP detection timer enabled: "+t),this.B=bt(c(this.Wa,this),t)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,vt(10),tn(this),hn(this))},t.Va=function(){null!=this.C&&(this.C=null,tn(this),cn(this),vt(19))},t.bb=function(t){t?(this.j.info("Successfully pinged google.com"),vt(2)):(this.j.info("Failed to ping google.com"),vt(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=yn.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},vn.prototype.g=function(t,e){return new wn(t,e)},h(wn,J),wn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},wn.prototype.close=function(){Ze(this.g)},wn.prototype.o=function(t){var e=this.g;if("string"===typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=rt(t),t=n);e.i.push(new Wt(e.Ya++,t)),3==e.I&&nn(e)},wn.prototype.N=function(){this.g.l=null,delete this.j,Ze(this.g),delete this.g,wn.Z.N.call(this)},h(bn,ut),h(Cn,dt),h(Tn,yn),Tn.prototype.ra=function(){$(this.g,"a")},Tn.prototype.qa=function(t){$(this.g,new bn(t))},Tn.prototype.pa=function(t){$(this.g,new Cn)},Tn.prototype.oa=function(){$(this.g,"b")},vn.prototype.createWebChannel=vn.prototype.g,wn.prototype.send=wn.prototype.o,wn.prototype.open=wn.prototype.m,wn.prototype.close=wn.prototype.close,Ue=Be.createWebChannelTransport=function(){return new vn},Ve=Be.getStatEventTarget=function(){return gt()},Fe=Be.Event=ft,Le=Be.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},St.NO_ERROR=0,St.TIMEOUT=8,St.HTTP_ERROR=6,Me=Be.ErrorCode=St,It.COMPLETE="complete",Oe=Be.EventType=It,lt.EventType=ht,ht.OPEN="a",ht.CLOSE="b",ht.ERROR="c",ht.MESSAGE="d",J.prototype.listen=J.prototype.J,xe=Be.WebChannel=lt,Be.FetchXmlHttpFactory=Te,De.prototype.listenOnce=De.prototype.K,De.prototype.getLastError=De.prototype.Ha,De.prototype.getLastErrorCode=De.prototype.ya,De.prototype.getStatus=De.prototype.ca,De.prototype.getResponseJson=De.prototype.La,De.prototype.getResponseText=De.prototype.la,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Fa,Pe=Be.XhrIo=De}).apply("undefined"!==typeof je?je:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const qe="@firebase/firestore",He="4.9.2";class We{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}We.UNAUTHENTICATED=new We(null),We.GOOGLE_CREDENTIALS=new We("google-credentials-uid"),We.FIRST_PARTY=new We("first-party-uid"),We.MOCK_USER=new We("mock-user");let ze="12.3.0";const Ke=new ut("@firebase/firestore");function Ge(){return Ke.logLevel}function Qe(t){if(Ke.logLevel<=ot.DEBUG){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];const s=n.map(Je);Ke.debug("Firestore (".concat(ze,"): ").concat(t),...s)}}function Ye(t){if(Ke.logLevel<=ot.ERROR){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];const s=n.map(Je);Ke.error("Firestore (".concat(ze,"): ").concat(t),...s)}}function Xe(t){if(Ke.logLevel<=ot.WARN){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];const s=n.map(Je);Ke.warn("Firestore (".concat(ze,"): ").concat(t),...s)}}function Je(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function $e(t,e,n){let i="Unexpected state";"string"==typeof e?i=e:n=e,Ze(t,i,n)}function Ze(t,e,n){let i="FIRESTORE (".concat(ze,") INTERNAL ASSERTION FAILED: ").concat(e," (ID: ").concat(t.toString(16),")");if(void 0!==n)try{i+=" CONTEXT: "+JSON.stringify(n)}catch(t){i+=" CONTEXT: "+n}throw Ye(i),new Error(i)}function tn(t,e,n,i){let s="Unexpected state";"string"==typeof n?s=n:i=n,t||Ze(e,s,i)}function en(t,e){return t}const nn={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class sn extends U{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class rn{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class on{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))}}class an{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(We.UNAUTHENTICATED))}shutdown(){}}class cn{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class ln{constructor(t){this.t=t,this.currentUser=We.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){tn(void 0===this.o,42304);let n=this.i;const i=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new rn;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new rn,t.enqueueRetryable(()=>i(this.currentUser))};const r=()=>{const e=s;t.enqueueRetryable(async()=>{await e.promise,await i(this.currentUser)})},o=t=>{Qe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.o&&(this.auth.addAuthTokenListener(this.o),r())};this.t.onInit(t=>o(t)),setTimeout(()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Qe("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new rn)}},0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(Qe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(tn("string"==typeof e.accessToken,31837,{l:e}),new on(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return tn(null===t||"string"==typeof t,2055,{h:t}),new We(t)}}class hn{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=We.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class un{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new hn(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(We.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class dn{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class fn{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,de(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){tn(void 0===this.o,3512);const n=t=>{null!=t.error&&Qe("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(t.error.message));const n=t.token!==this.m;return this.m=t.token,Qe("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable(()=>n(e))};const i=t=>{Qe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(t=>i(t)),setTimeout(()=>{if(!this.appCheck){const t=this.V.getImmediate({optional:!0});t?i(t):Qe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new dn(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(t=>t?(tn("string"==typeof t.token,44558,{tokenResult:t}),this.m=t.token,new dn(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function pn(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let i=0;i<t;i++)n[i]=Math.floor(256*Math.random());return n}class gn{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=pn(40);for(let i=0;i<n.length;++i)e.length<20&&n[i]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return e}}function mn(t,e){return t<e?-1:t>e?1:0}function _n(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const n=t.charAt(i),s=e.charAt(i);if(n!==s)return wn(n)===wn(s)?mn(n,s):wn(n)?1:-1}return mn(t.length,e.length)}const yn=55296,vn=57343;function wn(t){const e=t.charCodeAt(0);return e>=yn&&e<=vn}function bn(t,e,n){return t.length===e.length&&t.every((t,i)=>n(t,e[i]))}const En="__name__";class Cn{constructor(t,e,n){void 0===e?e=0:e>t.length&&$e(637,{offset:e,range:t.length}),void 0===n?n=t.length-e:n>t.length-e&&$e(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===Cn.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Cn?t.forEach(t=>{e.push(t)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const n=Cn.compareSegments(t.get(i),e.get(i));if(0!==n)return n}return mn(t.length,e.length)}static compareSegments(t,e){const n=Cn.isNumericId(t),i=Cn.isNumericId(e);return n&&!i?-1:!n&&i?1:n&&i?Cn.extractNumericId(t).compare(Cn.extractNumericId(e)):_n(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Ae.fromString(t.substring(4,t.length-2))}}class Tn extends Cn{construct(t,e,n){return new Tn(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const t=[];for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(const s of n){if(s.indexOf("//")>=0)throw new sn(nn.INVALID_ARGUMENT,"Invalid segment (".concat(s,"). Paths must not contain // in them."));t.push(...s.split("/").filter(t=>t.length>0))}return new Tn(t)}static emptyPath(){return new Tn([])}}const Sn=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class In extends Cn{construct(t,e,n){return new In(t,e,n)}static isValidIdentifier(t){return Sn.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),In.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===En}static keyField(){return new In([En])}static fromServerFormat(t){const e=[];let n="",i=0;const s=()=>{if(0===n.length)throw new sn(nn.INVALID_ARGUMENT,"Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));e.push(n),n=""};let r=!1;for(;i<t.length;){const e=t[i];if("\\"===e){if(i+1===t.length)throw new sn(nn.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[i+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new sn(nn.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,i+=2}else"`"===e?(r=!r,i++):"."!==e||r?(n+=e,i++):(s(),i++)}if(s(),r)throw new sn(nn.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new In(e)}static emptyPath(){return new In([])}}class kn{constructor(t){this.path=t}static fromPath(t){return new kn(Tn.fromString(t))}static fromName(t){return new kn(Tn.fromString(t).popFirst(5))}static empty(){return new kn(Tn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Tn.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Tn.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new kn(new Tn(t.slice()))}}function Nn(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function An(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t="".concat(t.substring(0,20),"...")),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?"a custom ".concat(e," object"):"an object"}}return"function"==typeof t?"a function":$e(12329,{type:typeof t})}function Rn(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new sn(nn.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=An(t);throw new sn(nn.INVALID_ARGUMENT,"Expected type '".concat(e.name,"', but it was: ").concat(n))}}return t}function Dn(t,e){const n={typeString:t};return e&&(n.value=e),n}function Pn(t,e){if(!Nn(t))throw new sn(nn.INVALID_ARGUMENT,"JSON must be an object");let n;for(const i in e)if(e[i]){const s=e[i].typeString,r="value"in e[i]?{value:e[i].value}:void 0;if(!(i in t)){n="JSON missing required field: '".concat(i,"'");break}const o=t[i];if(s&&typeof o!==s){n="JSON field '".concat(i,"' must be a ").concat(s,".");break}if(void 0!==r&&o!==r.value){n="Expected '".concat(i,"' field to equal '").concat(r.value,"'");break}}if(n)throw new sn(nn.INVALID_ARGUMENT,n);return!0}const xn=-62135596800,On=1e6;class Mn{static now(){return Mn.fromMillis(Date.now())}static fromDate(t){return Mn.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*On);return new Mn(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new sn(nn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new sn(nn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<xn)throw new sn(nn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new sn(nn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/On}_compareTo(t){return this.seconds===t.seconds?mn(this.nanoseconds,t.nanoseconds):mn(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Mn._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Pn(t,Mn._jsonSchema))return new Mn(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-xn;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Mn._jsonSchemaVersion="firestore/timestamp/1.0",Mn._jsonSchema={type:Dn("string",Mn._jsonSchemaVersion),seconds:Dn("number"),nanoseconds:Dn("number")};class Ln{static fromTimestamp(t){return new Ln(t)}static min(){return new Ln(new Mn(0,0))}static max(){return new Ln(new Mn(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Fn=-1;class Vn{constructor(t,e,n,i){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=i}}Vn.UNKNOWN_ID=-1;function Un(t,e){const n=t.toTimestamp().seconds,i=t.toTimestamp().nanoseconds+1,s=Ln.fromTimestamp(1e9===i?new Mn(n+1,0):new Mn(n,i));return new Bn(s,kn.empty(),e)}function jn(t){return new Bn(t.readTime,t.key,Fn)}class Bn{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Bn(Ln.min(),kn.empty(),Fn)}static max(){return new Bn(Ln.max(),kn.empty(),Fn)}}function qn(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=kn.comparator(t.documentKey,e.documentKey),0!==n?n:mn(t.largestBatchId,e.largestBatchId))}class Hn{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}class Wn{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&$e(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Wn((n,i)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,i)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof Wn?e:Wn.resolve(e)}catch(t){return Wn.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):Wn.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):Wn.reject(e)}static resolve(t){return new Wn((e,n)=>{e(t)})}static reject(t){return new Wn((e,n)=>{n(t)})}static waitFor(t){return new Wn((e,n)=>{let i=0,s=0,r=!1;t.forEach(t=>{++i,t.next(()=>{++s,r&&s===i&&e()},t=>n(t))}),r=!0,s===i&&e()})}static or(t){let e=Wn.resolve(!1);for(const n of t)e=e.next(t=>t?Wn.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,i)=>{n.push(e.call(this,t,i))}),this.waitFor(n)}static mapArray(t,e){return new Wn((n,i)=>{const s=t.length,r=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;e(t[c]).next(t=>{r[c]=t,++o,o===s&&n(r)},t=>i(t))}})}static doWhile(t,e){return new Wn((n,i)=>{const s=()=>{!0===t()?e().next(()=>{s()},i):n()};s()})}}function zn(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Kn(t){return"IndexedDbTransactionError"===t.name}class Gn{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ae(t),this.ue=t=>e.writeSequenceNumber(t))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}Gn.ce=-1;const Qn=-1;function Yn(t){return null==t}function Xn(t){return 0===t&&1/t==-1/0}const Jn="remoteDocuments",$n="owner",Zn="mutationQueues",ti="mutations";const ei="documentMutations",ni="remoteDocumentsV14",ii="remoteDocumentGlobal",si="targets",ri="targetDocuments",oi="targetGlobal",ai="collectionParents",ci="clientMetadata",li="bundles",hi="namedQueries",ui="indexConfiguration",di="indexState",fi="indexEntries",pi="documentOverlays",gi="globals",mi=[Zn,ti,ei,Jn,si,$n,oi,ri,ci,ii,ai,li,hi],_i=[Zn,ti,ei,ni,si,$n,oi,ri,ci,ii,ai,li,hi,pi],yi=_i,vi=[...yi,ui,di,fi];function wi(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function bi(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Ei(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Ci{constructor(t,e){this.comparator=t,this.root=e||Si.EMPTY}insert(t,e){return new Ci(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Si.BLACK,null,null))}remove(t){return new Ci(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Si.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(t,n.key);if(0===i)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.inorderTraversal((e,n)=>(t.push("".concat(e,":").concat(n)),!1)),"{".concat(t.join(", "),"}")}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ti(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ti(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ti(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ti(this.root,t,this.comparator,!0)}}class Ti{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Si{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=null!=n?n:Si.RED,this.left=null!=i?i:Si.EMPTY,this.right=null!=s?s:Si.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new Si(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===s?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Si.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===e(t,i.key)){if(i.right.isEmpty())return Si.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Si.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Si.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw $e(43730,{key:this.key,value:this.value});if(this.right.isRed())throw $e(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw $e(27949);return t+(this.isRed()?0:1)}}Si.EMPTY=null,Si.RED=!0,Si.BLACK=!1,Si.EMPTY=new class{constructor(){this.size=0}get key(){throw $e(57766)}get value(){throw $e(16141)}get color(){throw $e(16727)}get left(){throw $e(29726)}get right(){throw $e(36894)}copy(t,e,n,i,s){return this}insert(t,e,n){return new Si(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ii{constructor(t){this.comparator=t,this.data=new Ci(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new ki(this.data.getIterator())}getIteratorFrom(t){return new ki(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof Ii))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(t,i))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new Ii(this.comparator);return e.data=t,e}}class ki{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ni{constructor(t){this.fields=t,t.sort(In.comparator)}static empty(){return new Ni([])}unionWith(t){let e=new Ii(In.comparator);for(const n of this.fields)e=e.add(n);for(const n of t)e=e.add(n);return new Ni(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return bn(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class Ai extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ri{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Ai("Invalid base64 string: "+t):t}}(t);return new Ri(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Ri(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return mn(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Ri.EMPTY_BYTE_STRING=new Ri("");const Di=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pi(t){if(tn(!!t,39018),"string"==typeof t){let e=0;const n=Di.exec(t);if(tn(!!n,46558,{timestamp:t}),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:xi(t.seconds),nanos:xi(t.nanos)}}function xi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Oi(t){return"string"==typeof t?Ri.fromBase64String(t):Ri.fromUint8Array(t)}const Mi="server_timestamp",Li="__type__",Fi="__previous_value__",Vi="__local_write_time__";function Ui(t){var e,n;return(null===(e=((null===t||void 0===t||null===(n=t.mapValue)||void 0===n?void 0:n.fields)||{})[Li])||void 0===e?void 0:e.stringValue)===Mi}function ji(t){const e=t.mapValue.fields[Fi];return Ui(e)?ji(e):e}function Bi(t){const e=Pi(t.mapValue.fields[Vi].timestampValue);return new Mn(e.seconds,e.nanos)}const qi="(default)";class Hi{constructor(t,e){this.projectId=t,this.database=e||qi}static empty(){return new Hi("","")}get isDefaultDatabase(){return this.database===qi}isEqual(t){return t instanceof Hi&&t.projectId===this.projectId&&t.database===this.database}}const Wi="__type__",zi="__max__",Ki={mapValue:{fields:{__type__:{stringValue:zi}}}},Gi="__vector__",Qi="value";function Yi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ui(t)?4:cs(t)?9007199254740991:os(t)?10:11:$e(28295,{value:t})}function Xi(t,e){if(t===e)return!0;const n=Yi(t);if(n!==Yi(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Bi(t).isEqual(Bi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Pi(t.timestampValue),i=Pi(e.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Oi(t.bytesValue).isEqual(Oi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return xi(t.geoPointValue.latitude)===xi(e.geoPointValue.latitude)&&xi(t.geoPointValue.longitude)===xi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return xi(t.integerValue)===xi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=xi(t.doubleValue),i=xi(e.doubleValue);return n===i?Xn(n)===Xn(i):isNaN(n)&&isNaN(i)}return!1}(t,e);case 9:return bn(t.arrayValue.values||[],e.arrayValue.values||[],Xi);case 10:case 11:return function(t,e){const n=t.mapValue.fields||{},i=e.mapValue.fields||{};if(wi(n)!==wi(i))return!1;for(const s in n)if(n.hasOwnProperty(s)&&(void 0===i[s]||!Xi(n[s],i[s])))return!1;return!0}(t,e);default:return $e(52216,{left:t})}}function Ji(t,e){return void 0!==(t.values||[]).find(t=>Xi(t,e))}function $i(t,e){if(t===e)return 0;const n=Yi(t),i=Yi(e);if(n!==i)return mn(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return mn(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=xi(t.integerValue||t.doubleValue),i=xi(e.integerValue||e.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(t,e);case 3:return Zi(t.timestampValue,e.timestampValue);case 4:return Zi(Bi(t),Bi(e));case 5:return _n(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Oi(t),i=Oi(e);return n.compareTo(i)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),i=e.split("/");for(let s=0;s<n.length&&s<i.length;s++){const t=mn(n[s],i[s]);if(0!==t)return t}return mn(n.length,i.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=mn(xi(t.latitude),xi(e.latitude));return 0!==n?n:mn(xi(t.longitude),xi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return ts(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n,i,s,r;const o=t.fields||{},a=e.fields||{},c=null===(n=o[Qi])||void 0===n?void 0:n.arrayValue,l=null===(i=a[Qi])||void 0===i?void 0:i.arrayValue,h=mn((null===c||void 0===c||null===(s=c.values)||void 0===s?void 0:s.length)||0,(null===l||void 0===l||null===(r=l.values)||void 0===r?void 0:r.length)||0);return 0!==h?h:ts(c,l)}(t.mapValue,e.mapValue);case 11:return function(t,e){if(t===Ki.mapValue&&e===Ki.mapValue)return 0;if(t===Ki.mapValue)return 1;if(e===Ki.mapValue)return-1;const n=t.fields||{},i=Object.keys(n),s=e.fields||{},r=Object.keys(s);i.sort(),r.sort();for(let o=0;o<i.length&&o<r.length;++o){const t=_n(i[o],r[o]);if(0!==t)return t;const e=$i(n[i[o]],s[r[o]]);if(0!==e)return e}return mn(i.length,r.length)}(t.mapValue,e.mapValue);default:throw $e(23264,{he:n})}}function Zi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return mn(t,e);const n=Pi(t),i=Pi(e),s=mn(n.seconds,i.seconds);return 0!==s?s:mn(n.nanos,i.nanos)}function ts(t,e){const n=t.values||[],i=e.values||[];for(let s=0;s<n.length&&s<i.length;++s){const t=$i(n[s],i[s]);if(t)return t}return mn(n.length,i.length)}function es(t){return ns(t)}function ns(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Pi(t);return"time(".concat(e.seconds,",").concat(e.nanos,")")}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return Oi(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return kn.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return"geo(".concat(t.latitude,",").concat(t.longitude,")")}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const i of t.values||[])n?n=!1:e+=",",e+=ns(i);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",i=!0;for(const s of e)i?i=!1:n+=",",n+="".concat(s,":").concat(ns(t.fields[s]));return n+"}"}(t.mapValue):$e(61005,{value:t})}function is(t){return!!t&&"integerValue"in t}function ss(t){return!!t&&"arrayValue"in t}function rs(t){return!!t&&"mapValue"in t}function os(t){var e,n;return(null===(e=((null===t||void 0===t||null===(n=t.mapValue)||void 0===n?void 0:n.fields)||{})[Wi])||void 0===e?void 0:e.stringValue)===Gi}function as(t){if(t.geoPointValue)return{geoPointValue:a({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:a({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return bi(t.mapValue.fields,(t,n)=>e.mapValue.fields[t]=as(n)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=as(t.arrayValue.values[n]);return e}return a({},t)}function cs(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===zi}class ls{constructor(t){this.value=t}static empty(){return new ls({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!rs(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=as(e)}setAll(t){let e=In.emptyPath(),n={},i=[];t.forEach((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,i),n={},i=[],e=s.popLast()}t?n[s.lastSegment()]=as(t):i.push(s.lastSegment())});const s=this.getFieldsMap(e);this.applyChanges(s,n,i)}delete(t){const e=this.field(t.popLast());rs(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Xi(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];rs(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){bi(e,(e,n)=>t[e]=n);for(const i of n)delete t[i]}clone(){return new ls(as(this.value))}}class hs{constructor(t,e,n,i,s,r,o){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=s,this.data=r,this.documentState=o}static newInvalidDocument(t){return new hs(t,0,Ln.min(),Ln.min(),Ln.min(),ls.empty(),0)}static newFoundDocument(t,e,n,i){return new hs(t,1,e,Ln.min(),n,i,0)}static newNoDocument(t,e){return new hs(t,2,e,Ln.min(),Ln.min(),ls.empty(),0)}static newUnknownDocument(t,e){return new hs(t,3,e,Ln.min(),Ln.min(),ls.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(Ln.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=ls.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=ls.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ln.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof hs&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new hs(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class us{constructor(t,e){this.position=t,this.inclusive=e}}function ds(t,e,n){let i=0;for(let s=0;s<t.position.length;s++){const r=e[s],o=t.position[s];if(i=r.field.isKeyField()?kn.comparator(kn.fromName(o.referenceValue),n.key):$i(o,n.data.field(r.field)),"desc"===r.dir&&(i*=-1),0!==i)break}return i}function fs(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Xi(t.position[n],e.position[n]))return!1;return!0}class ps{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=t,this.dir=e}}function gs(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class ms{}class _s extends ms{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Ss(t,e,n):"array-contains"===e?new As(t,n):"in"===e?new Rs(t,n):"not-in"===e?new Ds(t,n):"array-contains-any"===e?new Ps(t,n):new _s(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Is(t,n):new ks(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&void 0===e.nullValue&&this.matchesComparison($i(e,this.value)):null!==e&&Yi(this.value)===Yi(e)&&this.matchesComparison($i(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return $e(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ys extends ms{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new ys(t,e)}matches(t){return vs(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function vs(t){return"and"===t.op}function ws(t){return bs(t)&&vs(t)}function bs(t){for(const e of t.filters)if(e instanceof ys)return!1;return!0}function Es(t){if(t instanceof _s)return t.field.canonicalString()+t.op.toString()+es(t.value);if(ws(t))return t.filters.map(t=>Es(t)).join(",");{const e=t.filters.map(t=>Es(t)).join(",");return"".concat(t.op,"(").concat(e,")")}}function Cs(t,e){return t instanceof _s?function(t,e){return e instanceof _s&&t.op===e.op&&t.field.isEqual(e.field)&&Xi(t.value,e.value)}(t,e):t instanceof ys?function(t,e){return e instanceof ys&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce((t,n,i)=>t&&Cs(n,e.filters[i]),!0)}(t,e):void $e(19439)}function Ts(t){return t instanceof _s?function(t){return"".concat(t.field.canonicalString()," ").concat(t.op," ").concat(es(t.value))}(t):t instanceof ys?function(t){return t.op.toString()+" {"+t.getFilters().map(Ts).join(" ,")+"}"}(t):"Filter"}class Ss extends _s{constructor(t,e,n){super(t,e,n),this.key=kn.fromName(n.referenceValue)}matches(t){const e=kn.comparator(t.key,this.key);return this.matchesComparison(e)}}class Is extends _s{constructor(t,e){super(t,"in",e),this.keys=Ns("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class ks extends _s{constructor(t,e){super(t,"not-in",e),this.keys=Ns("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Ns(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>kn.fromName(t.referenceValue))}class As extends _s{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return ss(e)&&Ji(e.arrayValue,this.value)}}class Rs extends _s{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Ji(this.value.arrayValue,e)}}class Ds extends _s{constructor(t,e){super(t,"not-in",e)}matches(t){if(Ji(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&void 0===e.nullValue&&!Ji(this.value.arrayValue,e)}}class Ps extends _s{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!ss(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>Ji(this.value.arrayValue,t))}}class xs{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=r,this.endAt=o,this.Te=null}}function Os(t){return new xs(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function Ms(t){const e=en(t);if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>Es(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>function(t){return t.field.canonicalString()+t.dir}(t)).join(","),Yn(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(t=>es(t)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(t=>es(t)).join(",")),e.Te=t}return e.Te}function Ls(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!gs(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Cs(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!fs(t.startAt,e.startAt)&&fs(t.endAt,e.endAt)}class Fs{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=r,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Vs(t,e,n,i,s,r,o,a){return new Fs(t,e,n,i,s,r,o,a)}function Us(t){return new Fs(t)}function js(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Bs(t){return null!==t.collectionGroup}function qs(t){const e=en(t);if(null===e.Ie){e.Ie=[];const t=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",i=function(t){let e=new Ii(In.comparator);return t.filters.forEach(t=>{t.getFlattenedFilters().forEach(t=>{t.isInequality()&&(e=e.add(t.field))})}),e}(e);i.forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new ps(i,n))}),t.has(In.keyField().canonicalString())||e.Ie.push(new ps(In.keyField(),n))}return e.Ie}function Hs(t){const e=en(t);return e.Ee||(e.Ee=Ws(e,qs(t))),e.Ee}function Ws(t,e){if("F"===t.limitType)return Os(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(t=>{const e="desc"===t.dir?"asc":"desc";return new ps(t.field,e)});const n=t.endAt?new us(t.endAt.position,t.endAt.inclusive):null,i=t.startAt?new us(t.startAt.position,t.startAt.inclusive):null;return Os(t.path,t.collectionGroup,e,t.filters,t.limit,n,i)}}function zs(t,e,n){return new Fs(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Ks(t,e){return Ls(Hs(t),Hs(e))&&t.limitType===e.limitType}function Gs(t){return"".concat(Ms(Hs(t)),"|lt:").concat(t.limitType)}function Qs(t){return"Query(target=".concat(function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: [".concat(t.filters.map(t=>Ts(t)).join(", "),"]")),Yn(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: [".concat(t.orderBy.map(t=>function(t){return"".concat(t.field.canonicalString()," (").concat(t.dir,")")}(t)).join(", "),"]")),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(t=>es(t)).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(t=>es(t)).join(",")),"Target(".concat(e,")")}(Hs(t)),"; limitType=").concat(t.limitType,")")}function Ys(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):kn.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of qs(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const i=ds(t,e,n);return t.inclusive?i<=0:i<0}(t.startAt,qs(t),e))&&!(t.endAt&&!function(t,e,n){const i=ds(t,e,n);return t.inclusive?i>=0:i>0}(t.endAt,qs(t),e))}(t,e)}function Xs(t){return(e,n)=>{let i=!1;for(const s of qs(t)){const t=Js(s,e,n);if(0!==t)return t;i=i||s.field.isKeyField()}return 0}}function Js(t,e,n){const i=t.field.isKeyField()?kn.comparator(e.key,n.key):function(t,e,n){const i=e.data.field(t),s=n.data.field(t);return null!==i&&null!==s?$i(i,s):$e(42886)}(t.field,e,n);switch(t.dir){case"asc":return i;case"desc":return-1*i;default:return $e(19790,{direction:t.dir})}}class $s{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),i=this.inner[n];if(void 0===i)return this.inner[n]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return 1===n.length?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){bi(this.inner,(e,n)=>{for(const[i,s]of n)t(i,s)})}isEmpty(){return Ei(this.inner)}size(){return this.innerSize}}const Zs=new Ci(kn.comparator);function tr(){return Zs}const er=new Ci(kn.comparator);function nr(){let t=er;for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(const s of n)t=t.insert(s.key,s);return t}function ir(t){let e=er;return t.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function sr(){return or()}function rr(){return or()}function or(){return new $s(t=>t.toString(),(t,e)=>t.isEqual(e))}new Ci(kn.comparator);const ar=new Ii(kn.comparator);function cr(){let t=ar;for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(const s of n)t=t.add(s);return t}const lr=new Ii(mn);function hr(){return lr}function ur(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Xn(e)?"-0":e}}function dr(t){return{integerValue:""+t}}class fr{constructor(){this._=void 0}}function pr(t,e,n){return t instanceof _r?function(t,e){const n={fields:{[Li]:{stringValue:Mi},[Vi]:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Ui(e)&&(e=ji(e)),e&&(n.fields[Fi]=e),{mapValue:n}}(n,e):t instanceof yr?vr(t,e):t instanceof wr?br(t,e):function(t,e){const n=mr(t,e),i=Cr(n)+Cr(t.Ae);return is(n)&&is(t.Ae)?dr(i):ur(t.serializer,i)}(t,e)}function gr(t,e,n){return t instanceof yr?vr(t,e):t instanceof wr?br(t,e):n}function mr(t,e){return t instanceof Er?function(t){return is(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class _r extends fr{}class yr extends fr{constructor(t){super(),this.elements=t}}function vr(t,e){const n=Tr(e);for(const i of t.elements)n.some(t=>Xi(t,i))||n.push(i);return{arrayValue:{values:n}}}class wr extends fr{constructor(t){super(),this.elements=t}}function br(t,e){let n=Tr(e);for(const i of t.elements)n=n.filter(t=>!Xi(t,i));return{arrayValue:{values:n}}}class Er extends fr{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function Cr(t){return xi(t.integerValue||t.doubleValue)}function Tr(t){return ss(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Sr{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Sr}static exists(t){return new Sr(void 0,t)}static updateTime(t){return new Sr(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Ir(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class kr{}function Nr(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Fr(t.key,Sr.none()):new Pr(t.key,t.data,Sr.none());{const n=t.data,i=ls.empty();let s=new Ii(In.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?i.delete(t):i.set(t,e),s=s.add(t)}return new xr(t.key,i,new Ni(s.toArray()),Sr.none())}}function Ar(t,e,n){t instanceof Pr?function(t,e,n){const i=t.value.clone(),s=Mr(t.fieldTransforms,e,n.transformResults);i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):t instanceof xr?function(t,e,n){if(!Ir(t.precondition,e))return void e.convertToUnknownDocument(n.version);const i=Mr(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(Or(t)),s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Rr(t,e,n,i){return t instanceof Pr?function(t,e,n,i){if(!Ir(t.precondition,e))return n;const s=t.value.clone(),r=Lr(t.fieldTransforms,i,e);return s.setAll(r),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,i):t instanceof xr?function(t,e,n,i){if(!Ir(t.precondition,e))return n;const s=Lr(t.fieldTransforms,i,e),r=e.data;return r.setAll(Or(t)),r.setAll(s),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map(t=>t.field))}(t,e,n,i):function(t,e,n){return Ir(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Dr(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&bn(t,e,(t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof yr&&e instanceof yr||t instanceof wr&&e instanceof wr?bn(t.elements,e.elements,Xi):t instanceof Er&&e instanceof Er?Xi(t.Ae,e.Ae):t instanceof _r&&e instanceof _r}(t.transform,e.transform)}(t,e))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Pr extends kr{constructor(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class xr extends kr{constructor(t,e,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Or(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const i=t.data.field(n);e.set(n,i)}}),e}function Mr(t,e,n){const i=new Map;tn(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let s=0;s<n.length;s++){const r=t[s],o=r.transform,a=e.data.field(r.field);i.set(r.field,gr(o,a,n[s]))}return i}function Lr(t,e,n){const i=new Map;for(const s of t){const t=s.transform,r=n.data.field(s.field);i.set(s.field,pr(t,r,e))}return i}class Fr extends kr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Vr{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let i=0;i<this.mutations.length;i++){const e=this.mutations[i];e.key.isEqual(t.key)&&Ar(e,t,n[i])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Rr(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Rr(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=rr();return this.mutations.forEach(i=>{const s=t.get(i.key),r=s.overlayedDocument;let o=this.applyToLocalView(r,s.mutatedFields);o=e.has(i.key)?null:o;const a=Nr(r,o);null!==a&&n.set(i.key,a),r.isValidDocument()||r.convertToNoDocument(Ln.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),cr())}isEqual(t){return this.batchId===t.batchId&&bn(this.mutations,t.mutations,(t,e)=>Dr(t,e))&&bn(this.baseMutations,t.baseMutations,(t,e)=>Dr(t,e))}}class Ur{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}var jr,Br;function qr(t){if(void 0===t)return Ye("GRPC error has no .code"),nn.UNKNOWN;switch(t){case jr.OK:return nn.OK;case jr.CANCELLED:return nn.CANCELLED;case jr.UNKNOWN:return nn.UNKNOWN;case jr.DEADLINE_EXCEEDED:return nn.DEADLINE_EXCEEDED;case jr.RESOURCE_EXHAUSTED:return nn.RESOURCE_EXHAUSTED;case jr.INTERNAL:return nn.INTERNAL;case jr.UNAVAILABLE:return nn.UNAVAILABLE;case jr.UNAUTHENTICATED:return nn.UNAUTHENTICATED;case jr.INVALID_ARGUMENT:return nn.INVALID_ARGUMENT;case jr.NOT_FOUND:return nn.NOT_FOUND;case jr.ALREADY_EXISTS:return nn.ALREADY_EXISTS;case jr.PERMISSION_DENIED:return nn.PERMISSION_DENIED;case jr.FAILED_PRECONDITION:return nn.FAILED_PRECONDITION;case jr.ABORTED:return nn.ABORTED;case jr.OUT_OF_RANGE:return nn.OUT_OF_RANGE;case jr.UNIMPLEMENTED:return nn.UNIMPLEMENTED;case jr.DATA_LOSS:return nn.DATA_LOSS;default:return $e(39323,{code:t})}}(Br=jr||(jr={}))[Br.OK=0]="OK",Br[Br.CANCELLED=1]="CANCELLED",Br[Br.UNKNOWN=2]="UNKNOWN",Br[Br.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Br[Br.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Br[Br.NOT_FOUND=5]="NOT_FOUND",Br[Br.ALREADY_EXISTS=6]="ALREADY_EXISTS",Br[Br.PERMISSION_DENIED=7]="PERMISSION_DENIED",Br[Br.UNAUTHENTICATED=16]="UNAUTHENTICATED",Br[Br.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Br[Br.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Br[Br.ABORTED=10]="ABORTED",Br[Br.OUT_OF_RANGE=11]="OUT_OF_RANGE",Br[Br.UNIMPLEMENTED=12]="UNIMPLEMENTED",Br[Br.INTERNAL=13]="INTERNAL",Br[Br.UNAVAILABLE=14]="UNAVAILABLE",Br[Br.DATA_LOSS=15]="DATA_LOSS";new Ae([4294967295,4294967295],0);Error;class Hr{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Wr(t){return tn(!!t,49232),Ln.fromTimestamp(function(t){const e=Pi(t);return new Mn(e.seconds,e.nanos)}(t))}function zr(t,e){const n=function(t){return new Tn(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function Kr(t){const e=Tn.fromString(t);return tn($r(e),10190,{key:e.toString()}),e}function Gr(t){const e=Kr(t);return 4===e.length?Tn.emptyPath():Qr(e)}function Qr(t){return tn(t.length>4&&"documents"===t.get(4),29091,{key:t.toString()}),t.popFirst(5)}function Yr(t){let e=Gr(t.parent);const n=t.structuredQuery,i=n.from?n.from.length:0;let s=null;if(i>0){tn(1===i,65062);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=function(t){const e=Xr(t);return e instanceof ys&&ws(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map(t=>function(t){return new ps(Jr(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Yn(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new us(n,e)}(n.startAt));let l=null;return n.endAt&&(l=function(t){const e=!t.before,n=t.values||[];return new us(n,e)}(n.endAt)),Vs(e,s,o,r,a,"F",c,l)}function Xr(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Jr(t.unaryFilter.field);return _s.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Jr(t.unaryFilter.field);return _s.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Jr(t.unaryFilter.field);return _s.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Jr(t.unaryFilter.field);return _s.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return $e(61313);default:return $e(60726)}}(t):void 0!==t.fieldFilter?function(t){return _s.create(Jr(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return $e(58110);default:return $e(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return ys.create(t.compositeFilter.filters.map(t=>Xr(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return $e(1026)}}(t.compositeFilter.op))}(t):$e(30097,{filter:t})}function Jr(t){return In.fromServerFormat(t.fieldPath)}function $r(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Zr{constructor(t){this.yt=t}}function to(t){const e=Yr({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?zs(e,e.limit,"L"):e}class eo{constructor(){}Dt(t,e){this.Ct(t,e),e.vt()}Ct(t,e){if("nullValue"in t)this.Ft(e,5);else if("booleanValue"in t)this.Ft(e,10),e.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(e,15),e.Mt(xi(t.integerValue));else if("doubleValue"in t){const n=xi(t.doubleValue);isNaN(n)?this.Ft(e,13):(this.Ft(e,15),Xn(n)?e.Mt(0):e.Mt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ft(e,20),"string"==typeof n&&(n=Pi(n)),e.xt("".concat(n.seconds||"")),e.Mt(n.nanos||0)}else if("stringValue"in t)this.Ot(t.stringValue,e),this.Nt(e);else if("bytesValue"in t)this.Ft(e,30),e.Bt(Oi(t.bytesValue)),this.Nt(e);else if("referenceValue"in t)this.Lt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Ft(e,45),e.Mt(n.latitude||0),e.Mt(n.longitude||0)}else"mapValue"in t?cs(t)?this.Ft(e,Number.MAX_SAFE_INTEGER):os(t)?this.kt(t.mapValue,e):(this.qt(t.mapValue,e),this.Nt(e)):"arrayValue"in t?(this.Qt(t.arrayValue,e),this.Nt(e)):$e(19022,{$t:t})}Ot(t,e){this.Ft(e,25),this.Ut(t,e)}Ut(t,e){e.xt(t)}qt(t,e){const n=t.fields||{};this.Ft(e,55);for(const i of Object.keys(n))this.Ot(i,e),this.Ct(n[i],e)}kt(t,e){var n;const i=t.fields||{};this.Ft(e,53);const s=Qi,r=(null===(n=i[s].arrayValue)||void 0===n||null===(n=n.values)||void 0===n?void 0:n.length)||0;this.Ft(e,15),e.Mt(xi(r)),this.Ot(s,e),this.Ct(i[s],e)}Qt(t,e){const n=t.values||[];this.Ft(e,50);for(const i of n)this.Ct(i,e)}Lt(t,e){this.Ft(e,37),kn.fromName(t).path.forEach(t=>{this.Ft(e,60),this.Ut(t,e)})}Ft(t,e){t.Mt(e)}Nt(t){t.Mt(2)}}eo.Kt=new eo;class no{constructor(){this.Cn=new io}addToCollectionParentIndex(t,e){return this.Cn.add(e),Wn.resolve()}getCollectionParents(t,e){return Wn.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return Wn.resolve()}deleteFieldIndex(t,e){return Wn.resolve()}deleteAllFieldIndexes(t){return Wn.resolve()}createTargetIndexes(t,e){return Wn.resolve()}getDocumentsMatchingTarget(t,e){return Wn.resolve(null)}getIndexType(t,e){return Wn.resolve(0)}getFieldIndexes(t,e){return Wn.resolve([])}getNextCollectionGroupToUpdate(t){return Wn.resolve(null)}getMinOffset(t,e){return Wn.resolve(Bn.min())}getMinOffsetFromCollectionGroup(t,e){return Wn.resolve(Bn.min())}updateCollectionGroup(t,e,n){return Wn.resolve()}updateIndexEntries(t,e){return Wn.resolve()}}class io{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new Ii(Tn.comparator),s=!i.has(n);return this.index[e]=i.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new Ii(Tn.comparator)).toArray()}}new Uint8Array(0);const so=41943040;class ro{static withCacheSize(t){return new ro(t,ro.DEFAULT_COLLECTION_PERCENTILE,ro.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}ro.DEFAULT_COLLECTION_PERCENTILE=10,ro.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ro.DEFAULT=new ro(so,ro.DEFAULT_COLLECTION_PERCENTILE,ro.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ro.DISABLED=new ro(-1,0,0);class oo{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new oo(0)}static cr(){return new oo(-1)}}const ao=1048576;class co{constructor(){this.changes=new $s(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,hs.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Wn.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class lo{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class ho{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(n=i,this.remoteDocumentCache.getEntry(t,e))).next(t=>(null!==n&&Rr(n.mutation,t,Ni.empty(),Mn.now()),t))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,cr()).next(()=>e))}getLocalViewOfDocuments(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:cr();const i=sr();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,n).next(t=>{let e=nr();return t.forEach((t,n)=>{e=e.insert(t,n.overlayedDocument)}),e}))}getOverlayedDocuments(t,e){const n=sr();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,cr()))}populateOverlays(t,e,n){const i=[];return n.forEach(t=>{e.has(t)||i.push(t)}),this.documentOverlayCache.getOverlays(t,i).next(t=>{t.forEach((t,n)=>{e.set(t,n)})})}computeViews(t,e,n,i){let s=tr();const r=or(),o=or();return e.forEach((t,e)=>{const o=n.get(e.key);i.has(e.key)&&(void 0===o||o.mutation instanceof xr)?s=s.insert(e.key,e):void 0!==o?(r.set(e.key,o.mutation.getFieldMask()),Rr(o.mutation,e,o.mutation.getFieldMask(),Mn.now())):r.set(e.key,Ni.empty())}),this.recalculateAndSaveOverlays(t,s).next(t=>(t.forEach((t,e)=>r.set(t,e)),e.forEach((t,e)=>{var n;return o.set(t,new lo(e,null!==(n=r.get(t))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(t,e){const n=or();let i=new Ci((t,e)=>t-e),s=cr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(t=>{for(const s of t)s.keys().forEach(t=>{const r=e.get(t);if(null===r)return;let o=n.get(t)||Ni.empty();o=s.applyToLocalView(r,o),n.set(t,o);const a=(i.get(s.batchId)||cr()).add(t);i=i.insert(s.batchId,a)})}).next(()=>{const r=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,c=i.value,l=rr();c.forEach(t=>{if(!s.has(t)){const i=Nr(e.get(t),n.get(t));null!==i&&l.set(t,i),s=s.add(t)}}),r.push(this.documentOverlayCache.saveOverlays(t,a,l))}return Wn.waitFor(r)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(t,e,n,i){return function(t){return kn.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Bs(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,i):this.getDocumentsMatchingCollectionQuery(t,e,n,i)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next(s=>{const r=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-s.size):Wn.resolve(sr());let o=Fn,a=s;return r.next(e=>Wn.forEach(e,(e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?Wn.resolve():this.remoteDocumentCache.getEntry(t,e).next(t=>{a=a.insert(e,t)}))).next(()=>this.populateOverlays(t,e,s)).next(()=>this.computeViews(t,a,e,cr())).next(t=>({batchId:o,changes:ir(t)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new kn(e)).next(t=>{let e=nr();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})}getDocumentsMatchingCollectionGroupQuery(t,e,n,i){const s=e.collectionGroup;let r=nr();return this.indexManager.getCollectionParents(t,s).next(o=>Wn.forEach(o,o=>{const a=function(t,e){return new Fs(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(s));return this.getDocumentsMatchingCollectionQuery(t,a,n,i).next(t=>{t.forEach((t,e)=>{r=r.insert(t,e)})})}).next(()=>r))}getDocumentsMatchingCollectionQuery(t,e,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(r=>(s=r,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,i))).next(t=>{s.forEach((e,n)=>{const i=n.getKey();null===t.get(i)&&(t=t.insert(i,hs.newInvalidDocument(i)))});let n=nr();return t.forEach((t,i)=>{const r=s.get(t);void 0!==r&&Rr(r.mutation,i,Ni.empty(),Mn.now()),Ys(e,i)&&(n=n.insert(t,i))}),n})}}class uo{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return Wn.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:Wr(t.createTime)}}(e)),Wn.resolve()}getNamedQuery(t,e){return Wn.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,function(t){return{name:t.name,query:to(t.bundledQuery),readTime:Wr(t.readTime)}}(e)),Wn.resolve()}}class fo{constructor(){this.overlays=new Ci(kn.comparator),this.qr=new Map}getOverlay(t,e){return Wn.resolve(this.overlays.get(e))}getOverlays(t,e){const n=sr();return Wn.forEach(e,e=>this.getOverlay(t,e).next(t=>{null!==t&&n.set(e,t)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((n,i)=>{this.St(t,e,i)}),Wn.resolve()}removeOverlaysForBatchId(t,e,n){const i=this.qr.get(n);return void 0!==i&&(i.forEach(t=>this.overlays=this.overlays.remove(t)),this.qr.delete(n)),Wn.resolve()}getOverlaysForCollection(t,e,n){const i=sr(),s=e.length+1,r=new kn(e.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const t=o.getNext().value,r=t.getKey();if(!e.isPrefixOf(r.path))break;r.path.length===s&&t.largestBatchId>n&&i.set(t.getKey(),t)}return Wn.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let s=new Ci((t,e)=>t-e);const r=this.overlays.getIterator();for(;r.hasNext();){const t=r.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=sr(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=sr(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((t,e)=>o.set(t,e)),!(o.size()>=i)););return Wn.resolve(o)}St(t,e,n){const i=this.overlays.get(n.key);if(null!==i){const t=this.qr.get(i.largestBatchId).delete(n.key);this.qr.set(i.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Ur(e,n));let s=this.qr.get(e);void 0===s&&(s=cr(),this.qr.set(e,s)),this.qr.set(e,s.add(n.key))}}class po{constructor(){this.sessionToken=Ri.EMPTY_BYTE_STRING}getSessionToken(t){return Wn.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,Wn.resolve()}}class go{constructor(){this.Qr=new Ii(mo.$r),this.Ur=new Ii(mo.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const n=new mo(t,e);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(t,e){t.forEach(t=>this.addReference(t,e))}removeReference(t,e){this.Gr(new mo(t,e))}zr(t,e){t.forEach(t=>this.removeReference(t,e))}jr(t){const e=new kn(new Tn([])),n=new mo(e,t),i=new mo(e,t+1),s=[];return this.Ur.forEachInRange([n,i],t=>{this.Gr(t),s.push(t.key)}),s}Jr(){this.Qr.forEach(t=>this.Gr(t))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new kn(new Tn([])),n=new mo(e,t),i=new mo(e,t+1);let s=cr();return this.Ur.forEachInRange([n,i],t=>{s=s.add(t.key)}),s}containsKey(t){const e=new mo(t,0),n=this.Qr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class mo{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return kn.comparator(t.key,e.key)||mn(t.Yr,e.Yr)}static Kr(t,e){return mn(t.Yr,e.Yr)||kn.comparator(t.key,e.key)}}class _o{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new Ii(mo.$r)}checkEmpty(t){return Wn.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,i){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new Vr(s,e,n,i);this.mutationQueue.push(r);for(const o of i)this.Zr=this.Zr.add(new mo(o.key,s)),this.indexManager.addToCollectionParentIndex(t,o.key.path.popLast());return Wn.resolve(r)}lookupMutationBatch(t,e){return Wn.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,i=this.ei(n),s=i<0?0:i;return Wn.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Wn.resolve(0===this.mutationQueue.length?Qn:this.tr-1)}getAllMutationBatches(t){return Wn.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new mo(e,0),i=new mo(e,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([n,i],t=>{const e=this.Xr(t.Yr);s.push(e)}),Wn.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Ii(mn);return e.forEach(t=>{const e=new mo(t,0),i=new mo(t,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([e,i],t=>{n=n.add(t.Yr)})}),Wn.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,i=n.length+1;let s=n;kn.isDocumentKey(s)||(s=s.child(""));const r=new mo(new kn(s),0);let o=new Ii(mn);return this.Zr.forEachWhile(t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===i&&(o=o.add(t.Yr)),!0)},r),Wn.resolve(this.ti(o))}ti(t){const e=[];return t.forEach(t=>{const n=this.Xr(t);null!==n&&e.push(n)}),e}removeMutationBatch(t,e){tn(0===this.ni(e.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return Wn.forEach(e.mutations,i=>{const s=new mo(i.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.Zr=n})}ir(t){}containsKey(t,e){const n=new mo(e,0),i=this.Zr.firstAfterOrEqual(n);return Wn.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,Wn.resolve()}ni(t,e){return this.ei(t)}ei(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class yo{constructor(t){this.ri=t,this.docs=new Ci(kn.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,i=this.docs.get(n),s=i?i.size:0,r=this.ri(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:r}),this.size+=r-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Wn.resolve(n?n.document.mutableCopy():hs.newInvalidDocument(e))}getEntries(t,e){let n=tr();return e.forEach(t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():hs.newInvalidDocument(t))}),Wn.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let s=tr();const r=e.path,o=new kn(r.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!r.isPrefixOf(t.path))break;t.path.length>r.length+1||qn(jn(o),n)<=0||(i.has(o.key)||Ys(e,o))&&(s=s.insert(o.key,o.mutableCopy()))}return Wn.resolve(s)}getAllFromCollectionGroup(t,e,n,i){$e(9500)}ii(t,e){return Wn.forEach(this.docs,t=>e(t))}newChangeBuffer(t){return new vo(this)}getSize(t){return Wn.resolve(this.size)}}class vo extends co{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?e.push(this.Nr.addEntry(t,i)):this.Nr.removeEntry(n)}),Wn.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class wo{constructor(t){this.persistence=t,this.si=new $s(t=>Ms(t),Ls),this.lastRemoteSnapshotVersion=Ln.min(),this.highestTargetId=0,this.oi=0,this._i=new go,this.targetCount=0,this.ai=oo.ur()}forEachTarget(t,e){return this.si.forEach((t,n)=>e(n)),Wn.resolve()}getLastRemoteSnapshotVersion(t){return Wn.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Wn.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),Wn.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.oi&&(this.oi=e),Wn.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new oo(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,Wn.resolve()}updateTargetData(t,e){return this.Pr(e),Wn.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,Wn.resolve()}removeTargets(t,e,n){let i=0;const s=[];return this.si.forEach((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.si.delete(r),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),i++)}),Wn.waitFor(s).next(()=>i)}getTargetCount(t){return Wn.resolve(this.targetCount)}getTargetData(t,e){const n=this.si.get(e)||null;return Wn.resolve(n)}addMatchingKeys(t,e,n){return this._i.Wr(e,n),Wn.resolve()}removeMatchingKeys(t,e,n){this._i.zr(e,n);const i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(e=>{s.push(i.markPotentiallyOrphaned(t,e))}),Wn.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),Wn.resolve()}getMatchingKeysForTargetId(t,e){const n=this._i.Hr(e);return Wn.resolve(n)}containsKey(t,e){return Wn.resolve(this._i.containsKey(e))}}class bo{constructor(t,e){this.ui={},this.overlays={},this.ci=new Gn(0),this.li=!1,this.li=!0,this.hi=new po,this.referenceDelegate=t(this),this.Pi=new wo(this),this.indexManager=new no,this.remoteDocumentCache=function(t){return new yo(t)}(t=>this.referenceDelegate.Ti(t)),this.serializer=new Zr(e),this.Ii=new uo(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new fo,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ui[t.toKey()];return n||(n=new _o(e,this.referenceDelegate),this.ui[t.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,n){Qe("MemoryPersistence","Starting transaction:",t);const i=new Eo(this.ci.next());return this.referenceDelegate.Ei(),n(i).next(t=>this.referenceDelegate.di(i).next(()=>t)).toPromise().then(t=>(i.raiseOnCommittedEvent(),t))}Ai(t,e){return Wn.or(Object.values(this.ui).map(n=>()=>n.containsKey(t,e)))}}class Eo extends Hn{constructor(t){super(),this.currentSequenceNumber=t}}class Co{constructor(t){this.persistence=t,this.Ri=new go,this.Vi=null}static mi(t){return new Co(t)}get fi(){if(this.Vi)return this.Vi;throw $e(60996)}addReference(t,e,n){return this.Ri.addReference(n,e),this.fi.delete(n.toString()),Wn.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.fi.add(n.toString()),Wn.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),Wn.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach(t=>this.fi.add(t.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(t=>{t.forEach(t=>this.fi.add(t.toString()))}).next(()=>n.removeTargetData(t,e))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Wn.forEach(this.fi,n=>{const i=kn.fromPath(n);return this.gi(t,i).next(t=>{t||e.removeEntry(i,Ln.min())})}).next(()=>(this.Vi=null,e.apply(t)))}updateLimboDocument(t,e){return this.gi(t,e).next(t=>{t?this.fi.delete(e.toString()):this.fi.add(e.toString())})}Ti(t){return 0}gi(t,e){return Wn.or([()=>Wn.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class To{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.Es=n,this.ds=i}static As(t,e){let n=cr(),i=cr();for(const s of e.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new To(t,e.fromCache,n,i)}}class So{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Io{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=F()?8:zn(x())>0?6:4}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,n,i){const s={result:null};return this.ys(t,e).next(t=>{s.result=t}).next(()=>{if(!s.result)return this.ws(t,e,i,n).next(t=>{s.result=t})}).next(()=>{if(s.result)return;const n=new So;return this.Ss(t,e,n).next(i=>{if(s.result=i,this.Vs)return this.bs(t,e,n,i.size)})}).next(()=>s.result)}bs(t,e,n,i){return n.documentReadCount<this.fs?(Ge()<=ot.DEBUG&&Qe("QueryEngine","SDK will not create cache indexes for query:",Qs(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Wn.resolve()):(Ge()<=ot.DEBUG&&Qe("QueryEngine","Query:",Qs(e),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.gs*i?(Ge()<=ot.DEBUG&&Qe("QueryEngine","The SDK decides to create cache indexes for query:",Qs(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Hs(e))):Wn.resolve())}ys(t,e){if(js(e))return Wn.resolve(null);let n=Hs(e);return this.indexManager.getIndexType(t,n).next(i=>0===i?null:(null!==e.limit&&1===i&&(e=zs(e,null,"F"),n=Hs(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(i=>{const s=cr(...i);return this.ps.getDocuments(t,s).next(i=>this.indexManager.getMinOffset(t,n).next(n=>{const r=this.Ds(e,i);return this.Cs(e,r,s,n.readTime)?this.ys(t,zs(e,null,"F")):this.vs(t,r,e,n)}))})))}ws(t,e,n,i){return js(e)||i.isEqual(Ln.min())?Wn.resolve(null):this.ps.getDocuments(t,n).next(s=>{const r=this.Ds(e,s);return this.Cs(e,r,n,i)?Wn.resolve(null):(Ge()<=ot.DEBUG&&Qe("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Qs(e)),this.vs(t,r,e,Un(i,Fn)).next(t=>t))})}Ds(t,e){let n=new Ii(Xs(t));return e.forEach((e,i)=>{Ys(t,i)&&(n=n.add(i))}),n}Cs(t,e,n,i){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ss(t,e,n){return Ge()<=ot.DEBUG&&Qe("QueryEngine","Using full collection scan to execute query:",Qs(e)),this.ps.getDocumentsMatchingQuery(t,e,Bn.min(),n)}vs(t,e,n,i){return this.ps.getDocumentsMatchingQuery(t,n,i).next(t=>(e.forEach(e=>{t=t.insert(e.key,e)}),t))}}const ko="LocalStore";class No{constructor(t,e,n,i){this.persistence=t,this.Fs=e,this.serializer=i,this.Ms=new Ci(mn),this.xs=new $s(t=>Ms(t),Ls),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(n)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new ho(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ms))}}function Ao(t,e,n,i){return new No(t,e,n,i)}async function Ro(t,e){const n=en(t);return await n.persistence.runTransaction("Handle user change","readonly",t=>{let i;return n.mutationQueue.getAllMutationBatches(t).next(s=>(i=s,n.Bs(e),n.mutationQueue.getAllMutationBatches(t))).next(e=>{const s=[],r=[];let o=cr();for(const t of i){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next(t=>({Ls:t,removedBatchIds:s,addedBatchIds:r}))})})}class Do{constructor(){this.activeTargetIds=hr()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Po{constructor(){this.Mo=new Do,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,n){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new Do,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class xo{Oo(t){}shutdown(){}}const Oo="ConnectivityMonitor";class Mo{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Qe(Oo,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){Qe(Oo,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Lo=null;function Fo(){return null===Lo?Lo=268435456+Math.round(2147483648*Math.random()):Lo++,"0x"+Lo.toString(16)}const Vo="RestConnection",Uo={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class jo{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko="projects/".concat(n,"/databases/").concat(i),this.Wo=this.databaseId.database===qi?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(i)}Go(t,e,n,i,s){const r=Fo(),o=this.zo(t,e.toUriEncodedString());Qe(Vo,"Sending RPC '".concat(t,"' ").concat(r,":"),o,n);const a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,i,s);const{host:c}=new URL(o),l=k(c);return this.Jo(t,o,a,n,l).then(e=>(Qe(Vo,"Received RPC '".concat(t,"' ").concat(r,": "),e),e),e=>{throw Xe(Vo,"RPC '".concat(t,"' ").concat(r," failed with error: "),e,"url: ",o,"request:",n),e})}Ho(t,e,n,i,s,r){return this.Go(t,e,n,i,s)}jo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+ze,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,n)=>t[n]=e),n&&n.headers.forEach((e,n)=>t[n]=e)}zo(t,e){const n=Uo[t];return"".concat(this.Uo,"/v1/").concat(e,":").concat(n)}terminate(){}}class Bo{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const qo="WebChannelConnection";class Ho extends jo{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,i,s){const r=Fo();return new Promise((s,o)=>{const a=new Pe;a.setWithCredentials(!0),a.listenOnce(Oe.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Me.NO_ERROR:const n=a.getResponseJson();Qe(qo,"XHR for RPC '".concat(t,"' ").concat(r," received:"),JSON.stringify(n)),s(n);break;case Me.TIMEOUT:Qe(qo,"RPC '".concat(t,"' ").concat(r," timed out")),o(new sn(nn.DEADLINE_EXCEEDED,"Request time out"));break;case Me.HTTP_ERROR:const i=a.getStatus();if(Qe(qo,"RPC '".concat(t,"' ").concat(r," failed with status:"),i,"response text:",a.getResponseText()),i>0){var e;let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const n=null===(e=t)||void 0===e?void 0:e.error;if(n&&n.status&&n.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(nn).indexOf(e)>=0?e:nn.UNKNOWN}(n.status);o(new sn(t,n.message))}else o(new sn(nn.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new sn(nn.UNAVAILABLE,"Connection failed."));break;default:$e(9055,{l_:t,streamId:r,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{Qe(qo,"RPC '".concat(t,"' ").concat(r," completed."))}});const c=JSON.stringify(i);Qe(qo,"RPC '".concat(t,"' ").concat(r," sending request:"),i),a.send(e,"POST",c,n,15)})}T_(t,e,n){const i=Fo(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Ue(),o=Ve(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const l=s.join("");Qe(qo,"Creating RPC '".concat(t,"' stream ").concat(i,": ").concat(l),a);const h=r.createWebChannel(l,a);this.I_(h);let u=!1,d=!1;const f=new Bo({Yo:e=>{d?Qe(qo,"Not sending because RPC '".concat(t,"' stream ").concat(i," is closed:"),e):(u||(Qe(qo,"Opening RPC '".concat(t,"' stream ").concat(i," transport.")),h.open(),u=!0),Qe(qo,"RPC '".concat(t,"' stream ").concat(i," sending:"),e),h.send(e))},Zo:()=>h.close()}),p=(t,e,n)=>{t.listen(e,t=>{try{n(t)}catch(t){setTimeout(()=>{throw t},0)}})};return p(h,xe.EventType.OPEN,()=>{d||(Qe(qo,"RPC '".concat(t,"' stream ").concat(i," transport opened.")),f.o_())}),p(h,xe.EventType.CLOSE,()=>{d||(d=!0,Qe(qo,"RPC '".concat(t,"' stream ").concat(i," transport closed")),f.a_(),this.E_(h))}),p(h,xe.EventType.ERROR,e=>{d||(d=!0,Xe(qo,"RPC '".concat(t,"' stream ").concat(i," transport errored. Name:"),e.name,"Message:",e.message),f.a_(new sn(nn.UNAVAILABLE,"The operation could not be completed")))}),p(h,xe.EventType.MESSAGE,e=>{if(!d){var n;const s=e.data[0];tn(!!s,16349);const r=s,o=(null===r||void 0===r?void 0:r.error)||(null===(n=r[0])||void 0===n?void 0:n.error);if(o){Qe(qo,"RPC '".concat(t,"' stream ").concat(i," received error:"),o);const e=o.status;let n=function(t){const e=jr[t];if(void 0!==e)return qr(e)}(e),s=o.message;void 0===n&&(n=nn.INTERNAL,s="Unknown error status: "+e+" with message "+o.message),d=!0,f.a_(new sn(n,s)),h.close()}else Qe(qo,"RPC '".concat(t,"' stream ").concat(i," received:"),s),f.u_(s)}}),p(o,Fe.STAT_EVENT,e=>{e.stat===Le.PROXY?Qe(qo,"RPC '".concat(t,"' stream ").concat(i," detected buffering proxy")):e.stat===Le.NOPROXY&&Qe(qo,"RPC '".concat(t,"' stream ").concat(i," detected no buffering proxy"))}),setTimeout(()=>{f.__()},0),f}terminate(){this.c_.forEach(t=>t.close()),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter(e=>e===t)}}function Wo(){return"undefined"!=typeof document?document:null}function zo(t){return new Hr(t,!0)}class Ko{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.Mi=t,this.timerId=e,this.d_=n,this.A_=i,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),i=Math.max(0,e-n);i>0&&Qe("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.V_," ms, delay with jitter: ").concat(e," ms, last attempt: ").concat(n," ms ago)")),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),t())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}class Go{}class Qo extends Go{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new sn(nn.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(s=>{let[r,o]=s;return this.connection.Go(t,zr(e,n),i,r,o)}).catch(t=>{throw"FirebaseError"===t.name?(t.code===nn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new sn(nn.UNKNOWN,t.toString())})}Ho(t,e,n,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(r=>{let[o,a]=r;return this.connection.Ho(t,zr(e,n),i,o,a,s)}).catch(t=>{throw"FirebaseError"===t.name?(t.code===nn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new sn(nn.UNKNOWN,t.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class Yo{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(t){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la("Connection failed 1 times. Most recent error: ".concat(t.toString())),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,"Online"===t&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e="Could not reach Cloud Firestore backend. ".concat(t,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.aa?(Ye(e),this.aa=!1):Qe("OnlineStateTracker",e)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const Xo="RemoteStore";class Jo{constructor(t,e,n,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo(t=>{n.enqueueAndForget(async()=>{ta(this)&&(Qe(Xo,"Restarting streams for network reachability change."),await async function(t){const e=en(t);e.Ea.add(4),await Zo(e),e.Ra.set("Unknown"),e.Ea.delete(4),await $o(e)}(this))})}),this.Ra=new Yo(n,i)}}async function $o(t){if(ta(t))for(const e of t.da)await e(!0)}async function Zo(t){for(const e of t.da)await e(!1)}function ta(t){return 0===en(t).Ea.size}async function ea(t,e){const n=en(t);e?(n.Ea.delete(2),await $o(n)):e||(n.Ea.add(2),await Zo(n),n.Ra.set("Unknown"))}class na{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new rn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(t=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,i,s){const r=Date.now()+n,o=new na(t,e,r,i,s);return o.start(n),o}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new sn(nn.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}class ia{constructor(){this.queries=sa(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(t,e){const n=en(t),i=n.queries;n.queries=sa(),i.forEach((t,n)=>{for(const i of n.Sa)i.onError(e)})}(this,new sn(nn.ABORTED,"Firestore shutting down"))}}function sa(){return new $s(t=>Gs(t),Ks)}function ra(t){t.Ca.forEach(t=>{t.next()})}var oa,aa;(aa=oa||(oa={})).Ma="default",aa.Cache="cache";const ca="SyncEngine";class la{constructor(t,e,n,i,s,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=r,this.Pu={},this.Tu=new $s(t=>Gs(t),Ks),this.Iu=new Map,this.Eu=new Set,this.du=new Ci(kn.comparator),this.Au=new Map,this.Ru=new go,this.Vu={},this.mu=new Map,this.fu=oo.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}function ha(t,e,n){const i=en(t);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const t=[];i.Tu.forEach((n,i)=>{const s=i.view.va(e);s.snapshot&&t.push(s.snapshot)}),function(t,e){const n=en(t);n.onlineState=e;let i=!1;n.queries.forEach((t,n)=>{for(const s of n.Sa)s.va(e)&&(i=!0)}),i&&ra(n)}(i.eventManager,e),t.length&&i.Pu.H_(t),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function ua(t,e,n){const i=en(t),s=[],r=[],o=[];i.Tu.isEmpty()||(i.Tu.forEach((t,a)=>{o.push(i.pu(a,e,n).then(t=>{if((t||n)&&i.isPrimaryClient){var e;const s=t?!t.fromCache:null===n||void 0===n||null===(e=n.targetChanges.get(a.targetId))||void 0===e?void 0:e.current;i.sharedClientState.updateQueryState(a.targetId,s?"current":"not-current")}if(t){s.push(t);const e=To.As(a.targetId,t);r.push(e)}}))}),await Promise.all(o),i.Pu.H_(s),await async function(t,e){const n=en(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",t=>Wn.forEach(e,e=>Wn.forEach(e.Es,i=>n.persistence.referenceDelegate.addReference(t,e.targetId,i)).next(()=>Wn.forEach(e.ds,i=>n.persistence.referenceDelegate.removeReference(t,e.targetId,i)))))}catch(t){if(!Kn(t))throw t;Qe(ko,"Failed to update sequence numbers: "+t)}for(const i of e){const t=i.targetId;if(!i.fromCache){const e=n.Ms.get(t),i=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(i);n.Ms=n.Ms.insert(t,s)}}}(i.localStore,r))}async function da(t,e){const n=en(t);if(!n.currentUser.isEqual(e)){Qe(ca,"User change. New user:",e.toKey());const t=await Ro(n.localStore,e);n.currentUser=e,function(t,e){t.mu.forEach(t=>{t.forEach(t=>{t.reject(new sn(nn.CANCELLED,e))})}),t.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await ua(n,t.Ls)}}class fa{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=zo(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return Ao(this.persistence,new Io,t.initialUser,this.serializer)}Cu(t){return new bo(Co.mi,this.serializer)}Du(t){return new Po}async terminate(){var t,e;null!==(t=this.gcScheduler)&&void 0!==t&&t.stop(),null!==(e=this.indexBackfillerScheduler)&&void 0!==e&&e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}fa.provider={build:()=>new fa};class pa{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>ha(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=da.bind(null,this.syncEngine),await ea(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new ia}createDatastore(t){const e=zo(t.databaseInfo.databaseId),n=function(t){return new Ho(t)}(t.databaseInfo);return function(t,e,n,i){return new Qo(t,e,n,i)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,i,s){return new Jo(t,e,n,i,s)}(this.localStore,this.datastore,t.asyncQueue,t=>ha(this.syncEngine,t,0),Mo.v()?new Mo:new xo)}createSyncEngine(t,e){return function(t,e,n,i,s,r,o){const a=new la(t,e,n,i,s,r);return o&&(a.gu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t,e;await async function(t){const e=en(t);Qe(Xo,"RemoteStore shutting down."),e.Ea.add(5),await Zo(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),null!==(t=this.datastore)&&void 0!==t&&t.terminate(),null===(e=this.eventManager)||void 0===e||e.terminate()}}pa.provider={build:()=>new pa};function ga(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const ma=new Map,_a="firestore.googleapis.com",ya=!0;class va{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new sn(nn.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=_a,this.ssl=ya}else this.host=t.host,this.ssl=null!==(e=t.ssl)&&void 0!==e?e:ya;if(this.isUsingEmulator=void 0!==t.emulatorOptions,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=so;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<ao)throw new sn(nn.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,i){if(!0===e&&!0===i)throw new sn(nn.INVALID_ARGUMENT,"".concat(t," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ga(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new sn(nn.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(t.timeoutSeconds," (must not be NaN)"));if(t.timeoutSeconds<5)throw new sn(nn.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(t.timeoutSeconds," (minimum allowed value is 5)"));if(t.timeoutSeconds>30)throw new sn(nn.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(t.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class wa{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new va({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new sn(nn.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new sn(nn.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new va(t),this._emulatorOptions=t.emulatorOptions||{},void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new an;switch(t.type){case"firstParty":return new un(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new sn(nn.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=ma.get(t);e&&(Qe("ComponentProvider","Removing Datastore"),ma.delete(t),e.terminate())}(this),Promise.resolve()}}class ba{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new ba(this.firestore,t,this._query)}}class Ea{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ca(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Ea(this.firestore,t,this._key)}toJSON(){return{type:Ea._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(Pn(e,Ea._jsonSchema))return new Ea(t,n||null,new kn(Tn.fromString(e.referencePath)))}}Ea._jsonSchemaVersion="firestore/documentReference/1.0",Ea._jsonSchema={type:Dn("string",Ea._jsonSchemaVersion),referencePath:Dn("string")};class Ca extends ba{constructor(t,e,n){super(t,e,Us(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Ea(this.firestore,null,new kn(t))}withConverter(t){return new Ca(this.firestore,t,this._path)}}const Ta="AsyncQueue";class Sa{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Ko(this,"async_queue_retry"),this._c=()=>{const t=Wo();t&&Qe(Ta,"Visibility state changed to "+t.visibilityState),this.M_.w_()},this.ac=t;const e=Wo();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=Wo();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise(()=>{});const e=new rn;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Xu.push(t),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!Kn(t))throw t;Qe(Ta,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(t){const e=this.ac.then(()=>(this.rc=!0,t().catch(t=>{throw this.nc=t,this.rc=!1,Ye("INTERNAL UNHANDLED ERROR: ",Ia(t)),t}).then(t=>(this.rc=!1,t))));return this.ac=e,e}enqueueAfterDelay(t,e,n){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const i=na.createAndSchedule(this,t,e,n,t=>this.hc(t));return this.tc.push(i),i}uc(){this.nc&&$e(47125,{Pc:Ia(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do{t=this.ac,await t}while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then(()=>{this.tc.sort((t,e)=>t.targetTimeMs-e.targetTimeMs);for(const e of this.tc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Tc()})}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function Ia(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}class ka extends wa{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new Sa,this._persistenceKey=(null===i||void 0===i?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new Sa(t),this._firestoreClient=void 0,await t}}}class Na{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Na(Ri.fromBase64String(t))}catch(t){throw new sn(nn.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Na(Ri.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Na._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Pn(t,Na._jsonSchema))return Na.fromBase64String(t.bytes)}}Na._jsonSchemaVersion="firestore/bytes/1.0",Na._jsonSchema={type:Dn("string",Na._jsonSchemaVersion),bytes:Dn("string")};class Aa{constructor(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(let i=0;i<e.length;++i)if(0===e[i].length)throw new sn(nn.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new In(e)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Ra{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new sn(nn.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new sn(nn.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return mn(this._lat,t._lat)||mn(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ra._jsonSchemaVersion}}static fromJSON(t){if(Pn(t,Ra._jsonSchema))return new Ra(t.latitude,t.longitude)}}Ra._jsonSchemaVersion="firestore/geoPoint/1.0",Ra._jsonSchema={type:Dn("string",Ra._jsonSchemaVersion),latitude:Dn("number"),longitude:Dn("number")};class Da{constructor(t){this._values=(t||[]).map(t=>t)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(this._values,t._values)}toJSON(){return{type:Da._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Pn(t,Da._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(t=>"number"==typeof t))return new Da(t.vectorValues);throw new sn(nn.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Da._jsonSchemaVersion="firestore/vectorValue/1.0",Da._jsonSchema={type:Dn("string",Da._jsonSchemaVersion),vectorValues:Dn("object")};const Pa=new RegExp("[~\\*/\\[\\]]");function xa(t,e,n){if(e.search(Pa)>=0)throw Oa("Invalid field path (".concat(e,"). Paths must not contain '~', '*', '/', '[', or ']'"),t,!1,void 0,n);try{return new Aa(...e.split("."))._internalPath}catch(i){throw Oa("Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),t,!1,void 0,n)}}function Oa(t,e,n,i,s){const r=i&&!i.isEmpty(),o=void 0!==s;let a="Function ".concat(e,"() called with invalid data");n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=" in field ".concat(i)),o&&(c+=" in document ".concat(s)),c+=")"),new sn(nn.INVALID_ARGUMENT,a+t+c)}class Ma{constructor(t,e,n,i,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ea(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new La(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Fa("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class La extends Ma{data(){return super.data()}}function Fa(t,e){return"string"==typeof e?xa(t,e):e instanceof Aa?e._internalPath:e._delegate._internalPath}class Va{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Ua extends Ma{constructor(t,e,n,i,s,r){super(t,e,n,i,r),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const e=new ja(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(Fa("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new sn(nn.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=Ua._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),t&&t.isValidDocument()&&t.isFoundDocument()?(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e):e}}Ua._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ua._jsonSchema={type:Dn("string",Ua._jsonSchemaVersion),bundleSource:Dn("string","DocumentSnapshot"),bundleName:Dn("string"),bundle:Dn("string")};class ja extends Ua{data(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(t)}}class Ba{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new Va(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new ja(this._firestore,this._userDataWriter,n.key,n,new Va(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(){const t=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new sn(nn.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map(n=>{const i=new ja(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Va(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:e++}})}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(t=>e||3!==t.type).map(e=>{const i=new ja(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Va(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,r=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),r=n.indexOf(e.doc.key)),{type:qa(e.type),doc:i,oldIndex:s,newIndex:r}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new sn(nn.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=Ba._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=gn.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],n=[],i=[];return this.docs.forEach(t=>{null!==t._document&&(e.push(t._document),n.push(this._userDataWriter.convertObjectMap(t._document.data.value.mapValue.fields,"previous")),i.push(t.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function qa(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $e(61501,{type:t})}}Ba._jsonSchemaVersion="firestore/querySnapshot/1.0",Ba._jsonSchema={type:Dn("string",Ba._jsonSchemaVersion),bundleSource:Dn("string","QuerySnapshot"),bundleName:Dn("string"),bundle:Dn("string")};new WeakMap;!function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(t){ze=t}(ge),he(new et("firestore",(t,n)=>{let{instanceIdentifier:i,options:s}=n;const r=t.getProvider("app").getImmediate(),o=new ka(new ln(t.getProvider("auth-internal")),new fn(r,t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new sn(nn.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Hi(t.options.projectId,e)}(r,i),r);return s=a({useFetchStreams:e},s),o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),ye(qe,He,t),ye(qe,He,"esm2020")}();const Ha="@firebase/database",Wa="1.1.0";let za="";function Ka(t){za=t}class Ga{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),H(e))}get(t){const e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:q(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}class Qa{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e}get(t){return z(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}const Ya=function(t){try{if("undefined"!==typeof window&&"undefined"!==typeof window[t]){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Ga(e)}}catch(e){}return new Qa},Xa=Ya("localStorage"),Ja=Ya("sessionStorage"),$a=new ut("@firebase/database"),Za=function(){let t=1;return function(){return t++}}(),tc=function(t){const e=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);if(s>=55296&&s<=56319){const e=s-55296;i++,u(i<t.length,"Surrogate pair missing trail surrogate."),s=65536+(e<<10)+(t.charCodeAt(i)-56320)}s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):s<65536?(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e}(t),n=new J;n.update(e);const i=n.digest();return p.encodeByteArray(i)},ec=function(){let t="";for(let e=0;e<arguments.length;e++){const n=e<0||arguments.length<=e?void 0:arguments[e];Array.isArray(n)||n&&"object"===typeof n&&"number"===typeof n.length?t+=ec.apply(null,n):t+="object"===typeof n?H(n):n,t+=" "}return t};let nc=null,ic=!0;const sc=function(t,e){u(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?($a.logLevel=ot.VERBOSE,nc=$a.log.bind($a),e&&Ja.set("logging_enabled",!0)):"function"===typeof t?nc=t:(nc=null,Ja.remove("logging_enabled"))},rc=function(){if(!0===ic&&(ic=!1,null===nc&&!0===Ja.get("logging_enabled")&&sc(!0)),nc){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=ec.apply(null,e);nc(i)}},oc=function(t){return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];rc(t,...n)}},ac=function(){const t="FIREBASE INTERNAL ERROR: "+ec(...arguments);$a.error(t)},cc=function(){const t="FIREBASE FATAL ERROR: ".concat(ec(...arguments));throw $a.error(t),new Error(t)},lc=function(){const t="FIREBASE WARNING: "+ec(...arguments);$a.warn(t)},hc=function(t){return"number"===typeof t&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},uc="[MIN_NAME]",dc="[MAX_NAME]",fc=function(t,e){if(t===e)return 0;if(t===uc||e===dc)return-1;if(e===uc||t===dc)return 1;{const n=bc(t),i=bc(e);return null!==n?null!==i?n-i===0?t.length-e.length:n-i:-1:null!==i?1:t<e?-1:1}},pc=function(t,e){return t===e?0:t<e?-1:1},gc=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+H(e))},mc=function(t){if("object"!==typeof t||null===t)return H(t);const e=[];for(const i in t)e.push(i);e.sort();let n="{";for(let i=0;i<e.length;i++)0!==i&&(n+=","),n+=H(e[i]),n+=":",n+=mc(t[e[i]]);return n+="}",n},_c=function(t,e){const n=t.length;if(n<=e)return[t];const i=[];for(let s=0;s<n;s+=e)s+e>n?i.push(t.substring(s,n)):i.push(t.substring(s,s+e));return i};function yc(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const vc=function(t){u(!hc(t),"Invalid JSON number");const e=1023;let n,i,s,r,o;0===t?(i=0,s=0,n=1/t===-1/0?1:0):(n=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(r=Math.min(Math.floor(Math.log(t)/Math.LN2),e),i=r+e,s=Math.round(t*Math.pow(2,52-r)-Math.pow(2,52))):(i=0,s=Math.round(t/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(s%2?1:0),s=Math.floor(s/2);for(o=11;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);a.push(n?1:0),a.reverse();const c=a.join("");let l="";for(o=0;o<64;o+=8){let t=parseInt(c.substr(o,8),2).toString(16);1===t.length&&(t="0"+t),l+=t}return l.toLowerCase()};const wc=new RegExp("^-?(0*)\\d{1,10}$"),bc=function(t){if(wc.test(t)){const e=Number(t);if(e>=-2147483648&&e<=2147483647)return e}return null},Ec=function(t){try{t()}catch(e){setTimeout(()=>{const t=e.stack||"";throw lc("Exception was thrown by user callback.",t),e},Math.floor(0))}},Cc=function(t,e){const n=setTimeout(t,e);return"number"===typeof n&&"undefined"!==typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"===typeof n&&n.unref&&n.unref(),n};class Tc{constructor(t,e){this.appCheckProvider=e,this.appName=t.name,de(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.appCheck=null===e||void 0===e?void 0:e.getImmediate({optional:!0}),this.appCheck||null===e||void 0===e||e.get().then(t=>this.appCheck=t)}getToken(t){if(this.serverAppAppCheckToken){if(t)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(t):new Promise((e,n)=>{setTimeout(()=>{this.appCheck?this.getToken(t).then(e,n):e(null)},0)})}addTokenChangeListener(t){var e;null===(e=this.appCheckProvider)||void 0===e||e.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){lc('Provided AppCheck credentials for the app named "'.concat(this.appName,'" ')+"are invalid. This usually indicates your app was not initialized correctly.")}}class Sc{constructor(t,e,n){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(t=>this.auth_=t)}getToken(t){return this.auth_?this.auth_.getToken(t).catch(t=>t&&"auth/token-not-initialized"===t.code?(rc("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((e,n)=>{setTimeout(()=>{this.auth_?this.getToken(t).then(e,n):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',lc(t)}}class Ic{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}Ic.OWNER="owner";const kc="5",Nc=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Ac="ac",Rc="websocket",Dc="long_polling";class Pc{constructor(t,e,n,i){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.secure=e,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=r,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=c,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Xa.get("host:"+t)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Xa.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){const t=this.secure?"https://":"http://",e=this.includeNamespaceInQueryParams?"?ns=".concat(this.namespace):"";return"".concat(t).concat(this.host,"/").concat(e)}}function xc(t,e,n){let i;if(u("string"===typeof e,"typeof type must == string"),u("object"===typeof n,"typeof params must == object"),e===Rc)i=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else{if(e!==Dc)throw new Error("Unknown connection type: "+e);i=(t.secure?"https://":"http://")+t.internalHost+"/.lp?"}(function(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams})(t)&&(n.ns=t.namespace);const s=[];return yc(n,(t,e)=>{s.push(t+"="+e)}),i+s.join("&")}class Oc{constructor(){this.counters_={}}incrementCounter(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;z(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return v(this.counters_)}}const Mc={},Lc={};function Fc(t){const e=t.toString();return Mc[e]||(Mc[e]=new Oc),Mc[e]}class Vc{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){for(this.pendingResponses[t]=e;this.pendingResponses[this.currentResponseNum];){const t=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<t.length;++e)t[e]&&Ec(()=>{this.onMessage_(t[e])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Uc="start";class jc{constructor(t,e,n,i,s,r,o){this.connId=t,this.repoInfo=e,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.transportSessionId=r,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=oc(t),this.stats_=Fc(e),this.urlFn=t=>(this.appCheckToken&&(t[Ac]=this.appCheckToken),xc(e,Dc,t))}open(t,e){var n=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Vc(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if(L()||"complete"===document.readyState)t();else{let e=!1;const n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Bc(function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];const[s,r,o,a,c]=e;if(n.incrementIncomingBytes_(e),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,s===Uc)n.id=r,n.password=o;else{if("close"!==s)throw new Error("Unrecognized command received: "+s);r?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(r,()=>{n.onClosed_()})):n.onClosed_()}},function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];const[s,r]=e;n.incrementIncomingBytes_(e),n.myPacketOrderer.handleResponse(s,r)},()=>{this.onClosed_()},this.urlFn);const t={};t[Uc]="t",t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v=kc,this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t[Ac]=this.appCheckToken),"undefined"!==typeof location&&location.hostname&&Nc.test(location.hostname)&&(t.r="f");const e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){jc.forceAllow_=!0}static forceDisallow(){jc.forceDisallow_=!0}static isAvailable(){return!L()&&(!!jc.forceAllow_||!jc.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!("object"===typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"===typeof Windows&&"object"===typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const e=H(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const n=m(e),i=_c(n,1840);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(t,e){if(L())return;this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const e=H(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class Bc{constructor(t,e,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,L())this.commandCB=t,this.onMessageCB=e;else{this.uniqueCallbackIdentifier=Za(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=Bc.createIFrame_();let n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){n='<script>document.domain="'+document.domain+'";<\/script>'}const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(s){rc("frame writing exception"),s.stack&&rc(s.stack),rc(s)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||rc("No IE domain setting required")}catch(e){const n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;let e=this.urlFn(t),n="",i=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const t=this.pendingSegs.shift();n=n+"&seg"+i+"="+t.seg+"&ts"+i+"="+t.ts+"&d"+i+"="+t.d,i++}}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1}enqueueSegment(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);const n=()=>{this.outstandingRequests.delete(e),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(t,()=>{clearTimeout(i),n()})}addTag(t,e){L()?this.doNodeLongPoll(t,e):setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=t,n.onload=n.onreadystatechange=function(){const t=n.readyState;t&&"loaded"!==t&&"complete"!==t||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),e())},n.onerror=()=>{rc("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(n){}},Math.floor(1))}}let qc=null;"undefined"!==typeof MozWebSocket?qc=MozWebSocket:"undefined"!==typeof WebSocket&&(qc=WebSocket);class Hc{constructor(t,e,n,i,s,r,o){this.connId=t,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=oc(this.connId),this.stats_=Fc(e),this.connURL=Hc.connectionURL_(e,r,o,i,n),this.nodeAdmin=e.nodeAdmin}static connectionURL_(t,e,n,i,s){const r={};return r.v=kc,!L()&&"undefined"!==typeof location&&location.hostname&&Nc.test(location.hostname)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),i&&(r[Ac]=i),s&&(r.p=s),xc(t,Rc,r)}open(t,e){this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Xa.set("previous_websocket_failure",!0);try{let t;if(L()){const e=this.nodeAdmin?"AdminNode":"Node";t={headers:{"User-Agent":"Firebase/".concat(kc,"/").concat(za,"/").concat(process.platform,"/").concat(e),"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(t.headers.Authorization="Bearer ".concat(this.authToken)),this.appCheckToken&&(t.headers["X-Firebase-AppCheck"]=this.appCheckToken);const n={NODE_ENV:"production",PUBLIC_URL:"/balancestracker",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0},i=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;i&&(t.proxy={origin:i})}this.mySock=new qc(this.connURL,[],t)}catch(n){this.log_("Error instantiating WebSocket.");const t=n.message||n.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=t=>{this.handleIncomingFrame(t)},this.mySock.onerror=t=>{this.log_("WebSocket error.  Closing connection.");const e=t.message||t.data;e&&this.log_(e),this.onClosed_()}}start(){}static forceDisallow(){Hc.forceDisallow_=!0}static isAvailable(){let t=!1;if("undefined"!==typeof navigator&&navigator.userAgent){const e=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(e);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&null!==qc&&!Hc.forceDisallow_}static previouslyFailed(){return Xa.isInMemoryStorage||!0===Xa.get("previous_websocket_failure")}markConnectionHealthy(){Xa.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const e=q(t);this.onMessage(e)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(u(null===this.frames,"We already have a frame buffer"),t.length<=6){const e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{const t=this.extractFrameCount_(e);null!==t&&this.appendFrame_(t)}}send(t){this.resetKeepAlive();const e=H(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const n=_c(e,16384);n.length>1&&this.sendString_(String(n.length));for(let i=0;i<n.length;i++)this.sendString_(n[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(t){try{this.mySock.send(t)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Hc.responsesRequiredToBeHealthy=2,Hc.healthyTimeout=3e4;class Wc{static get ALL_TRANSPORTS(){return[jc,Hc]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){const e=Hc&&Hc.isAvailable();let n=e&&!Hc.previouslyFailed();if(t.webSocketOnly&&(e||lc("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Hc];else{const t=this.transports_=[];for(const e of Wc.ALL_TRANSPORTS)e&&e.isAvailable()&&t.push(e);Wc.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Wc.globalTransportInitialized_=!1;class zc{constructor(t,e,n,i,s,r,o,a,c,l){this.id=t,this.repoInfo_=e,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=r,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=oc("c:"+this.id+":"),this.transportManager_=new Wc(e),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(e,n)},Math.floor(0));const i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=Cc(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){const e={t:"d",d:t};this.sendData_(e)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if("t"in t){const e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const e=gc("t",t),n=gc("d",t);if("c"===e)this.onSecondaryControl_(n);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const e=gc("t",t),n=gc("d",t);"c"===e?this.onControl_(n):"d"===e&&this.onDataMessage_(n)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const e=gc("t",t);if("d"in t){const n=t.d;if("h"===e){const t=a({},n);this.repoInfo_.isUsingEmulator&&(t.h=this.repoInfo_.host),this.onHandshake_(t)}else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let t=0;t<this.pendingDataMessages.length;++t)this.onDataMessage_(this.pendingDataMessages[t]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?ac("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ac("Unknown control packet command: "+e)}}onHandshake_(t){const e=t.ts,n=t.v,i=t.h;this.sessionId=t.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),kc!==n&&lc("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,n),Cc(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Cc(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()}onConnectionLost_(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Xa.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Kc{put(t,e,n,i){}merge(t,e,n,i){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,n){}onDisconnectMerge(t,e,n){}onDisconnectCancel(t,e){}reportStats(t){}}class Gc{constructor(t){this.allowedEvents_=t,this.listeners_={},u(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t){if(Array.isArray(this.listeners_[t])){const s=[...this.listeners_[t]];for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(let t=0;t<s.length;t++)s[t].callback.apply(s[t].context,n)}}on(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});const i=this.getInitialEvent(t);i&&e.apply(n,i)}off(t,e,n){this.validateEventType_(t);const i=this.listeners_[t]||[];for(let s=0;s<i.length;s++)if(i[s].callback===e&&(!n||n===i[s].context))return void i.splice(s,1)}validateEventType_(t){u(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class Qc extends Gc{static getInstance(){return new Qc}constructor(){super(["online"]),this.online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||O()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(t){return u("online"===t,"Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}class Yc{constructor(t,e){if(void 0===e){this.pieces_=t.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)this.pieces_[t].length>0&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function Xc(){return new Yc("")}function Jc(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function $c(t){return t.pieces_.length-t.pieceNum_}function Zc(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new Yc(t.pieces_,e)}function tl(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function el(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.pieces_.slice(t.pieceNum_+e)}function nl(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new Yc(e,0)}function il(t,e){const n=[];for(let i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);if(e instanceof Yc)for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);else{const t=e.split("/");for(let e=0;e<t.length;e++)t[e].length>0&&n.push(t[e])}return new Yc(n,0)}function sl(t){return t.pieceNum_>=t.pieces_.length}function rl(t,e){const n=Jc(t),i=Jc(e);if(null===n)return e;if(n===i)return rl(Zc(t),Zc(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function ol(t,e){if($c(t)!==$c(e))return!1;for(let n=t.pieceNum_,i=e.pieceNum_;n<=t.pieces_.length;n++,i++)if(t.pieces_[n]!==e.pieces_[i])return!1;return!0}function al(t,e){let n=t.pieceNum_,i=e.pieceNum_;if($c(t)>$c(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[i])return!1;++n,++i}return!0}class cl{constructor(t,e){this.errorPrefix_=e,this.parts_=el(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=Z(this.parts_[n]);ll(this)}}function ll(t){if(t.byteLength_>768)throw new Error(t.errorPrefix_+"has a key path longer than 768 bytes ("+t.byteLength_+").");if(t.parts_.length>32)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+hl(t))}function hl(t){return 0===t.parts_.length?"":"in property '"+t.parts_.join(".")+"'"}class ul extends Gc{static getInstance(){return new ul}constructor(){let t,e;super(["visible"]),"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document.hidden?(e="visibilitychange",t="hidden"):"undefined"!==typeof document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):"undefined"!==typeof document.msHidden?(e="msvisibilitychange",t="msHidden"):"undefined"!==typeof document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{const e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))},!1)}getInitialEvent(t){return u("visible"===t,"Unknown event type: "+t),[this.visible_]}}const dl=1e3;class fl extends Kc{constructor(t,e,n,i,s,r,o,a){if(super(),this.repoInfo_=t,this.applicationId_=e,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=r,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=fl.nextPersistentConnectionId_++,this.log_=oc("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=dl,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!L())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");ul.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&Qc.getInstance().on("online",this.onOnline_,this)}sendRequest(t,e,n){const i=++this.requestNumber_,s={r:i,a:t,b:e};this.log_(H(s)),u(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),n&&(this.requestCBHash_[i]=n)}get(t){this.initConnection_();const e=new I,n={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:t=>{const n=t.d;"ok"===t.s?e.resolve(n):e.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),e.promise}listen(t,e,n,i){this.initConnection_();const s=t._queryIdentifier,r=t._path.toString();this.log_("Listen called for "+r+" "+s),this.listens.has(r)||this.listens.set(r,new Map),u(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),u(!this.listens.get(r).has(s),"listen() called twice for same path/queryId.");const o={onComplete:i,hashFn:e,query:t,tag:n};this.listens.get(r).set(s,o),this.connected_&&this.sendListen_(o)}sendGet_(t){const e=this.outstandingGets_[t];this.sendRequest("g",e.request,n=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),e.onComplete&&e.onComplete(n)})}sendListen_(t){const e=t.query,n=e._path.toString(),i=e._queryIdentifier;this.log_("Listen on "+n+" for "+i);const s={p:n};t.tag&&(s.q=e._queryObject,s.t=t.tag),s.h=t.hashFn(),this.sendRequest("q",s,s=>{const r=s.d,o=s.s;fl.warnOnListenWarnings_(r,e);(this.listens.get(n)&&this.listens.get(n).get(i))===t&&(this.log_("listen response",s),"ok"!==o&&this.removeListen_(n,i),t.onComplete&&t.onComplete(o,r))})}static warnOnListenWarnings_(t,e){if(t&&"object"===typeof t&&z(t,"w")){const n=K(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const t='".indexOn": "'+e._queryParams.getIndex().toString()+'"',n=e._path.toString();lc("Using an unspecified index. Your data will be downloaded and "+"filtered on the client. Consider adding ".concat(t," at ")+"".concat(n," to your security rules for better performance."))}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&40===t.length||function(t){const e=W(t).claims;return"object"===typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,e=function(t){const e=W(t).claims;return!!e&&"object"===typeof e&&e.hasOwnProperty("iat")}(t)?"auth":"gauth",n={cred:t};null===this.authOverride_?n.noauth=!0:"object"===typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(e,n,e=>{const n=e.s,i=e.d||"error";this.authToken_===t&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{const e=t.s,n=t.d||"error";"ok"===e?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(e,n)})}unlisten(t,e){const n=t._path.toString(),i=t._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),u(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,t._queryObject,e)}sendUnlisten_(t,e,n,i){this.log_("Unlisten on "+t+" for "+e);const s={p:t};i&&(s.q=n,s.t=i),this.sendRequest("n",s)}onDisconnectPut(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})}onDisconnectMerge(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})}onDisconnectCancel(t,e){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})}sendOnDisconnect_(t,e,n,i){const s={p:e,d:n};this.log_("onDisconnect "+t,s),this.sendRequest(t,s,t=>{i&&setTimeout(()=>{i(t.s,t.d)},Math.floor(0))})}put(t,e,n,i){this.putInternal("p",t,e,n,i)}merge(t,e,n,i){this.putInternal("m",t,e,n,i)}putInternal(t,e,n,i,s){this.initConnection_();const r={p:e,d:n};void 0!==s&&(r.h=s),this.outstandingPuts_.push({action:t,request:r,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+e)}sendPut_(t){const e=this.outstandingPuts_[t].action,n=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(e,n,n=>{this.log_(e+" response",n),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)})}reportStats(t){if(this.connected_){const e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,t=>{if("ok"!==t.s){const e=t.d;this.log_("reportStats","Error sending stats: "+e)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+H(t));const e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"apc"===t?this.onAppCheckRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):ac("Unrecognized action received from server: "+H(t)+"\nAre you using the latest client?")}onReady_(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){u(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=dl,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=dl,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=dl),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const t=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),e=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+fl.nextConnectionId_++,s=this.lastSessionId;let r=!1,o=null;const a=function(){o?o.close():(r=!0,n())},c=function(t){u(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(t)};this.realtime_={close:a,sendRequest:c};const l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[a,c]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);r?rc("getToken() completed but was canceled"):(rc("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=c&&c.token,o=new zc(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,e,n,t=>{lc(t+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(ac){this.log_("Failed to get token: "+ac),r||(this.repoInfo_.nodeAdmin&&lc(ac),a())}}}interrupt(t){rc("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){rc("Resuming connection for reason: "+t),delete this.interruptReasons_[t],G(this.interruptReasons_)&&(this.reconnectDelay_=dl,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,e){let n;n=e?e.map(t=>mc(t)).join("$"):"default";const i=this.removeListen_(t,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(t,e){const n=new Yc(t).toString();let i;if(this.listens.has(n)){const t=this.listens.get(n);i=t.get(e),t.delete(e),0===t.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(t,e){rc("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,e){rc("App check token revoked: "+t+"/"+e),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const e of t.values())this.sendListen_(e);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let e="js";L()&&(e=this.repoInfo_.nodeAdmin?"admin_node":"node"),t["sdk."+e+"."+za.replace(/\./g,"-")]=1,O()?t["framework.cordova"]=1:"object"===typeof navigator&&"ReactNative"===navigator.product&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=Qc.getInstance().currentlyOnline();return G(this.interruptReasons_)&&t}}fl.nextPersistentConnectionId_=0,fl.nextConnectionId_=0;class pl{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new pl(t,e)}}class gl{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){const n=new pl(uc,t),i=new pl(uc,e);return 0!==this.compare(n,i)}minPost(){return pl.MIN}}let ml;class _l extends gl{static get __EMPTY_NODE(){return ml}static set __EMPTY_NODE(t){ml=t}compare(t,e){return fc(t.name,e.name)}isDefinedOn(t){throw d("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return pl.MIN}maxPost(){return new pl(dc,ml)}makePost(t,e){return u("string"===typeof t,"KeyIndex indexValue must always be a string."),new pl(t,ml)}toString(){return".key"}}const yl=new _l;class vl{constructor(t,e,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let r=1;for(;!t.isEmpty();)if(r=e?n(t.key,e):1,i&&(r*=-1),r<0)t=this.isReverse_?t.left:t.right;else{if(0===r){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}class wl{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=null!=n?n:wl.RED,this.left=null!=i?i:bl.EMPTY_NODE,this.right=null!=s?s:bl.EMPTY_NODE}copy(t,e,n,i,s){return new wl(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===s?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return bl.EMPTY_NODE;let t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,e){let n,i;if(n=this,e(t,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return bl.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,wl.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,wl.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}wl.RED=!0,wl.BLACK=!1;class bl{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bl.EMPTY_NODE;this.comparator_=t,this.root_=e}insert(t,e){return new bl(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,wl.BLACK,null,null))}remove(t){return new bl(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,wl.BLACK,null,null))}get(t){let e,n=this.root_;for(;!n.isEmpty();){if(e=this.comparator_(t,n.key),0===e)return n.value;e<0?n=n.left:e>0&&(n=n.right)}return null}getPredecessorKey(t){let e,n=this.root_,i=null;for(;!n.isEmpty();){if(e=this.comparator_(t,n.key),0===e){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:e>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new vl(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new vl(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new vl(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new vl(this.root_,null,this.comparator_,!0,t)}}function El(t,e){return fc(t.name,e.name)}function Cl(t,e){return fc(t,e)}let Tl;bl.EMPTY_NODE=new class{copy(t,e,n,i,s){return this}insert(t,e,n){return new wl(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Sl=function(t){return"number"===typeof t?"number:"+vc(t):"string:"+t},Il=function(t){if(t.isLeafNode()){const e=t.val();u("string"===typeof e||"number"===typeof e||"object"===typeof e&&z(e,".sv"),"Priority must be a string or number.")}else u(t===Tl||t.isEmpty(),"priority of unexpected type.");u(t===Tl||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let kl,Nl,Al;class Rl{static set __childrenNodeConstructor(t){kl=t}static get __childrenNodeConstructor(){return kl}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rl.__childrenNodeConstructor.EMPTY_NODE;this.value_=t,this.priorityNode_=e,this.lazyHash_=null,u(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Il(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new Rl(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:Rl.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return sl(t)?this:".priority"===Jc(t)?this.priorityNode_:Rl.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,e){return null}updateImmediateChild(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:Rl.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)}updateChild(t,e){const n=Jc(t);return null===n?e:e.isEmpty()&&".priority"!==n?this:(u(".priority"!==n||1===$c(t),".priority must be the last token in a path"),this.updateImmediateChild(n,Rl.__childrenNodeConstructor.EMPTY_NODE.updateChild(Zc(t),e)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,e){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Sl(this.priorityNode_.val())+":");const e=typeof this.value_;t+=e+":",t+="number"===e?vc(this.value_):this.value_,this.lazyHash_=tc(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===Rl.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof Rl.__childrenNodeConstructor?-1:(u(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const e=typeof t.value_,n=typeof this.value_,i=Rl.VALUE_TYPE_ORDER.indexOf(e),s=Rl.VALUE_TYPE_ORDER.indexOf(n);return u(i>=0,"Unknown leaf type: "+e),u(s>=0,"Unknown leaf type: "+n),i===s?"object"===n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:s-i}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1}}Rl.VALUE_TYPE_ORDER=["object","boolean","number","string"];const Dl=new class extends gl{compare(t,e){const n=t.node.getPriority(),i=e.node.getPriority(),s=n.compareTo(i);return 0===s?fc(t.name,e.name):s}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return pl.MIN}maxPost(){return new pl(dc,new Rl("[PRIORITY-POST]",Al))}makePost(t,e){const n=Nl(t);return new pl(e,new Rl("[PRIORITY-POST]",n))}toString(){return".priority"}},Pl=Math.log(2);class xl{constructor(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/Pl,10)),this.current_=this.count-1;const n=(i=this.count,parseInt(Array(i+1).join("1"),2));var i;this.bits_=t+1&n}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const Ol=function(t,e,n,i){t.sort(e);const s=function(e,i){const r=i-e;let o,a;if(0===r)return null;if(1===r)return o=t[e],a=n?n(o):o,new wl(a,o.node,wl.BLACK,null,null);{const c=parseInt(r/2,10)+e,l=s(e,c),h=s(c+1,i);return o=t[c],a=n?n(o):o,new wl(a,o.node,wl.BLACK,l,h)}},r=function(e){let i=null,r=null,o=t.length;const a=function(e,i){const r=o-e,a=o;o-=e;const l=s(r+1,a),h=t[r],u=n?n(h):h;c(new wl(u,h.node,i,null,l))},c=function(t){i?(i.left=t,i=t):(r=t,i=t)};for(let t=0;t<e.count;++t){const n=e.nextBitIsOne(),i=Math.pow(2,e.count-(t+1));n?a(i,wl.BLACK):(a(i,wl.BLACK),a(i,wl.RED))}return r}(new xl(t.length));return new bl(i||e,r)};let Ml;const Ll={};class Fl{static get Default(){return u(Ll&&Dl,"ChildrenNode.ts has not been loaded"),Ml=Ml||new Fl({".priority":Ll},{".priority":Dl}),Ml}constructor(t,e){this.indexes_=t,this.indexSet_=e}get(t){const e=K(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof bl?e:null}hasIndex(t){return z(this.indexSet_,t.toString())}addIndex(t,e){u(t!==yl,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let i=!1;const s=e.getIterator(pl.Wrap);let r,o=s.getNext();for(;o;)i=i||t.isDefinedOn(o.node),n.push(o),o=s.getNext();r=i?Ol(n,t.getCompare()):Ll;const c=t.toString(),l=a({},this.indexSet_);l[c]=t;const h=a({},this.indexes_);return h[c]=r,new Fl(h,l)}addToIndexes(t,e){const n=Q(this.indexes_,(n,i)=>{const s=K(this.indexSet_,i);if(u(s,"Missing index implementation for "+i),n===Ll){if(s.isDefinedOn(t.node)){const n=[],i=e.getIterator(pl.Wrap);let r=i.getNext();for(;r;)r.name!==t.name&&n.push(r),r=i.getNext();return n.push(t),Ol(n,s.getCompare())}return Ll}{const i=e.get(t.name);let s=n;return i&&(s=s.remove(new pl(t.name,i))),s.insert(t,t.node)}});return new Fl(n,this.indexSet_)}removeFromIndexes(t,e){const n=Q(this.indexes_,n=>{if(n===Ll)return n;{const i=e.get(t.name);return i?n.remove(new pl(t.name,i)):n}});return new Fl(n,this.indexSet_)}}let Vl;class Ul{static get EMPTY_NODE(){return Vl||(Vl=new Ul(new bl(Cl),null,Fl.Default))}constructor(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Il(this.priorityNode_),this.children_.isEmpty()&&u(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Vl}updatePriority(t){return this.children_.isEmpty()?this:new Ul(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const e=this.children_.get(t);return null===e?Vl:e}}getChild(t){const e=Jc(t);return null===e?this:this.getImmediateChild(e).getChild(Zc(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,e){if(u(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);{const n=new pl(t,e);let i,s;e.isEmpty()?(i=this.children_.remove(t),s=this.indexMap_.removeFromIndexes(n,this.children_)):(i=this.children_.insert(t,e),s=this.indexMap_.addToIndexes(n,this.children_));const r=i.isEmpty()?Vl:this.priorityNode_;return new Ul(i,r,s)}}updateChild(t,e){const n=Jc(t);if(null===n)return e;{u(".priority"!==Jc(t)||1===$c(t),".priority must be the last token in a path");const i=this.getImmediateChild(n).updateChild(Zc(t),e);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const e={};let n=0,i=0,s=!0;if(this.forEachChild(Dl,(r,o)=>{e[r]=o.val(t),n++,s&&Ul.INTEGER_REGEXP_.test(r)?i=Math.max(i,Number(r)):s=!1}),!t&&s&&i<2*n){const t=[];for(const n in e)t[n]=e[n];return t}return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+Sl(this.getPriority().val())+":"),this.forEachChild(Dl,(e,n)=>{const i=n.hash();""!==i&&(t+=":"+e+":"+i)}),this.lazyHash_=""===t?"":tc(t)}return this.lazyHash_}getPredecessorChildName(t,e,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new pl(t,e));return n?n.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.minKey();return t&&t.name}return this.children_.minKey()}getFirstChild(t){const e=this.getFirstChildName(t);return e?new pl(e,this.children_.get(e)):null}getLastChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.maxKey();return t&&t.name}return this.children_.maxKey()}getLastChild(t){const e=this.getLastChildName(t);return e?new pl(e,this.children_.get(e)):null}forEachChild(t,e){const n=this.resolveIndex_(t);return n?n.inorderTraversal(t=>e(t.name,t.node)):this.children_.inorderTraversal(e)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,e){const n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,t=>t);{const n=this.children_.getIteratorFrom(t.name,pl.Wrap);let i=n.peek();for(;null!=i&&e.compare(i,t)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,e){const n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,t=>t);{const n=this.children_.getReverseIteratorFrom(t.name,pl.Wrap);let i=n.peek();for(;null!=i&&e.compare(i,t)>0;)n.getNext(),i=n.peek();return n}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===jl?-1:0}withIndex(t){if(t===yl||this.indexMap_.hasIndex(t))return this;{const e=this.indexMap_.addIndex(t,this.children_);return new Ul(this.children_,this.priorityNode_,e)}}isIndexed(t){return t===yl||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){const t=this.getIterator(Dl),n=e.getIterator(Dl);let i=t.getNext(),s=n.getNext();for(;i&&s;){if(i.name!==s.name||!i.node.equals(s.node))return!1;i=t.getNext(),s=n.getNext()}return null===i&&null===s}return!1}return!1}}resolveIndex_(t){return t===yl?null:this.indexMap_.get(t.toString())}}Ul.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const jl=new class extends Ul{constructor(){super(new bl(Cl),Ul.EMPTY_NODE,Fl.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return Ul.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(pl,{MIN:{value:new pl(uc,Ul.EMPTY_NODE)},MAX:{value:new pl(dc,jl)}}),_l.__EMPTY_NODE=Ul.EMPTY_NODE,Rl.__childrenNodeConstructor=Ul,Tl=jl,function(t){Al=t}(jl);function Bl(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===t)return Ul.EMPTY_NODE;if("object"===typeof t&&".priority"in t&&(e=t[".priority"]),u(null===e||"string"===typeof e||"number"===typeof e||"object"===typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"===typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!==typeof t||".sv"in t){return new Rl(t,Bl(e))}if(t instanceof Array){let n=Ul.EMPTY_NODE;return yc(t,(e,i)=>{if(z(t,e)&&"."!==e.substring(0,1)){const t=Bl(i);!t.isLeafNode()&&t.isEmpty()||(n=n.updateImmediateChild(e,t))}}),n.updatePriority(Bl(e))}{const n=[];let i=!1;if(yc(t,(t,e)=>{if("."!==t.substring(0,1)){const s=Bl(e);s.isEmpty()||(i=i||!s.getPriority().isEmpty(),n.push(new pl(t,s)))}}),0===n.length)return Ul.EMPTY_NODE;const s=Ol(n,El,t=>t.name,Cl);if(i){const t=Ol(n,Dl.getCompare());return new Ul(s,Bl(e),new Fl({".priority":t},{".priority":Dl}))}return new Ul(s,Bl(e),Fl.Default)}}!function(t){Nl=t}(Bl);class ql extends gl{constructor(t){super(),this.indexPath_=t,u(!sl(t)&&".priority"!==Jc(t),"Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){const n=this.extractChild(t.node),i=this.extractChild(e.node),s=n.compareTo(i);return 0===s?fc(t.name,e.name):s}makePost(t,e){const n=Bl(t),i=Ul.EMPTY_NODE.updateChild(this.indexPath_,n);return new pl(e,i)}maxPost(){const t=Ul.EMPTY_NODE.updateChild(this.indexPath_,jl);return new pl(dc,t)}toString(){return el(this.indexPath_,0).join("/")}}const Hl=new class extends gl{compare(t,e){const n=t.node.compareTo(e.node);return 0===n?fc(t.name,e.name):n}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return pl.MIN}maxPost(){return pl.MAX}makePost(t,e){const n=Bl(t);return new pl(e,n)}toString(){return".value"}};function Wl(t){return{type:"value",snapshotNode:t}}function zl(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Kl(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Gl(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}class Ql{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Dl}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return u(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return u(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:uc}hasEnd(){return this.endSet_}getIndexEndValue(){return u(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return u(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:dc}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return u(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Dl}copy(){const t=new Ql;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function Yl(t){const e={};if(t.isDefault())return e;let n;if(t.index_===Dl?n="$priority":t.index_===Hl?n="$value":t.index_===yl?n="$key":(u(t.index_ instanceof ql,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=H(n),t.startSet_){const n=t.startAfterSet_?"startAfter":"startAt";e[n]=H(t.indexStartValue_),t.startNameSet_&&(e[n]+=","+H(t.indexStartName_))}if(t.endSet_){const n=t.endBeforeSet_?"endBefore":"endAt";e[n]=H(t.indexEndValue_),t.endNameSet_&&(e[n]+=","+H(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function Xl(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;""===n&&(n=t.isViewFromLeft()?"l":"r"),e.vf=n}return t.index_!==Dl&&(e.i=t.index_.toString()),e}class Jl extends Kc{reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return void 0!==e?"tag$"+e:(u(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}constructor(t,e,n,i){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=oc("p:rest:"),this.listens_={}}listen(t,e,n,i){const s=t._path.toString();this.log_("Listen called for "+s+" "+t._queryIdentifier);const r=Jl.getListenId_(t,n),o={};this.listens_[r]=o;const a=Yl(t._queryParams);this.restRequest_(s+".json",a,(t,e)=>{let a=e;if(404===t&&(a=null,t=null),null===t&&this.onDataUpdate_(s,a,!1,n),K(this.listens_,r)===o){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",i(e,null)}})}unlisten(t,e){const n=Jl.getListenId_(t,e);delete this.listens_[n]}get(t){const e=Yl(t._queryParams),n=t._path.toString(),i=new I;return this.restRequest_(n+".json",e,(t,e)=>{let s=e;404===t&&(s=null,t=null),null===t?(this.onDataUpdate_(n,s,!1,null),i.resolve(s)):i.reject(new Error(s))}),i.promise}refreshAuthToken(t){}restRequest_(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(i=>{let[s,r]=i;s&&s.accessToken&&(e.auth=s.accessToken),r&&r.token&&(e.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+function(t){const e=[];for(const[n,i]of Object.entries(t))Array.isArray(i)?i.forEach(t=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}(e);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&4===a.readyState){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let e=null;if(a.status>=200&&a.status<300){try{e=q(a.responseText)}catch(t){lc("Failed to parse JSON response for "+o+": "+a.responseText)}n(null,e)}else 401!==a.status&&404!==a.status&&lc("Got unsuccessful REST response for "+o+" Status: "+a.status),n(a.status);n=null}},a.open("GET",o,!0),a.send()})}}class $l{constructor(){this.rootNode_=Ul.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}}function Zl(){return{value:null,children:new Map}}function th(t,e,n){if(sl(e))t.value=n,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(e,n);else{const i=Jc(e);t.children.has(i)||t.children.set(i,Zl());th(t.children.get(i),e=Zc(e),n)}}function eh(t,e,n){null!==t.value?n(e,t.value):function(t,e){t.children.forEach((t,n)=>{e(n,t)})}(t,(t,i)=>{eh(i,new Yc(e.toString()+"/"+t),n)})}class nh{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),e=a({},t);return this.last_&&yc(this.last_,(t,n)=>{e[t]=e[t]-n}),this.last_=t,e}}class ih{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new nh(t);const n=1e4+2e4*Math.random();Cc(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const t=this.statsListener_.get(),e={};let n=!1;yc(t,(t,i)=>{i>0&&z(this.statsToReport_,t)&&(e[t]=i,n=!0)}),n&&this.server_.reportStats(e),Cc(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var sh;function rh(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}!function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(sh||(sh={}));class oh{constructor(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=sh.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(t){if(sl(this.path)){if(null!=this.affectedTree.value)return u(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new Yc(t));return new oh(Xc(),e,this.revert)}}return u(Jc(this.path)===t,"operationForChild called for unrelated child."),new oh(Zc(this.path),this.affectedTree,this.revert)}}class ah{constructor(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=sh.OVERWRITE}operationForChild(t){return sl(this.path)?new ah(this.source,Xc(),this.snap.getImmediateChild(t)):new ah(this.source,Zc(this.path),this.snap)}}class ch{constructor(t,e,n){this.source=t,this.path=e,this.children=n,this.type=sh.MERGE}operationForChild(t){if(sl(this.path)){const e=this.children.subtree(new Yc(t));return e.isEmpty()?null:e.value?new ah(this.source,Xc(),e.value):new ch(this.source,Xc(),e)}return u(Jc(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new ch(this.source,Zc(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class lh{constructor(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(sl(t))return this.isFullyInitialized()&&!this.filtered_;const e=Jc(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}function hh(t,e,n,i,s,r){const o=i.filter(t=>t.type===n);o.sort((e,n)=>function(t,e,n){if(null==e.childName||null==n.childName)throw d("Should only compare child_ events.");const i=new pl(e.childName,e.snapshotNode),s=new pl(n.childName,n.snapshotNode);return t.index_.compare(i,s)}(t,e,n)),o.forEach(n=>{const i=function(t,e,n){return"value"===e.type||"child_removed"===e.type||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}(t,n,r);s.forEach(s=>{s.respondsTo(n.type)&&e.push(s.createEvent(i,t.query_))})})}function uh(t,e){return{eventCache:t,serverCache:e}}function dh(t,e,n,i){return uh(new lh(e,n,i),t.serverCache)}function fh(t,e,n,i){return uh(t.eventCache,new lh(e,n,i))}function ph(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function gh(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}let mh;class _h{static fromObject(t){let e=new _h(null);return yc(t,(t,n)=>{e=e.set(new Yc(t),n)}),e}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(mh||(mh=new bl(pc)),mh);this.value=t,this.children=e}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(null!=this.value&&e(this.value))return{path:Xc(),value:this.value};if(sl(t))return null;{const n=Jc(t),i=this.children.get(n);if(null!==i){const s=i.findRootMostMatchingPathAndValue(Zc(t),e);if(null!=s){return{path:il(new Yc(n),s.path),value:s.value}}return null}return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,()=>!0)}subtree(t){if(sl(t))return this;{const e=Jc(t),n=this.children.get(e);return null!==n?n.subtree(Zc(t)):new _h(null)}}set(t,e){if(sl(t))return new _h(e,this.children);{const n=Jc(t),i=(this.children.get(n)||new _h(null)).set(Zc(t),e),s=this.children.insert(n,i);return new _h(this.value,s)}}remove(t){if(sl(t))return this.children.isEmpty()?new _h(null):new _h(null,this.children);{const e=Jc(t),n=this.children.get(e);if(n){const i=n.remove(Zc(t));let s;return s=i.isEmpty()?this.children.remove(e):this.children.insert(e,i),null===this.value&&s.isEmpty()?new _h(null):new _h(this.value,s)}return this}}get(t){if(sl(t))return this.value;{const e=Jc(t),n=this.children.get(e);return n?n.get(Zc(t)):null}}setTree(t,e){if(sl(t))return e;{const n=Jc(t),i=(this.children.get(n)||new _h(null)).setTree(Zc(t),e);let s;return s=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new _h(this.value,s)}}fold(t){return this.fold_(Xc(),t)}fold_(t,e){const n={};return this.children.inorderTraversal((i,s)=>{n[i]=s.fold_(il(t,i),e)}),e(t,this.value,n)}findOnPath(t,e){return this.findOnPath_(t,Xc(),e)}findOnPath_(t,e,n){const i=!!this.value&&n(e,this.value);if(i)return i;if(sl(t))return null;{const i=Jc(t),s=this.children.get(i);return s?s.findOnPath_(Zc(t),il(e,i),n):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,Xc(),e)}foreachOnPath_(t,e,n){if(sl(t))return this;{this.value&&n(e,this.value);const i=Jc(t),s=this.children.get(i);return s?s.foreachOnPath_(Zc(t),il(e,i),n):new _h(null)}}foreach(t){this.foreach_(Xc(),t)}foreach_(t,e){this.children.inorderTraversal((n,i)=>{i.foreach_(il(t,n),e)}),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal((e,n)=>{n.value&&t(e,n.value)})}}class yh{constructor(t){this.writeTree_=t}static empty(){return new yh(new _h(null))}}function vh(t,e,n){if(sl(e))return new yh(new _h(n));{const i=t.writeTree_.findRootMostValueAndPath(e);if(null!=i){const s=i.path;let r=i.value;const o=rl(s,e);return r=r.updateChild(o,n),new yh(t.writeTree_.set(s,r))}{const i=new _h(n),s=t.writeTree_.setTree(e,i);return new yh(s)}}}function wh(t,e,n){let i=t;return yc(n,(t,n)=>{i=vh(i,il(e,t),n)}),i}function bh(t,e){if(sl(e))return yh.empty();{const n=t.writeTree_.setTree(e,new _h(null));return new yh(n)}}function Eh(t,e){return null!=Ch(t,e)}function Ch(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return null!=n?t.writeTree_.get(n.path).getChild(rl(n.path,e)):null}function Th(t){const e=[],n=t.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Dl,(t,n)=>{e.push(new pl(t,n))}):t.writeTree_.children.inorderTraversal((t,n)=>{null!=n.value&&e.push(new pl(t,n.value))}),e}function Sh(t,e){if(sl(e))return t;{const n=Ch(t,e);return new yh(null!=n?new _h(n):t.writeTree_.subtree(e))}}function Ih(t){return t.writeTree_.isEmpty()}function kh(t,e){return Nh(Xc(),t.writeTree_,e)}function Nh(t,e,n){if(null!=e.value)return n.updateChild(t,e.value);{let i=null;return e.children.inorderTraversal((e,s)=>{".priority"===e?(u(null!==s.value,"Priority writes must always be leaf nodes"),i=s.value):n=Nh(il(t,e),s,n)}),n.getChild(t).isEmpty()||null===i||(n=n.updateChild(il(t,".priority"),i)),n}}function Ah(t,e){return qh(e,t)}function Rh(t,e){const n=t.allWrites.findIndex(t=>t.writeId===e);u(n>=0,"removeWrite called with nonexistent writeId.");const i=t.allWrites[n];t.allWrites.splice(n,1);let s=i.visible,r=!1,o=t.allWrites.length-1;for(;s&&o>=0;){const e=t.allWrites[o];e.visible&&(o>=n&&Dh(e,i.path)?s=!1:al(i.path,e.path)&&(r=!0)),o--}if(s){if(r)return function(t){t.visibleWrites=xh(t.allWrites,Ph,Xc()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}(t),!0;if(i.snap)t.visibleWrites=bh(t.visibleWrites,i.path);else{yc(i.children,e=>{t.visibleWrites=bh(t.visibleWrites,il(i.path,e))})}return!0}return!1}function Dh(t,e){if(t.snap)return al(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&al(il(t.path,n),e))return!0;return!1}function Ph(t){return t.visible}function xh(t,e,n){let i=yh.empty();for(let s=0;s<t.length;++s){const r=t[s];if(e(r)){const t=r.path;let e;if(r.snap)al(n,t)?(e=rl(n,t),i=vh(i,e,r.snap)):al(t,n)&&(e=rl(t,n),i=vh(i,Xc(),r.snap.getChild(e)));else{if(!r.children)throw d("WriteRecord should have .snap or .children");if(al(n,t))e=rl(n,t),i=wh(i,e,r.children);else if(al(t,n))if(e=rl(t,n),sl(e))i=wh(i,Xc(),r.children);else{const t=K(r.children,Jc(e));if(t){const n=t.getChild(Zc(e));i=vh(i,Xc(),n)}}}}}return i}function Oh(t,e,n,i,s){if(i||s){const r=Sh(t.visibleWrites,e);if(!s&&Ih(r))return n;if(s||null!=n||Eh(r,Xc())){const r=function(t){return(t.visible||s)&&(!i||!~i.indexOf(t.writeId))&&(al(t.path,e)||al(e,t.path))};return kh(xh(t.allWrites,r,e),n||Ul.EMPTY_NODE)}return null}{const i=Ch(t.visibleWrites,e);if(null!=i)return i;{const i=Sh(t.visibleWrites,e);if(Ih(i))return n;if(null!=n||Eh(i,Xc())){return kh(i,n||Ul.EMPTY_NODE)}return null}}}function Mh(t,e,n,i){return Oh(t.writeTree,t.treePath,e,n,i)}function Lh(t,e){return function(t,e,n){let i=Ul.EMPTY_NODE;const s=Ch(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Dl,(t,e)=>{i=i.updateImmediateChild(t,e)}),i;if(n){const s=Sh(t.visibleWrites,e);return n.forEachChild(Dl,(t,e)=>{const n=kh(Sh(s,new Yc(t)),e);i=i.updateImmediateChild(t,n)}),Th(s).forEach(t=>{i=i.updateImmediateChild(t.name,t.node)}),i}return Th(Sh(t.visibleWrites,e)).forEach(t=>{i=i.updateImmediateChild(t.name,t.node)}),i}(t.writeTree,t.treePath,e)}function Fh(t,e,n,i){return function(t,e,n,i,s){u(i||s,"Either existingEventSnap or existingServerSnap must exist");const r=il(e,n);if(Eh(t.visibleWrites,r))return null;{const e=Sh(t.visibleWrites,r);return Ih(e)?s.getChild(n):kh(e,s.getChild(n))}}(t.writeTree,t.treePath,e,n,i)}function Vh(t,e){return function(t,e){return Ch(t.visibleWrites,e)}(t.writeTree,il(t.treePath,e))}function Uh(t,e,n,i,s,r){return function(t,e,n,i,s,r,o){let a;const c=Sh(t.visibleWrites,e),l=Ch(c,Xc());if(null!=l)a=l;else{if(null==n)return[];a=kh(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const t=[],e=o.getCompare(),n=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let c=n.getNext();for(;c&&t.length<s;)0!==e(c,i)&&t.push(c),c=n.getNext();return t}}(t.writeTree,t.treePath,e,n,i,s,r)}function jh(t,e,n){return function(t,e,n,i){const s=il(e,n),r=Ch(t.visibleWrites,s);if(null!=r)return r;if(i.isCompleteForChild(n))return kh(Sh(t.visibleWrites,s),i.getNode().getImmediateChild(n));return null}(t.writeTree,t.treePath,e,n)}function Bh(t,e){return qh(il(t.treePath,e),t.writeTree)}function qh(t,e){return{treePath:t,writeTree:e}}class Hh{constructor(){this.changeMap=new Map}trackChildChange(t){const e=t.type,n=t.childName;u("child_added"===e||"child_changed"===e||"child_removed"===e,"Only child changes supported for tracking"),u(".priority"!==n,"Only non-priority child changes can be tracked.");const i=this.changeMap.get(n);if(i){const s=i.type;if("child_added"===e&&"child_removed"===s)this.changeMap.set(n,Gl(n,t.snapshotNode,i.snapshotNode));else if("child_removed"===e&&"child_added"===s)this.changeMap.delete(n);else if("child_removed"===e&&"child_changed"===s)this.changeMap.set(n,Kl(n,i.oldSnap));else if("child_changed"===e&&"child_added"===s)this.changeMap.set(n,zl(n,t.snapshotNode));else{if("child_changed"!==e||"child_changed"!==s)throw d("Illegal combination of changes: "+t+" occurred after "+i);this.changeMap.set(n,Gl(n,t.snapshotNode,i.oldSnap))}}else this.changeMap.set(n,t)}getChanges(){return Array.from(this.changeMap.values())}}const Wh=new class{getCompleteChild(t){return null}getChildAfterChild(t,e,n){return null}};class zh{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}getCompleteChild(t){const e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{const e=null!=this.optCompleteServerCache_?new lh(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return jh(this.writes_,t,e)}}getChildAfterChild(t,e,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:gh(this.viewCache_),s=Uh(this.writes_,i,e,1,n,t);return 0===s.length?null:s[0]}}function Kh(t,e,n,i,s){const r=new Hh;let o,a;if(n.type===sh.OVERWRITE){const c=n;c.source.fromUser?o=Yh(t,e,c.path,c.snap,i,s,r):(u(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!sl(c.path),o=Qh(t,e,c.path,c.snap,i,s,a,r))}else if(n.type===sh.MERGE){const c=n;c.source.fromUser?o=function(t,e,n,i,s,r,o){let a=e;return i.foreach((i,c)=>{const l=il(n,i);Xh(e,Jc(l))&&(a=Yh(t,a,l,c,s,r,o))}),i.foreach((i,c)=>{const l=il(n,i);Xh(e,Jc(l))||(a=Yh(t,a,l,c,s,r,o))}),a}(t,e,c.path,c.children,i,s,r):(u(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=$h(t,e,c.path,c.children,i,s,a,r))}else if(n.type===sh.ACK_USER_WRITE){const a=n;o=a.revert?function(t,e,n,i,s,r){let o;if(null!=Vh(i,n))return e;{const a=new zh(i,e,s),c=e.eventCache.getNode();let l;if(sl(n)||".priority"===Jc(n)){let n;if(e.serverCache.isFullyInitialized())n=Mh(i,gh(e));else{const t=e.serverCache.getNode();u(t instanceof Ul,"serverChildren would be complete if leaf node"),n=Lh(i,t)}l=t.filter.updateFullNode(c,n,r)}else{const s=Jc(n);let h=jh(i,s,e.serverCache);null==h&&e.serverCache.isCompleteForChild(s)&&(h=c.getImmediateChild(s)),l=null!=h?t.filter.updateChild(c,s,h,Zc(n),a,r):e.eventCache.getNode().hasChild(s)?t.filter.updateChild(c,s,Ul.EMPTY_NODE,Zc(n),a,r):c,l.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Mh(i,gh(e)),o.isLeafNode()&&(l=t.filter.updateFullNode(l,o,r)))}return o=e.serverCache.isFullyInitialized()||null!=Vh(i,Xc()),dh(e,l,o,t.filter.filtersNodes())}}(t,e,a.path,i,s,r):function(t,e,n,i,s,r,o){if(null!=Vh(s,n))return e;const a=e.serverCache.isFiltered(),c=e.serverCache;if(null!=i.value){if(sl(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return Qh(t,e,n,c.getNode().getChild(n),s,r,a,o);if(sl(n)){let i=new _h(null);return c.getNode().forEachChild(yl,(t,e)=>{i=i.set(new Yc(t),e)}),$h(t,e,n,i,s,r,a,o)}return e}{let l=new _h(null);return i.foreach((t,e)=>{const i=il(n,t);c.isCompleteForPath(i)&&(l=l.set(t,c.getNode().getChild(i)))}),$h(t,e,n,l,s,r,a,o)}}(t,e,a.path,a.affectedTree,i,s,r)}else{if(n.type!==sh.LISTEN_COMPLETE)throw d("Unknown operation type: "+n.type);o=function(t,e,n,i,s){const r=e.serverCache,o=fh(e,r.getNode(),r.isFullyInitialized()||sl(n),r.isFiltered());return Gh(t,o,n,i,Wh,s)}(t,e,n.path,i,r)}const c=r.getChanges();return function(t,e,n){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=ph(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&n.push(Wl(ph(e)))}}(e,o,c),{viewCache:o,changes:c}}function Gh(t,e,n,i,s,r){const o=e.eventCache;if(null!=Vh(i,n))return e;{let a,c;if(sl(n))if(u(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const n=gh(e),s=Lh(i,n instanceof Ul?n:Ul.EMPTY_NODE);a=t.filter.updateFullNode(e.eventCache.getNode(),s,r)}else{const n=Mh(i,gh(e));a=t.filter.updateFullNode(e.eventCache.getNode(),n,r)}else{const l=Jc(n);if(".priority"===l){u(1===$c(n),"Can't have a priority with additional path components");const s=o.getNode();c=e.serverCache.getNode();const r=Fh(i,n,s,c);a=null!=r?t.filter.updatePriority(s,r):o.getNode()}else{const h=Zc(n);let u;if(o.isCompleteForChild(l)){c=e.serverCache.getNode();const t=Fh(i,n,o.getNode(),c);u=null!=t?o.getNode().getImmediateChild(l).updateChild(h,t):o.getNode().getImmediateChild(l)}else u=jh(i,l,e.serverCache);a=null!=u?t.filter.updateChild(o.getNode(),l,u,h,s,r):o.getNode()}}return dh(e,a,o.isFullyInitialized()||sl(n),t.filter.filtersNodes())}}function Qh(t,e,n,i,s,r,o,a){const c=e.serverCache;let l;const h=o?t.filter:t.filter.getIndexedFilter();if(sl(n))l=h.updateFullNode(c.getNode(),i,null);else if(h.filtersNodes()&&!c.isFiltered()){const t=c.getNode().updateChild(n,i);l=h.updateFullNode(c.getNode(),t,null)}else{const t=Jc(n);if(!c.isCompleteForPath(n)&&$c(n)>1)return e;const s=Zc(n),r=c.getNode().getImmediateChild(t).updateChild(s,i);l=".priority"===t?h.updatePriority(c.getNode(),r):h.updateChild(c.getNode(),t,r,s,Wh,null)}const u=fh(e,l,c.isFullyInitialized()||sl(n),h.filtersNodes());return Gh(t,u,n,s,new zh(s,u,r),a)}function Yh(t,e,n,i,s,r,o){const a=e.eventCache;let c,l;const h=new zh(s,e,r);if(sl(n))l=t.filter.updateFullNode(e.eventCache.getNode(),i,o),c=dh(e,l,!0,t.filter.filtersNodes());else{const s=Jc(n);if(".priority"===s)l=t.filter.updatePriority(e.eventCache.getNode(),i),c=dh(e,l,a.isFullyInitialized(),a.isFiltered());else{const r=Zc(n),l=a.getNode().getImmediateChild(s);let u;if(sl(r))u=i;else{const t=h.getCompleteChild(s);u=null!=t?".priority"===tl(r)&&t.getChild(nl(r)).isEmpty()?t:t.updateChild(r,i):Ul.EMPTY_NODE}if(l.equals(u))c=e;else{c=dh(e,t.filter.updateChild(a.getNode(),s,u,r,h,o),a.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function Xh(t,e){return t.eventCache.isCompleteForChild(e)}function Jh(t,e,n){return n.foreach((t,n)=>{e=e.updateChild(t,n)}),e}function $h(t,e,n,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c,l=e;c=sl(n)?i:new _h(null).setTree(n,i);const h=e.serverCache.getNode();return c.children.inorderTraversal((n,i)=>{if(h.hasChild(n)){const c=Jh(0,e.serverCache.getNode().getImmediateChild(n),i);l=Qh(t,l,new Yc(n),c,s,r,o,a)}}),c.children.inorderTraversal((n,i)=>{const c=!e.serverCache.isCompleteForChild(n)&&null===i.value;if(!h.hasChild(n)&&!c){const c=Jh(0,e.serverCache.getNode().getImmediateChild(n),i);l=Qh(t,l,new Yc(n),c,s,r,o,a)}}),l}function Zh(t,e){const n=gh(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!sl(e)&&!n.getImmediateChild(Jc(e)).isEmpty())?n.getChild(e):null}function tu(t,e,n,i){e.type===sh.MERGE&&null!==e.source.queryId&&(u(gh(t.viewCache_),"We should always have a full cache before handling merges"),u(ph(t.viewCache_),"Missing event cache, even though we have a server cache"));const s=t.viewCache_,r=Kh(t.processor_,s,e,n,i);var o,a;return o=t.processor_,a=r.viewCache,u(a.eventCache.getNode().isIndexed(o.filter.getIndex()),"Event snap not indexed"),u(a.serverCache.getNode().isIndexed(o.filter.getIndex()),"Server snap not indexed"),u(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=r.viewCache,eu(t,r.changes,r.viewCache.eventCache.getNode(),null)}function eu(t,e,n,i){const s=i?[i]:t.eventRegistrations_;return function(t,e,n,i){const s=[],r=[];return e.forEach(e=>{var n;"child_changed"===e.type&&t.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&r.push((n=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:n}))}),hh(t,s,"child_removed",e,i,n),hh(t,s,"child_added",e,i,n),hh(t,s,"child_moved",r,i,n),hh(t,s,"child_changed",e,i,n),hh(t,s,"value",e,i,n),s}(t.eventGenerator_,e,n,s)}let nu,iu;function su(t,e,n,i){const s=e.source.queryId;if(null!==s){const r=t.views.get(s);return u(null!=r,"SyncTree gave us an op for an invalid query."),tu(r,e,n,i)}{let s=[];for(const r of t.views.values())s=s.concat(tu(r,e,n,i));return s}}function ru(t,e){let n=null;for(const i of t.views.values())n=n||Zh(i,e);return n}class ou{constructor(t){this.listenProvider_=t,this.syncPointTree_=new _h(null),this.pendingWriteTree_={visibleWrites:yh.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function au(t,e,n,i,s){return function(t,e,n,i,s){u(i>t.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:i,visible:s}),s&&(t.visibleWrites=vh(t.visibleWrites,e,n)),t.lastWriteId=i}(t.pendingWriteTree_,e,n,i,s),s?du(t,new ah({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,n)):[]}function cu(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=function(t,e){for(let n=0;n<t.allWrites.length;n++){const i=t.allWrites[n];if(i.writeId===e)return i}return null}(t.pendingWriteTree_,e);if(Rh(t.pendingWriteTree_,e)){let e=new _h(null);return null!=i.snap?e=e.set(Xc(),!0):yc(i.children,t=>{e=e.set(new Yc(t),!0)}),du(t,new oh(i.path,e,n))}return[]}function lu(t,e,n){return du(t,new ah({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,n))}function hu(t,e,n,i){const s=gu(t,i);if(null!=s){const i=mu(s),r=i.path,o=i.queryId,a=rl(r,e);return _u(t,r,new ah(rh(o),a,n))}return[]}function uu(t,e,n){const i=t.pendingWriteTree_,s=t.syncPointTree_.findOnPath(e,(t,n)=>{const i=ru(n,rl(t,e));if(i)return i});return Oh(i,e,s,n,!0)}function du(t,e){return fu(e,t.syncPointTree_,null,Ah(t.pendingWriteTree_,Xc()))}function fu(t,e,n,i){if(sl(t.path))return pu(t,e,n,i);{const s=e.get(Xc());null==n&&null!=s&&(n=ru(s,Xc()));let r=[];const o=Jc(t.path),a=t.operationForChild(o),c=e.children.get(o);if(c&&a){const t=n?n.getImmediateChild(o):null,e=Bh(i,o);r=r.concat(fu(a,c,t,e))}return s&&(r=r.concat(su(s,t,i,n))),r}}function pu(t,e,n,i){const s=e.get(Xc());null==n&&null!=s&&(n=ru(s,Xc()));let r=[];return e.children.inorderTraversal((e,s)=>{const o=n?n.getImmediateChild(e):null,a=Bh(i,e),c=t.operationForChild(e);c&&(r=r.concat(pu(c,s,o,a)))}),s&&(r=r.concat(su(s,t,i,n))),r}function gu(t,e){return t.tagToQueryMap.get(e)}function mu(t){const e=t.indexOf("$");return u(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Yc(t.substr(0,e))}}function _u(t,e,n){const i=t.syncPointTree_.get(e);u(i,"Missing sync point for query tag that we're tracking");return su(i,n,Ah(t.pendingWriteTree_,e),null)}class yu{constructor(t){this.node_=t}getImmediateChild(t){const e=this.node_.getImmediateChild(t);return new yu(e)}node(){return this.node_}}class vu{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){const e=il(this.path_,t);return new vu(this.syncTree_,e)}node(){return uu(this.syncTree_,this.path_)}}const wu=function(t,e,n){return t&&"object"===typeof t?(u(".sv"in t,"Unexpected leaf node or priority contents"),"string"===typeof t[".sv"]?bu(t[".sv"],e,n):"object"===typeof t[".sv"]?Eu(t[".sv"],e):void u(!1,"Unexpected server value: "+JSON.stringify(t,null,2))):t},bu=function(t,e,n){if("timestamp"===t)return n.timestamp;u(!1,"Unexpected server value: "+t)},Eu=function(t,e,n){t.hasOwnProperty("increment")||u(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const i=t.increment;"number"!==typeof i&&u(!1,"Unexpected increment value: "+i);const s=e.node();if(u(null!==s&&"undefined"!==typeof s,"Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const r=s.getValue();return"number"!==typeof r?i:r+i},Cu=function(t,e,n,i){return Su(e,new vu(n,t),i)},Tu=function(t,e,n){return Su(t,new yu(e),n)};function Su(t,e,n){const i=t.getPriority().val(),s=wu(i,e.getImmediateChild(".priority"),n);let r;if(t.isLeafNode()){const i=t,r=wu(i.getValue(),e,n);return r!==i.getValue()||s!==i.getPriority().val()?new Rl(r,Bl(s)):t}{const i=t;return r=i,s!==i.getPriority().val()&&(r=r.updatePriority(new Rl(s))),i.forEachChild(Dl,(t,i)=>{const s=Su(i,e.getImmediateChild(t),n);s!==i&&(r=r.updateImmediateChild(t,s))}),r}}class Iu{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{children:{},childCount:0};this.name=t,this.parent=e,this.node=n}}function ku(t,e){let n=e instanceof Yc?e:new Yc(e),i=t,s=Jc(n);for(;null!==s;){const t=K(i.node.children,s)||{children:{},childCount:0};i=new Iu(s,i,t),n=Zc(n),s=Jc(n)}return i}function Nu(t){return t.node.value}function Au(t,e){t.node.value=e,Ou(t)}function Ru(t){return t.node.childCount>0}function Du(t,e){yc(t.node.children,(n,i)=>{e(new Iu(n,t,i))})}function Pu(t,e,n,i){n&&!i&&e(t),Du(t,t=>{Pu(t,e,!0,i)}),n&&i&&e(t)}function xu(t){return new Yc(null===t.parent?t.name:xu(t.parent)+"/"+t.name)}function Ou(t){null!==t.parent&&function(t,e,n){const i=function(t){return void 0===Nu(t)&&!Ru(t)}(n),s=z(t.node.children,e);i&&s?(delete t.node.children[e],t.node.childCount--,Ou(t)):i||s||(t.node.children[e]=n.node,t.node.childCount++,Ou(t))}(t.parent,t.name,t)}const Mu=/[\[\].#$\/\u0000-\u001F\u007F]/,Lu=/[\[\].#$\u0000-\u001F\u007F]/,Fu=10485760,Vu=function(t){return"string"===typeof t&&0!==t.length&&!Mu.test(t)},Uu=function(t){return"string"===typeof t&&0!==t.length&&!Lu.test(t)},ju=function(t,e,n){const i=n instanceof Yc?new cl(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+hl(i));if("function"===typeof e)throw new Error(t+"contains a function "+hl(i)+" with contents = "+e.toString());if(hc(e))throw new Error(t+"contains "+e.toString()+" "+hl(i));if("string"===typeof e&&e.length>Fu/3&&Z(e)>Fu)throw new Error(t+"contains a string greater than "+Fu+" utf8 bytes "+hl(i)+" ('"+e.substring(0,50)+"...')");if(e&&"object"===typeof e){let n=!1,s=!1;if(yc(e,(e,r)=>{if(".value"===e)n=!0;else if(".priority"!==e&&".sv"!==e&&(s=!0,!Vu(e)))throw new Error(t+" contains an invalid key ("+e+") "+hl(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Z(e),ll(t)}(i,e),ju(t,r,i),function(t){const e=t.parts_.pop();t.byteLength_-=Z(e),t.parts_.length>0&&(t.byteLength_-=1)}(i)}),n&&s)throw new Error(t+' contains ".value" child '+hl(i)+" in addition to actual children.")}},Bu=function(t,e){const n=e.path.toString();if("string"!==typeof e.repoInfo.host||0===e.repoInfo.host.length||!Vu(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==n.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Uu(t)}(n))throw new Error($(t,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class qu{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Hu(t,e){let n=null;for(let i=0;i<e.length;i++){const s=e[i],r=s.getPath();null===n||ol(r,n.path)||(t.eventLists_.push(n),n=null),null===n&&(n={events:[],path:r}),n.events.push(s)}n&&t.eventLists_.push(n)}function Wu(t,e,n){Hu(t,n),zu(t,t=>al(t,e)||al(e,t))}function zu(t,e){t.recursionDepth_++;let n=!0;for(let i=0;i<t.eventLists_.length;i++){const s=t.eventLists_[i];if(s){e(s.path)?(Ku(t.eventLists_[i]),t.eventLists_[i]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function Ku(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(null!==n){t.events[e]=null;const i=n.getEventRunner();nc&&rc("event: "+n.toString()),Ec(i)}}}const Gu="repo_interrupt";class Qu{constructor(t,e,n,i){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new qu,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Zl(),this.transactionQueueTree_=new Iu,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Yu(t,e,n){if(t.stats_=Fc(t.repoInfo_),t.forceRestClient_||("object"===typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)t.server_=new Jl(t.repoInfo_,(e,n,i,s)=>{$u(t,e,n,i,s)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>Zu(t,!0),0);else{if("undefined"!==typeof n&&null!==n){if("object"!==typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{H(n)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}t.persistentConnection_=new fl(t.repoInfo_,e,(e,n,i,s)=>{$u(t,e,n,i,s)},e=>{Zu(t,e)},e=>{!function(t,e){yc(e,(e,n)=>{td(t,e,n)})}(t,e)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(e=>{t.server_.refreshAuthToken(e)}),t.appCheckProvider_.addTokenChangeListener(e=>{t.server_.refreshAppCheckToken(e.token)}),t.statsReporter_=function(t,e){const n=t.toString();return Lc[n]||(Lc[n]=e()),Lc[n]}(t.repoInfo_,()=>new ih(t.stats_,t.server_)),t.infoData_=new $l,t.infoSyncTree_=new ou({startListening:(e,n,i,s)=>{let r=[];const o=t.infoData_.getNode(e._path);return o.isEmpty()||(r=lu(t.infoSyncTree_,e._path,o),setTimeout(()=>{s("ok")},0)),r},stopListening:()=>{}}),td(t,"connected",!1),t.serverSyncTree_=new ou({startListening:(e,n,i,s)=>(t.server_.listen(e,i,n,(n,i)=>{const r=s(n,i);Wu(t.eventQueue_,e._path,r)}),[]),stopListening:(e,n)=>{t.server_.unlisten(e,n)}})}function Xu(t){const e=t.infoData_.getNode(new Yc(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e}function Ju(t){return(e=(e={timestamp:Xu(t)})||{}).timestamp=e.timestamp||(new Date).getTime(),e;var e}function $u(t,e,n,i,s){t.dataUpdateCount++;const r=new Yc(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(i){const e=Q(n,t=>Bl(t));o=function(t,e,n,i){const s=gu(t,i);if(s){const i=mu(s),r=i.path,o=i.queryId,a=rl(r,e),c=_h.fromObject(n);return _u(t,r,new ch(rh(o),a,c))}return[]}(t.serverSyncTree_,r,e,s)}else{const e=Bl(n);o=hu(t.serverSyncTree_,r,e,s)}else if(i){const e=Q(n,t=>Bl(t));o=function(t,e,n){const i=_h.fromObject(n);return du(t,new ch({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,i))}(t.serverSyncTree_,r,e)}else{const e=Bl(n);o=lu(t.serverSyncTree_,r,e)}let a=r;o.length>0&&(a=od(t,r)),Wu(t.eventQueue_,a,o)}function Zu(t,e){td(t,"connected",e),!1===e&&function(t){id(t,"onDisconnectEvents");const e=Ju(t),n=Zl();eh(t.onDisconnect_,Xc(),(i,s)=>{const r=Cu(i,s,t.serverSyncTree_,e);th(n,i,r)});let i=[];eh(n,Xc(),(e,n)=>{i=i.concat(lu(t.serverSyncTree_,e,n));const s=ud(t,e);od(t,s)}),t.onDisconnect_=Zl(),Wu(t.eventQueue_,Xc(),i)}(t)}function td(t,e,n){const i=new Yc("/.info/"+e),s=Bl(n);t.infoData_.updateSnapshot(i,s);const r=lu(t.infoSyncTree_,i,s);Wu(t.eventQueue_,i,r)}function ed(t){return t.nextWriteId_++}function nd(t){t.persistentConnection_&&t.persistentConnection_.interrupt(Gu)}function id(t){let e="";t.persistentConnection_&&(e=t.persistentConnection_.id+":");for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];rc(e,...i)}function sd(t,e,n){return uu(t.serverSyncTree_,e,n)||Ul.EMPTY_NODE}function rd(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.transactionQueueTree_;if(e||hd(t,e),Nu(e)){const n=cd(t,e);u(n.length>0,"Sending zero length transaction queue");n.every(t=>0===t.status)&&function(t,e,n){const i=n.map(t=>t.currentWriteId),s=sd(t,e,i);let r=s;const o=s.hash();for(let l=0;l<n.length;l++){const t=n[l];u(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;const i=rl(e,t.path);r=r.updateChild(i,t.currentOutputSnapshotRaw)}const a=r.val(!0),c=e;t.server_.put(c.toString(),a,i=>{id(t,"transaction put response",{path:c.toString(),status:i});let s=[];if("ok"===i){const i=[];for(let e=0;e<n.length;e++)n[e].status=2,s=s.concat(cu(t.serverSyncTree_,n[e].currentWriteId)),n[e].onComplete&&i.push(()=>n[e].onComplete(null,!0,n[e].currentOutputSnapshotResolved)),n[e].unwatcher();hd(t,ku(t.transactionQueueTree_,e)),rd(t,t.transactionQueueTree_),Wu(t.eventQueue_,e,s);for(let t=0;t<i.length;t++)Ec(i[t])}else{if("datastale"===i)for(let t=0;t<n.length;t++)3===n[t].status?n[t].status=4:n[t].status=0;else{lc("transaction at "+c.toString()+" failed: "+i);for(let t=0;t<n.length;t++)n[t].status=4,n[t].abortReason=i}od(t,e)}},o)}(t,xu(e),n)}else Ru(e)&&Du(e,e=>{rd(t,e)})}function od(t,e){const n=ad(t,e),i=xu(n);return function(t,e,n){if(0===e.length)return;const i=[];let s=[];const r=e.filter(t=>0===t.status),o=r.map(t=>t.currentWriteId);for(let a=0;a<e.length;a++){const r=e[a],c=rl(n,r.path);let l,h=!1;if(u(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),4===r.status)h=!0,l=r.abortReason,s=s.concat(cu(t.serverSyncTree_,r.currentWriteId,!0));else if(0===r.status)if(r.retryCount>=25)h=!0,l="maxretry",s=s.concat(cu(t.serverSyncTree_,r.currentWriteId,!0));else{const n=sd(t,r.path,o);r.currentInputSnapshot=n;const i=e[a].update(n.val());if(void 0!==i){ju("transaction failed: Data returned ",i,r.path);let e=Bl(i);"object"===typeof i&&null!=i&&z(i,".priority")||(e=e.updatePriority(n.getPriority()));const a=r.currentWriteId,c=Ju(t),l=Tu(e,n,c);r.currentOutputSnapshotRaw=e,r.currentOutputSnapshotResolved=l,r.currentWriteId=ed(t),o.splice(o.indexOf(a),1),s=s.concat(au(t.serverSyncTree_,r.path,l,r.currentWriteId,r.applyLocally)),s=s.concat(cu(t.serverSyncTree_,a,!0))}else h=!0,l="nodata",s=s.concat(cu(t.serverSyncTree_,r.currentWriteId,!0))}Wu(t.eventQueue_,n,s),s=[],h&&(e[a].status=2,function(t){setTimeout(t,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&("nodata"===l?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(l),!1,null))))}hd(t,t.transactionQueueTree_);for(let a=0;a<i.length;a++)Ec(i[a]);rd(t,t.transactionQueueTree_)}(t,cd(t,n),i),i}function ad(t,e){let n,i=t.transactionQueueTree_;for(n=Jc(e);null!==n&&void 0===Nu(i);)i=ku(i,n),n=Jc(e=Zc(e));return i}function cd(t,e){const n=[];return ld(t,e,n),n.sort((t,e)=>t.order-e.order),n}function ld(t,e,n){const i=Nu(e);if(i)for(let s=0;s<i.length;s++)n.push(i[s]);Du(e,e=>{ld(t,e,n)})}function hd(t,e){const n=Nu(e);if(n){let t=0;for(let e=0;e<n.length;e++)2!==n[e].status&&(n[t]=n[e],t++);n.length=t,Au(e,n.length>0?n:void 0)}Du(e,e=>{hd(t,e)})}function ud(t,e){const n=xu(ad(t,e)),i=ku(t.transactionQueueTree_,e);return function(t,e,n){let i=n?t:t.parent;for(;null!==i;){if(e(i))return!0;i=i.parent}}(i,e=>{dd(t,e)}),dd(t,i),Pu(i,e=>{dd(t,e)}),n}function dd(t,e){const n=Nu(e);if(n){const i=[];let s=[],r=-1;for(let e=0;e<n.length;e++)3===n[e].status||(1===n[e].status?(u(r===e-1,"All SENT items should be at beginning of queue."),r=e,n[e].status=3,n[e].abortReason="set"):(u(0===n[e].status,"Unexpected transaction status in abort"),n[e].unwatcher(),s=s.concat(cu(t.serverSyncTree_,n[e].currentWriteId,!0)),n[e].onComplete&&i.push(n[e].onComplete.bind(null,new Error("set"),!1,null))));-1===r?Au(e,void 0):n.length=r+1,Wu(t.eventQueue_,xu(e),s);for(let t=0;t<i.length;t++)Ec(i[t])}}const fd=function(t,e){const n=pd(t),i=n.namespace;"firebase.com"===n.domain&&cc(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||cc("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&lc("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const s="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new Pc(n.host,n.secure,i,s,e,"",i!==n.subdomain),path:new Yc(n.pathString)}},pd=function(t){let e="",n="",i="",s="",r="",o=!0,a="https",c=443;if("string"===typeof t){let l=t.indexOf("//");l>=0&&(a=t.substring(0,l-1),t=t.substring(l+2));let h=t.indexOf("/");-1===h&&(h=t.length);let u=t.indexOf("?");-1===u&&(u=t.length),e=t.substring(0,Math.min(h,u)),h<u&&(s=function(t){let e="";const n=t.split("/");for(let s=0;s<n.length;s++)if(n[s].length>0){let t=n[s];try{t=decodeURIComponent(t.replace(/\+/g," "))}catch(i){}e+="/"+t}return e}(t.substring(h,u)));const d=function(t){const e={};"?"===t.charAt(0)&&(t=t.substring(1));for(const n of t.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):lc("Invalid query segment '".concat(n,"' in query '").concat(t,"'"))}return e}(t.substring(Math.min(t.length,u)));l=e.indexOf(":"),l>=0?(o="https"===a||"wss"===a,c=parseInt(e.substring(l+1),10)):l=e.length;const f=e.slice(0,l);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{const t=e.indexOf(".");i=e.substring(0,t).toLowerCase(),n=e.substring(t+1),r=i}"ns"in d&&(r=d.ns)}return{host:e,port:c,domain:n,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}},gd="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";!function(){let t=0;const e=[]}();class md{constructor(t,e,n,i){this._repo=t,this._path=e,this._queryParams=n,this._orderByCalled=i}get key(){return sl(this._path)?null:tl(this._path)}get ref(){return new _d(this._repo,this._path)}get _queryIdentifier(){const t=Xl(this._queryParams),e=mc(t);return"{}"===e?"default":e}get _queryObject(){return Xl(this._queryParams)}isEqual(t){if(!((t=tt(t))instanceof md))return!1;const e=this._repo===t._repo,n=ol(this._path,t._path),i=this._queryIdentifier===t._queryIdentifier;return e&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)""!==t.pieces_[n]&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}(this._path)}}class _d extends md{constructor(t,e){super(t,e,new Ql,!1)}get parent(){const t=nl(this._path);return null===t?null:new _d(this._repo,t)}get root(){let t=this;for(;null!==t.parent;)t=t.parent;return t}}!function(t){u(!nu,"__referenceConstructor has already been defined"),nu=t}(_d),function(t){u(!iu,"__referenceConstructor has already been defined"),iu=t}(_d);const yd={};let vd=!1;function wd(t,e,n,i,s){let r=i||t.options.databaseURL;void 0===r&&(t.options.projectId||cc("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),rc("Using default host for project ",t.options.projectId),r="".concat(t.options.projectId,"-default-rtdb.firebaseio.com"));let o,a,c=fd(r,s),l=c.repoInfo;"undefined"!==typeof process&&(a={NODE_ENV:"production",PUBLIC_URL:"/balancestracker",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,r="http://".concat(a,"?ns=").concat(l.namespace),c=fd(r,s),l=c.repoInfo):o=!c.repoInfo.secure;const h=s&&o?new Ic(Ic.OWNER):new Sc(t.name,t.options,e);Bu("Invalid Firebase Database URL",c),sl(c.path)||cc("Database URL must point to the root of a Firebase Database (not including a child path).");const u=function(t,e,n,i){let s=yd[e.name];s||(s={},yd[e.name]=s);let r=s[t.toURLString()];r&&cc("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return r=new Qu(t,vd,n,i),s[t.toURLString()]=r,r}(l,t,h,new Tc(t,n));return new bd(u,t)}class bd{constructor(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Yu(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new _d(this._repo,Xc())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(t,e){const n=yd[e];n&&n[t.key]===t||cc("Database ".concat(e,"(").concat(t.repoInfo_,") has already been deleted.")),nd(t),delete n[t.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){null===this._rootInternal&&cc("Cannot call "+t+" on a deleted database.")}}fl.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},fl.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};!function(t){Ka(ge),he(new et("database",(t,e)=>{let{instanceIdentifier:n}=e;return wd(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"),t.getProvider("app-check-internal"),n)},"PUBLIC").setMultipleInstances(!0)),ye(Ha,Wa,t),ye(Ha,Wa,"esm2020")}();n(579);const Ed={apiKey:"AIzaSyB-P87cAnvDHpCoPocqhjHE9zGaDQXxe2U",authDomain:"balance-t.firebaseapp.com",databaseURL:"https://balance-t-default-rtdb.firebaseio.com",projectId:"balance-t",storageBucket:"balance-t.firebasestorage.app",messagingSenderId:"893924100931",appId:"1:893924100931:web:70427b3ff655341594fdf6",measurementId:"G-5RJM9SQDS1"};let Cd;Cd=Array.from(oe.values()).length?_e():me(Ed);let Td=!0,Sd=null;try{Sd=function(t,e){const n="object"==typeof t?t:_e(),i="string"==typeof t?t:e||qi,s=ue(n,"firestore").getImmediate({identifier:i});if(!s._initialized){const t=T("firestore");t&&function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t=Rn(t,wa);const s=k(e),r=t._getSettings(),o=a(a({},r),{},{emulatorOptions:t._getEmulatorOptions()}),c="".concat(e,":").concat(n);s&&(N("https://".concat(c)),P("Firestore",!0)),r.host!==_a&&r.host!==c&&Xe("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l=a(a({},r),{},{host:c,ssl:s,emulatorOptions:i});if(!Y(l,o)&&(t._setSettings(l),i.mockUserToken)){let e,n;if("string"==typeof i.mockUserToken)e=i.mockUserToken,n=We.MOCK_USER;else{var h;e=A(i.mockUserToken,null===(h=t._app)||void 0===h?void 0:h.options.projectId);const s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new sn(nn.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new We(s)}t._authCredentials=new cn(new on(e,n))}}(s,...t)}return s}(Cd)}catch(kd){console.warn("Firestore not available \u2014 will try Realtime Database as fallback.",kd),Td=!1}let Id=null;if(!Td)try{Id=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_e(),e=arguments.length>1?arguments[1]:void 0;const n=ue(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const t=T("database");t&&function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(t=tt(t))._checkNotDeleted("useEmulator");const s="".concat(e,":").concat(n),r=t._repoInternal;if(t._instanceStarted){if(s===t._repoInternal.repoInfo_.host&&Y(i,r.repoInfo_.emulatorOptions))return;cc("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&cc('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Ic(Ic.OWNER);else if(i.mockUserToken){const e="string"===typeof i.mockUserToken?i.mockUserToken:A(i.mockUserToken,t.app.options.projectId);o=new Ic(e)}k(e)&&(N(e),P("Database",!0)),function(t,e,n,i){const s=e.lastIndexOf(":"),r=k(e.substring(0,s));t.repoInfo_=new Pc(e,r,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),i&&(t.authTokenProvider_=i)}(r,s,i,o)}(n,...t)}return n}(Cd)}catch(kd){console.error("Realtime Database also not available:",kd)}})();
//# sourceMappingURL=main.ef3c85d6.js.map